
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>model &#8212; pyLabFEA 2.0.53 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for model</h1><div class="highlight"><pre>
<span></span><span class="c1">#Module pylabfea.mod</span>
<span class="sd">&#39;&#39;&#39;Module pylabefea.model introduces global functions for mechanical quantities and class ``Model`` that </span>
<span class="sd">contains that attributes and methods needed in FEA. Materials are defined in </span>
<span class="sd">module pylabfea.material</span>

<span class="sd">uses NumPy, SciPy, MatPlotLib</span>

<span class="sd">Version: 2.1 (2020-04-01)</span>
<span class="sd">Author: Alexander Hartmaier, ICAMS/Ruhr-University Bochum, April 2020</span>
<span class="sd">Email: alexander.hartmaier@rub.de</span>
<span class="sd">distributed under GNU General Public License (GPLv3)&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">pylabfea.basic</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>
   
<span class="s1">&#39;=========================&#39;</span>   
<span class="s1">&#39;define class for FE model&#39;</span>
<span class="s1">&#39;=========================&#39;</span>
<div class="viewcode-block" id="Model"><a class="viewcode-back" href="../pyLabFEA.html#model.Model">[docs]</a><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class for finite element model. Defines necessary attributes and methods</span>
<span class="sd">    for pre-processing (defining geometry, material assignments, mesh and boundary conditions);</span>
<span class="sd">    solution (invokes numerical solver for non-linear problems);</span>
<span class="sd">    and post-processing (visualization of results on meshed geometry, homogenization of results into global quantities)</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dim  : int</span>
<span class="sd">        Dimensionality of model (optional, default: 1)</span>
<span class="sd">    planestress : Boolean</span>
<span class="sd">        Sets plane-stress condition (optional, default: False)</span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    dim   : integer</span>
<span class="sd">        Dimensionality of model (1 and 2 are supported in this version)</span>
<span class="sd">    planestress : Boolean</span>
<span class="sd">        Sets plane-stress condition</span>
<span class="sd">    Nsec  : int</span>
<span class="sd">        Number of sections (defined in ``geom``)</span>
<span class="sd">    LS    : 1-d array</span>
<span class="sd">        Absolute lengths of sections (defined in ``geom``)</span>
<span class="sd">    lenx  : float</span>
<span class="sd">        Size of model in x-direction (defined in ``geom``)</span>
<span class="sd">    leny  : float</span>
<span class="sd">        Size of model in y-direction (defined in ``geom``, default leny=1)</span>
<span class="sd">    thick : float</span>
<span class="sd">        Thickness of 2d-model (defined in ``geom``, default thick=1)</span>
<span class="sd">    nonlin : Boolean</span>
<span class="sd">        Indicates non-linearity of model (defined in ``assign``)</span>
<span class="sd">    mat   : list of objects to class Material</span>
<span class="sd">        List of materials assigned to sections of model, same dimensions as LS (defined in ``assign``)</span>
<span class="sd">    ubot  : float</span>
<span class="sd">        Nodal displacements in x-direction for lhs nodes (defined in ``bcbot``)</span>
<span class="sd">    uleft : float</span>
<span class="sd">        Nodal displacement in x-direction for lhs nodes (defined in ``bcleft``)</span>
<span class="sd">    ubcright: Boolean</span>
<span class="sd">        True: displacement BC on rhs nodes; False: force BC on rhs nodes (defined in ``bcright``)</span>
<span class="sd">    bcr   : float</span>
<span class="sd">        Nodal displacements/forces in x-direction for rhs nodes (defined in ``bcright``)</span>
<span class="sd">    ubctop: Boolean</span>
<span class="sd">        True: displacement BC on top nodes; False: force BC on top nodes (defined in ``bctop``)</span>
<span class="sd">    bct   : float </span>
<span class="sd">        Nodal displacements/forces in y-direction for top nodes (defined in ``bctop``)</span>
<span class="sd">    Nnode : int</span>
<span class="sd">        Total number of nodes in Model (defined in ``mesh``)</span>
<span class="sd">    NnodeX, NnodeY : int</span>
<span class="sd">        Numbers of nodes in x and y-direction (defined in ``mesh``)</span>
<span class="sd">    Nel   : int</span>
<span class="sd">        Number of elements (defined in ``mesh``)</span>
<span class="sd">    Ndof  : int</span>
<span class="sd">        Number of degrees of freedom (defined in ``mesh``)</span>
<span class="sd">    npos: 1d-array</span>
<span class="sd">        Nodal positions, dimension Ndof, same structure as u,f-arrays: (x1, y1, x2, y1, ...) (defined in ``mesh``)</span>
<span class="sd">    noleft, noright, nobot, notop : list </span>
<span class="sd">        Lists of nodes on boundaries (defined in ``mesh``)</span>
<span class="sd">    noinner : list</span>
<span class="sd">        List of inner nodes (defined in ``mesh``)</span>
<span class="sd">    element : list</span>
<span class="sd">        List of objects of class ``Element``, dimension Nel (defined in ``mesh``)</span>
<span class="sd">    u    : (Ndof,) array</span>
<span class="sd">        List of nodal displacements (defined in ``solve``)</span>
<span class="sd">    f    : (Ndof,) array</span>
<span class="sd">        List of nodal forces (defined in ``solve``)</span>
<span class="sd">    sgl  : (N,6) array</span>
<span class="sd">        Time evolution of global stress tensor with incremental load steps (defined in ``solve``)</span>
<span class="sd">    egl  : (N,6) array</span>
<span class="sd">        Time evolution of global total strain tensor with incremental load steps (defined in ``solve``)</span>
<span class="sd">    epgl : (N,6) array</span>
<span class="sd">        Time evolution of global plastic strain tensor with incremental load steps (defined in ``solve``)</span>
<span class="sd">    glob : python dictionary</span>
<span class="sd">        Global values homogenized from BC or element solutions, contains the elements: </span>
<span class="sd">        &#39;ebc1&#39;, &#39;ebc2&#39;, &#39;sbc1&#39;, &#39;sbc2&#39; : global strain and stress from BC (type: float)</span>
<span class="sd">        &#39;eps&#39;, &#39;epl&#39;, &#39;sig&#39;,  : global strain, plastic strain, and stress tensors homogenized </span>
<span class="sd">        from element solutions (type: Voigt tensor)     (defined in ``calc_global``)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">planestress</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="c1"># set dimensions and type of model</span>
        <span class="c1"># initialize boundary conditions</span>
        <span class="c1"># dim: dimensional of model (currently only 1 or 2 is possible)</span>
        <span class="c1"># planestress: (boolean) plane stress condition</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">dim</span><span class="o">!=</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">dim</span><span class="o">!=</span><span class="mi">2</span><span class="p">)):</span>
            <span class="n">exit</span><span class="p">(</span><span class="s1">&#39;dim must be either 1 or 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span>
        <span class="k">if</span> <span class="n">planestress</span> <span class="ow">and</span> <span class="p">(</span><span class="n">dim</span><span class="o">!=</span><span class="mi">2</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Plane stress only defined for 2-d model&#39;</span><span class="p">)</span>
            <span class="n">planestress</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">planestress</span> <span class="o">=</span> <span class="n">planestress</span>
        <span class="c1">#print(&#39;Model initialized&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uleft</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># create warning if user sets no value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubot</span> <span class="o">=</span> <span class="kc">None</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">bct</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcr</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubctop</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># default free boundary on top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubcright</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># default free boundary on rhs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nonlin</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># default is linear elastic model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>  <span class="c1"># list for time evolution of global stresses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">egl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>  <span class="c1"># list for time evolution of global strains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> <span class="c1"># list for time evolution of global plastic strain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;ebc1&#39;</span>   <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># global x-strain from BC</span>
            <span class="s1">&#39;ebc2&#39;</span>   <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># global y-strain from BC</span>
            <span class="s1">&#39;sbc1&#39;</span>   <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># global x-strain from BC</span>
            <span class="s1">&#39;sbc2&#39;</span>   <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># global y-strain from BC</span>
            <span class="s1">&#39;eps&#39;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>  <span class="c1"># global strain tensor from element solutions</span>
            <span class="s1">&#39;sig&#39;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>  <span class="c1"># global stress tensor from element solutions</span>
            <span class="s1">&#39;epl&#39;</span>    <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>   <span class="c1"># global plastic strain tensor from element solutions</span>
        <span class="p">}</span>
    <span class="s1">&#39;----------------------&#39;</span>
    <span class="s1">&#39;Sub-Class for elements&#39;</span>
    <span class="s1">&#39;----------------------&#39;</span>
<div class="viewcode-block" id="Model.Element"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element">[docs]</a>    <span class="k">class</span> <span class="nc">Element</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Class for isoparametric elements; supports</span>
<span class="sd">        1-d elements with linear or quadratic shape function and full integration;</span>
<span class="sd">        2-d quadrilateral elements with linear shape function and full integration</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model  : object of class ``Model``</span>
<span class="sd">            Refers to parent class ``Model`` to inherit all attributes</span>
<span class="sd">        nodes  : list </span>
<span class="sd">            List of nodes belonging to element</span>
<span class="sd">        lx     : float</span>
<span class="sd">            Element size in x-direction</span>
<span class="sd">        ly     : float</span>
<span class="sd">            Element size in y-direction</span>
<span class="sd">        sect   : int</span>
<span class="sd">            Section in which element is located</span>
<span class="sd">        mat: object of class ``Material``</span>
<span class="sd">            Material card with attributes and methods to be applied in element</span>
<span class="sd">                </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        Model : object of class ``Model``</span>
<span class="sd">            Refers to parent object (FE model)</span>
<span class="sd">        nodes : list </span>
<span class="sd">            List of nodes of this element</span>
<span class="sd">        Lelx  : float</span>
<span class="sd">            Size of element in x-direction</span>
<span class="sd">        Lely  : float</span>
<span class="sd">            Size of element in y-direction</span>
<span class="sd">        ngp   : int</span>
<span class="sd">            number of Gauss points</span>
<span class="sd">        gpx   : 1-d array</span>
<span class="sd">            x-locations of Gauss points in element</span>
<span class="sd">        gpy   : 1-d array</span>
<span class="sd">            y-locations of Gauss points in element</span>
<span class="sd">        Bmat  : list</span>
<span class="sd">            List of B-matrices at Gauss points</span>
<span class="sd">        wght  : 1-d array</span>
<span class="sd">            List of weight of each Gauss point in integration</span>
<span class="sd">        Vel   : float</span>
<span class="sd">            Volume of element</span>
<span class="sd">        Jac   : float</span>
<span class="sd">            Determinant of Jacobian of iso-parametric formulation</span>
<span class="sd">        CV    : (6,6) array</span>
<span class="sd">            Voigt stiffness matrix of element material</span>
<span class="sd">        elstiff : 2-d array</span>
<span class="sd">            Tangent stiffness tensor of element</span>
<span class="sd">        Kel   : 2-d array</span>
<span class="sd">            Element stiffness matrix</span>
<span class="sd">        Sect  : int</span>
<span class="sd">            Section of model in which element is located</span>
<span class="sd">        Mat   : object of class ``Material``</span>
<span class="sd">            Material model to be applied</span>
<span class="sd">        eps   : Voigt tensor</span>
<span class="sd">            average (total) element strain (defined in ``Model.solve``)</span>
<span class="sd">        sig   : Voigt tensor</span>
<span class="sd">            average element stress (defined in ``Model.solve``)</span>
<span class="sd">        epl   : Voigt tensor</span>
<span class="sd">            average plastic element strain (defined in ``Model.solve``)</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">sect</span><span class="p">,</span> <span class="n">mat</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span> <span class="o">=</span> <span class="n">lx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Lely</span> <span class="o">=</span> <span class="n">ly</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sect</span> <span class="o">=</span> <span class="n">sect</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Mat</span> <span class="o">=</span> <span class="n">mat</span>
            <span class="n">DIM</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dim</span>
            <span class="c1">#Calculate Voigt stiffness matrix for plane stress and plane strain&#39;</span>
            <span class="k">if</span> <span class="n">mat</span><span class="o">.</span><span class="n">CV</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">C11</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">C11</span>
                <span class="n">C12</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">C12</span>
                <span class="n">C44</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">C44</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">planestress</span><span class="p">):</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">mat</span><span class="o">.</span><span class="n">nu</span><span class="o">*</span><span class="n">mat</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
                    <span class="n">C12</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">nu</span><span class="o">*</span><span class="n">hh</span>
                    <span class="n">C11</span> <span class="o">=</span> <span class="n">hh</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="n">C12</span><span class="p">,</span> <span class="n">C11</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="n">C44</span><span class="p">]])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="n">C12</span><span class="p">,</span> <span class="n">C11</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="n">C12</span><span class="p">,</span> <span class="n">C12</span><span class="p">,</span> <span class="n">C11</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="n">C44</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="n">C44</span><span class="p">,</span> <span class="mf">0.</span><span class="p">],</span> \
                       <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="n">C44</span><span class="p">]])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="n">mat</span><span class="o">.</span><span class="n">CV</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elstiff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CV</span>
            
            <span class="c1">#initialize element quantities</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            
            <span class="c1">#Calculate element attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Vel</span> <span class="o">=</span> <span class="n">lx</span><span class="o">*</span><span class="n">ly</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">thick</span>        <span class="c1"># element volume</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ngp</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">*</span><span class="n">DIM</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># number of Gauss points in element</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ngp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gpy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ngp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ngp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wght</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># weight factor for Gauss integration, to be adapted to element type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Jac</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vel</span>   <span class="c1"># determinant of Jacobian matrix, to be adapted to element type</span>
            
            <span class="c1">#Calculate B matrix at all Gauss points</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># integration trivial for 1-d element with linear shape function</span>
                    <span class="c1"># because B is constant for all positions in element</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Bmat</span><span class="p">()</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="c1"># integration for 2-d quadriliteral elements with lin shape fct</span>
                    <span class="c1"># reduced integration with one Gauss point in middle of element</span>
                    <span class="n">cpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>   <span class="c1"># position of Gauss points</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Jac</span> <span class="o">*=</span> <span class="mf">4.</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ngp</span><span class="p">):</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">sy</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">i</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">sx</span><span class="o">*</span><span class="n">cpos</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">sy</span><span class="o">*</span><span class="n">cpos</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Lely</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gpx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gpy</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Bmat</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># integration for 1-d element with quadratic shape function</span>
                    <span class="c1"># Gauss integration</span>
                    <span class="n">cpos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>   <span class="c1"># position of Gauss points</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">wght</span> <span class="o">=</span> <span class="mf">0.5</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ngp</span><span class="p">):</span>
                        <span class="n">sx</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="n">i</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">sx</span><span class="o">*</span><span class="n">cpos</span><span class="p">)</span>  <span class="c1"># positions of Gauss points</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">gpx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Bmat</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Quadrilateral elements with quadratic shape function not yet implemented&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_Kel</span><span class="p">()</span>
            
<div class="viewcode-block" id="Model.Element.calc_Kel"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.calc_Kel">[docs]</a>        <span class="k">def</span> <span class="nf">calc_Kel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="s1">&#39;Calculate element stiffness matrix by Gaussian integration&#39;</span>
            <span class="n">K0</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">elstiff</span> <span class="o">@</span> <span class="n">B</span><span class="p">)</span> <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Kel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Jac</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">wght</span><span class="o">*</span><span class="nb">sum</span><span class="p">(</span><span class="n">K0</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Model.Element.node_num"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.node_num">[docs]</a>        <span class="k">def</span> <span class="nf">node_num</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculate indices of DOF associated with element</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            ind : list of int</span>
<span class="sd">                List of indices</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ind</span></div>
        
<div class="viewcode-block" id="Model.Element.deps"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.deps">[docs]</a>        <span class="k">def</span> <span class="nf">deps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculate strain increment in element</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            deps : Voigt tensor</span>
<span class="sd">                Strain increment</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">deps</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">:</span>
                <span class="n">deps</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wght</span><span class="o">*</span><span class="n">B</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">du</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_num</span><span class="p">()]</span>
            <span class="k">return</span> <span class="n">deps</span></div>

<div class="viewcode-block" id="Model.Element.eps_t"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.eps_t">[docs]</a>        <span class="k">def</span> <span class="nf">eps_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculate total strain in element</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            eps_t : Voigt tensor</span>
<span class="sd">                Total strain</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">eps_t</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">B</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bmat</span><span class="p">:</span>
                <span class="n">eps_t</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wght</span><span class="o">*</span><span class="n">B</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">node_num</span><span class="p">()]</span>
            <span class="k">return</span> <span class="n">eps_t</span></div>
        
<div class="viewcode-block" id="Model.Element.dsig"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.dsig">[docs]</a>        <span class="k">def</span> <span class="nf">dsig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
            <span class="sd">&#39;&#39;&#39;Calculate stress increment</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            dsig : Voigt tensor</span>
<span class="sd">                Stress increment</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">dsig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elstiff</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">deps</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">dsig</span></div>
        
<div class="viewcode-block" id="Model.Element.depl"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.depl">[docs]</a>        <span class="k">def</span> <span class="nf">depl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculate plastic strain increment</span>
<span class="sd">            </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            depl : Voigt tensor</span>
<span class="sd">                Plastic strain increment</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">sy</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">depl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">depl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">epl_dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">epl</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">CV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">deps</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">depl</span></div>
        
<div class="viewcode-block" id="Model.Element.calc_Bmat"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.Element.calc_Bmat">[docs]</a>        <span class="k">def</span> <span class="nf">calc_Bmat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Calculate B matrix at position x in element</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            x : float </span>
<span class="sd">                absolute x-position in element (optional, default: 0)</span>
<span class="sd">            y : float</span>
<span class="sd">                absolute y-position in element (optional, default: 0)</span>
<span class="sd">                </span>
<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            B : 6xN array</span>
<span class="sd">                matrix (N=dim^2*(SF+1))</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="c1"># (B_aj = L_ak N_kj k=1,...,dim a=1,...,6 j=DOF_el)</span>
            <span class="c1"># 1-d, linear: </span>
            <span class="c1"># N11 = 1 - x/Lelx N12 = x/Lelx</span>
            <span class="c1"># L11 = d/dx</span>
            <span class="c1"># 1-d, quadratic:</span>
            <span class="c1"># N11 = 1 - 3x/Lelx+2x^2/Lelx^2</span>
            <span class="c1"># N12 = 4x/Lelx*(1-x/Lelx)</span>
            <span class="c1"># N13 = -x/Lelx(1-2x/Lelx)</span>
            <span class="c1"># L11 = d/dx</span>
            <span class="c1"># all other N_ij, L_ij are zero for 1-dim case</span>
            <span class="c1"># see documentation for 2-d element</span>

            <span class="n">DIM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">dim</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">DIM</span><span class="o">*</span><span class="n">DIM</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="n">N</span><span class="p">))</span> 
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                <span class="c1"># linear shape function</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">hx</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hx</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hx</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">xi1</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span> <span class="o">-</span> <span class="mf">1.</span>  <span class="c1"># scaled x-position within element, xi1 in [-1,1]</span>
                    <span class="n">xi2</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lely</span> <span class="o">-</span> <span class="mf">1.</span>  <span class="c1"># scaled y-position</span>
                    <span class="n">hxm</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xi1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lely</span>
                    <span class="n">hym</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">xi2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span>
                    <span class="n">hxp</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">xi1</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lely</span>
                    <span class="n">hyp</span> <span class="o">=</span> <span class="mf">0.125</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">xi2</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hym</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hyp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hym</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hyp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hxm</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hxm</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hxp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hxp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hxm</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hym</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hxm</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hyp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">hxp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hym</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hxp</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span>  <span class="n">hyp</span>
                    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">planestress</span><span class="p">):</span>
                        <span class="c1"># eps3 = -nu (sig1 + sig2)/E</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">@</span> <span class="n">B</span>   <span class="c1"># sig_(alpha,j)</span>
                        <span class="n">B</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">hh</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">hh</span><span class="p">[</span><span class="mi">1</span><span class="p">,:])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">E</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">shapefact</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">h1</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span>
                <span class="n">h2</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Lelx</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2</span><span class="o">*</span><span class="n">x</span>  <span class="o">-</span> <span class="mf">3.</span><span class="o">*</span><span class="n">h1</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">4.</span><span class="o">*</span><span class="n">h1</span> <span class="o">-</span> <span class="mf">2.</span><span class="o">*</span><span class="n">h2</span><span class="o">*</span><span class="n">x</span>
                    <span class="n">B</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">h2</span><span class="o">*</span><span class="n">x</span>  <span class="o">-</span> <span class="n">h1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Quadratic shape functions for 2D elements not yet implemented&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">B</span></div></div>
        
<div class="viewcode-block" id="Model.geom"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.geom">[docs]</a>    <span class="k">def</span> <span class="nf">geom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sect</span><span class="p">,</span> <span class="n">LY</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">LZ</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Specify geometry of FE model and its subdivision into sections;</span>
<span class="sd">        for 2-d model a laminate structure normal to x-direction is created; adds attributes to class ``Model``</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sect  : list </span>
<span class="sd">            List with with absolute length of each section</span>
<span class="sd">        LY : float</span>
<span class="sd">            Length in y direction (optional, default: 1)</span>
<span class="sd">        LZ : float</span>
<span class="sd">            Thickness of model in z-direction (optional, default: 1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>  <span class="c1"># number of sections</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lenx</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sect</span><span class="p">)</span>  <span class="c1"># total length of model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">leny</span> <span class="o">=</span> <span class="n">LY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thick</span> <span class="o">=</span> <span class="n">LZ</span></div>
        
<div class="viewcode-block" id="Model.assign"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.assign">[docs]</a>    <span class="k">def</span> <span class="nf">assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mats</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Assigns an object of class ``Material`` to each section.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mats : list </span>
<span class="sd">            List of materials, must have same dimensions as Model.LS</span>
<span class="sd">            </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">mats</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mats</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">mats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">sy</span><span class="o">!=</span><span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nonlin</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># nonlinear model if at least one material is plastic</span></div>

    <span class="s1">&#39;subroutines to define boundary conditions, top/bottom only needed for 2-d models&#39;</span>
<div class="viewcode-block" id="Model.bcleft"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.bcleft">[docs]</a>    <span class="k">def</span> <span class="nf">bcleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define boundary conditions on lhs nodes, always displacement type</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u0   : float</span>
<span class="sd">            Displacement in x direction of lhs nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uleft</span> <span class="o">=</span> <span class="n">u0</span></div>
        
<div class="viewcode-block" id="Model.bcright"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.bcright">[docs]</a>    <span class="k">def</span> <span class="nf">bcright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">bctype</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define boundary conditions on rhs nodes, either force or displacement type</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h0     : float</span>
<span class="sd">            Displacement or force in x direction </span>
<span class="sd">        bctype : str</span>
<span class="sd">            Type of boundary condition (&#39;disp&#39; or &#39;force&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcr</span>  <span class="o">=</span> <span class="n">h1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namebcr</span> <span class="o">=</span> <span class="n">bctype</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bctype</span><span class="o">==</span><span class="s1">&#39;disp&#39;</span><span class="p">):</span>
            <span class="s1">&#39;type of boundary conditions (BC)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubcright</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># True: displacement BC on rhs node</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">bctype</span><span class="o">==</span><span class="s1">&#39;force&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubcright</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># False: force BC on rhs node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Unknown BC:&#39;</span><span class="p">,</span> <span class="n">bctype</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Model.bcbot"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.bcbot">[docs]</a>    <span class="k">def</span> <span class="nf">bcbot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define boundary conditions on bottom nodes, always displacement type</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        u0  : float</span>
<span class="sd">            Displacement in x direction </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubot</span> <span class="o">=</span> <span class="n">u0</span></div>
        
<div class="viewcode-block" id="Model.bctop"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.bctop">[docs]</a>    <span class="k">def</span> <span class="nf">bctop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">bctype</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define boundary conditions on top nodes, either force or displacement type</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        h0     : float</span>
<span class="sd">            Displacement or force in x direction </span>
<span class="sd">        bctype : str</span>
<span class="sd">            Type of boundary condition (&#39;disp&#39; or &#39;force&#39;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bct</span>  <span class="o">=</span> <span class="n">h1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">namebct</span> <span class="o">=</span> <span class="n">bctype</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bctype</span><span class="o">==</span><span class="s1">&#39;disp&#39;</span><span class="p">):</span>
            <span class="s1">&#39;type of boundary conditions (BC)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubctop</span> <span class="o">=</span> <span class="kc">True</span>   <span class="c1"># True: displacement BC on rhs node</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">bctype</span><span class="o">==</span><span class="s1">&#39;force&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubctop</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># False: force BC on rhs node</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: Unknown BC:&#39;</span><span class="p">,</span> <span class="n">bctype</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="Model.mesh"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.mesh">[docs]</a>    <span class="k">def</span> <span class="nf">mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NX</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">NY</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">SF</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Generate structured mesh with quadrilateral elements (2d models). First,</span>
<span class="sd">        nodal positions ``Model.npos`` are defined such that nodes lie at </span>
<span class="sd">        corners (linear shape function) and edges (quadratic shape function) of elements. </span>
<span class="sd">        Then, elements are initialized as object of class ``Model.Element``, which requires the list of </span>
<span class="sd">        nodes associated with the element, the dimensions of the element, and the material of</span>
<span class="sd">        the section in which the element is situated to be passed.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        NX : int</span>
<span class="sd">            Number of elements in x-direction (optional, default: 10)</span>
<span class="sd">        NY : int</span>
<span class="sd">            Number of elements in y-direction (optional, default: 1)</span>
<span class="sd">        SF : int</span>
<span class="sd">            Degree of shape functions: 1=linear, 2=quadratic (optional, default: 1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span> <span class="o">=</span> <span class="n">SF</span>
        <span class="n">DIM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">NX</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Number of elements is smaller than number of sections&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">NY</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">NY</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: NY=1 for 1-d model&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1">#print(&#39;Warning: solution of previous solution steps is deleted&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NnodeX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span><span class="o">*</span><span class="n">NX</span> <span class="o">+</span> <span class="mi">1</span>    <span class="c1"># number of nodes along x axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NnodeY</span> <span class="o">=</span> <span class="p">(</span><span class="n">DIM</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span><span class="o">*</span><span class="n">NY</span> <span class="o">+</span> <span class="mi">1</span>    <span class="c1"># number of nodes along y axis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nel</span> <span class="o">=</span> <span class="n">NX</span><span class="o">*</span><span class="n">NY</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NnodeX</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">NnodeY</span>   <span class="c1"># total number of nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nnode</span><span class="o">*</span><span class="n">DIM</span>  <span class="c1"># degrees of freedom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>  <span class="c1"># position array of nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nel</span>  <span class="c1"># empty list for elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noleft</span>  <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of nodes on left boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noright</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of nodes on right boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nobot</span>   <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of nodes on bottom boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notop</span>   <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of nodes on top boundary</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noinner</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># list of inner nodes</span>
        
        <span class="s1">&#39;Calculate number of elements per section -- only laminate structure&#39;</span>
        <span class="n">hh</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LS</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenx</span>      <span class="c1"># proportion of segment length to total length of model</span>
        <span class="n">nes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hh</span><span class="o">*</span><span class="n">NX</span><span class="p">)]</span>  <span class="c1"># nes gives number of elements per segement in proportion </span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nes</span><span class="p">)</span> <span class="o">!=</span> <span class="n">NX</span><span class="p">):</span>  <span class="c1"># add or remove elements of largest section if necessary</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LS</span><span class="p">)</span>
            <span class="n">nes</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">=</span> <span class="n">nes</span><span class="p">[</span><span class="n">im</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nes</span><span class="p">)</span> <span class="o">+</span> <span class="n">NX</span>

        <span class="s1">&#39;Define nodal positions and element shapes -- only for laminate structure&#39;</span>
        <span class="n">jstart</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">nrow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NnodeY</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">leny</span> <span class="o">/</span> <span class="n">NY</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span><span class="p">):</span>
            <span class="s1">&#39;define nodal positions first&#39;</span>
            <span class="n">ncol</span> <span class="o">=</span> <span class="n">nes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">LS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">nes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">elstart</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nes</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">i</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">*</span><span class="n">nr</span>
            <span class="n">n1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">elstart</span><span class="o">/</span><span class="n">NY</span><span class="p">)</span><span class="o">*</span><span class="n">nrow</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">elstart</span><span class="p">,</span><span class="n">NY</span><span class="p">)))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">jstart</span><span class="p">,</span> <span class="n">ncol</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">):</span>
                    <span class="n">inode</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="n">nrow</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="n">n1</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">inode</span><span class="o">*</span><span class="n">DIM</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="nb">int</span><span class="p">(</span><span class="n">elstart</span><span class="o">/</span><span class="n">NY</span><span class="p">))</span><span class="o">*</span><span class="n">dx</span> <span class="c1"># x-position of node</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">inode</span><span class="o">*</span><span class="n">DIM</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">dy</span> <span class="c1"># y-position of node</span>
                    <span class="n">nin</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span> 
                        <span class="bp">self</span><span class="o">.</span><span class="n">noleft</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
                        <span class="n">nin</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nobot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
                        <span class="n">nin</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">notop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
                        <span class="n">nin</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="p">((</span><span class="n">i</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">Nsec</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="ow">and</span><span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">ncol</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">noright</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
                        <span class="n">nin</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">if</span> <span class="n">nin</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">noinner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span>
            <span class="s1">&#39;initialize elements&#39;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">nr</span><span class="p">):</span>
                <span class="n">ih</span> <span class="o">=</span> <span class="n">elstart</span> <span class="o">+</span> <span class="n">j</span>   <span class="c1"># index of current element</span>
                <span class="n">n1</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ih</span><span class="o">/</span><span class="n">NY</span><span class="p">)</span><span class="o">*</span><span class="n">nrow</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">ih</span><span class="p">,</span><span class="n">NY</span><span class="p">)))</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span>
                <span class="n">n2</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span>
                <span class="n">n3</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">nrow</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span>
                <span class="n">n4</span> <span class="o">=</span> <span class="n">n3</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span><span class="o">*</span><span class="n">DIM</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">[</span><span class="n">ih</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">],</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># 1-d, lin shape fct</span>
                <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shapefact</span><span class="o">*</span><span class="n">DIM</span><span class="o">==</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">nh</span> <span class="o">=</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">nrow</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">nh</span><span class="p">,</span> <span class="n">nh</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n3</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n4</span><span class="p">]</span> <span class="c1"># 2-d, quad shape fct</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">[</span><span class="n">ih</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">DIM</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span><span class="p">,</span> <span class="n">n4</span><span class="p">]</span> <span class="c1"># 2-d, lin shape fct</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">[</span><span class="n">ih</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">n1</span><span class="p">,</span> <span class="n">n1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">n2</span><span class="p">]</span> <span class="c1"># 1-d, lin shape fct</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">[</span><span class="n">ih</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">jstart</span> <span class="o">=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="Model.setupK"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.setupK">[docs]</a>    <span class="k">def</span> <span class="nf">setupK</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate and assemble system stiffness matrix based on element stiffness matrices.</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        K  : 2d-array</span>
<span class="sd">            System stiffness matrix</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">DIM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>  <span class="c1"># initialize system stiffness matrix</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="s1">&#39;assemble element stiffness matrix into system stiffness matrix&#39;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">)):</span>
                <span class="n">j1</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">DIM</span>      <span class="c1"># position of ux (1st dof) of left node in u vector</span>
                <span class="n">j2</span> <span class="o">=</span> <span class="n">j1</span> <span class="o">+</span> <span class="n">DIM</span>
                <span class="n">je1</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="n">DIM</span>
                <span class="n">je2</span> <span class="o">=</span> <span class="n">je1</span> <span class="o">+</span> <span class="n">DIM</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">)):</span>
                    <span class="n">k1</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">*</span><span class="n">DIM</span>
                    <span class="n">k2</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">DIM</span>
                    <span class="n">ke1</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">DIM</span>
                    <span class="n">ke2</span> <span class="o">=</span> <span class="n">ke1</span> <span class="o">+</span> <span class="n">DIM</span>
                    <span class="n">K</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">,</span><span class="n">k1</span><span class="p">:</span><span class="n">k2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">Kel</span><span class="p">[</span><span class="n">je1</span><span class="p">:</span><span class="n">je2</span><span class="p">,</span><span class="n">ke1</span><span class="p">:</span><span class="n">ke2</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">K</span></div>
     
<div class="viewcode-block" id="Model.solve"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.solve">[docs]</a>    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Solve linear system of equations K.u = f with respect to u, to obtain distortions</span>
<span class="sd">        of the system under the applied boundary conditions for mechanical equilibrium, i.e.,</span>
<span class="sd">        when the total force on internal nodes is zero. In the first step, the stiffness </span>
<span class="sd">        matrix K, the nodal displacements u and the nodal forces f are modified to conform</span>
<span class="sd">        with the boundary conditions (``calc_BC``), then an elastic predictor step is calculated,</span>
<span class="sd">        which is already the final solution for linear problems. For non-linear problems, i.e. for </span>
<span class="sd">        plastic materials, the load step must be controlled and subdivided to fulfill </span>
<span class="sd">        the side conditions of plastic materials, i.e. the equivalent stress must remain </span>
<span class="sd">        smaller than the yield strength, or the flow stress during plastic yielding. This is </span>
<span class="sd">        ensured in a self.consistency loop for non-linear models. The system of </span>
<span class="sd">        equations is solved by invoking the subroutine numpy.linalg.solve. The method yields</span>
<span class="sd">        the final solution </span>
<span class="sd">        for nodal displacements u and nodal forces f as attributes of </span>
<span class="sd">        class ``Model``; global stress, global total strain and global plastic strain are </span>
<span class="sd">        evaluated and stored as attributes, too. Element solutions for stresses and strains </span>
<span class="sd">        are stored as attributes of class ``Element``, see documentation of this class.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        min_step : int</span>
<span class="sd">            Minimum number of load steps (optional)</span>
<span class="sd">        verb     : Boolean</span>
<span class="sd">            Be verbose in text output (optional, default: False)</span>
<span class="sd">            </span>
<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        Model.u     : (Model.Ndof,) array</span>
<span class="sd">            Nodal displacements</span>
<span class="sd">        Model.f     : (Model.Ndof,) array</span>
<span class="sd">            Nodel forces</span>
<span class="sd">        Model.sgl   : (N,6) array</span>
<span class="sd">            Global stress as as Voigt tensor for each incremental load step (homogenized element solution)</span>
<span class="sd">        Model.egl   : (N,6) array</span>
<span class="sd">            Global total strain as as Voigt tensor for each incremental load step (homogenized element solution)</span>
<span class="sd">        Model.epgl  : (N,6) array</span>
<span class="sd">            Global plastic strain as as Voigt tensor for each incremental load step (homogenized element solution)</span>
<span class="sd">        Element.sig : (6,) array</span>
<span class="sd">            Element solution for stress tensor</span>
<span class="sd">        Element.eps : (6,) array</span>
<span class="sd">            Element solution for total strain tensor</span>
<span class="sd">        Element.epl : (6,) array</span>
<span class="sd">            Element solution for plastic strain tensor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="s1">&#39;calculate reduced stiffness matrix according to BC&#39;</span>
        <span class="k">def</span> <span class="nf">Kred</span><span class="p">(</span><span class="n">ind</span><span class="p">):</span>
            <span class="n">Kred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)):</span>
                    <span class="n">Kred</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ind</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="k">return</span> <span class="n">Kred</span>
        
        <span class="s1">&#39;evaluate yield function in each element/for each Gauss point and change element stiffness matrix&#39;</span>
        <span class="s1">&#39;to tangent stiffness if in plastic regime&#39;</span>
        <span class="k">def</span> <span class="nf">calc_el_yldfct</span><span class="p">():</span>
            <span class="n">f</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># test if yield criterion is exceeded</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">sy</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># not necessary for elastic material</span>
                    <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="o">+</span><span class="n">el</span><span class="o">.</span><span class="n">depl</span><span class="p">())</span> <span class="c1"># calculate equiv. plastic strain</span>
                    <span class="n">sig</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="o">+</span><span class="n">el</span><span class="o">.</span><span class="n">dsig</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">ML_yf</span> <span class="ow">and</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">ML_full_yf</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hh</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span> <span class="n">peeq</span><span class="o">=</span><span class="n">peeq</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hh</span> <span class="o">&gt;</span> <span class="n">ptol</span><span class="p">:</span>
                        <span class="c1"># for debugging</span>
                        <span class="sd">&#39;&#39;&#39;h0 = el.Mat.calc_yf(el.sig,peeq=eps_eq(el.epl)) # calculate yield function at last converged step</span>
<span class="sd">                        if h0 &lt; -ptol:</span>
<span class="sd">                            &#39;origin of step in elastic region, force step to end at yield surface&#39;</span>
<span class="sd">                            print(&#39;Warning in calc_el_yldfct: Increment crosses yield surface&#39;)</span>
<span class="sd">                            print(&#39;sig, peeq, hh, h0, ptol, el.sig, el.epl&#39;, sig, peeq, hh, h0, ptol, el.sig, el.epl)</span>
<span class="sd">                            hh = 0.</span>
<span class="sd">                        else:</span>
<span class="sd">                            &#39;step fully in plastic regime&#39;</span>
<span class="sd">                        &#39;&#39;&#39;</span>
                        <span class="n">el</span><span class="o">.</span><span class="n">elstiff</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">C_tan</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">CV</span><span class="p">)</span>  <span class="c1"># for plasticity calculate tangent stiffness</span>
                        <span class="n">el</span><span class="o">.</span><span class="n">calc_Kel</span><span class="p">()</span>                             <span class="c1"># and update element stiffness matrix</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        <span class="s1">&#39;calculate scaling factor for load steps&#39;</span>
        <span class="k">def</span> <span class="nf">calc_scf</span><span class="p">():</span>
            <span class="n">sc_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
                <span class="c1"># test if yield criterion is exceeded</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">sy</span><span class="o">!=</span><span class="kc">None</span><span class="p">):</span>  <span class="c1"># not necessary for elastic material</span>
                    <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span> <span class="c1"># calculate equiv. plastic strain</span>
                    <span class="n">yf0</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">,</span> <span class="n">peeq</span><span class="o">=</span><span class="n">peeq</span><span class="p">)</span>  <span class="c1"># yield fct. at start of load step</span>
                    <span class="s1">&#39;if element starts in elastic regime load step can only touch yield surface&#39;</span>
                    <span class="k">if</span>  <span class="n">yf0</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.15</span><span class="p">:</span>
                        <span class="n">sref</span> <span class="o">=</span> <span class="n">Stress</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="o">+</span><span class="n">el</span><span class="o">.</span><span class="n">dsig</span><span class="p">())</span><span class="o">.</span><span class="n">seq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="p">)</span> <span class="c1"># element stress at max load step</span>
                        <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">ML_yf</span><span class="p">:</span>
                            <span class="s1">&#39;for categorial ML yield function, calculate yf0 as distance to yield surface&#39;</span>
                            <span class="s1">&#39;construct normal stress vector in loading sirection for search of yield point&#39;</span>
                            <span class="n">hs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_dbcr</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-6</span><span class="p">:</span>
                                <span class="n">hs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">sy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">max_dbcr</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">max_dbct</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-6</span><span class="p">:</span>
                                <span class="n">hs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">sy</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">max_dbct</span><span class="p">)</span>
                            <span class="n">yf0</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">ML_full_yf</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">,</span> <span class="n">ld</span><span class="o">=</span><span class="n">hs</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">)</span>  <span class="c1"># distance of initial stress state to yield locus</span>
                        <span class="n">sc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="n">yf0</span><span class="o">/</span><span class="n">sref</span><span class="p">)</span>
            <span class="c1"># select scaling appropriate scaling such that no element crosses yield surface</span>
            <span class="n">scf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">sc_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">scf</span><span class="o">&lt;</span><span class="mf">1.e-5</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Small load increment in calc_scf: &#39;</span><span class="p">,</span><span class="n">scf</span><span class="p">,</span> <span class="n">sc_list</span><span class="p">)</span>
                <span class="n">scf</span> <span class="o">=</span> <span class="mf">1.e-5</span>
            <span class="k">return</span> <span class="n">scf</span>
            
        <span class="s1">&#39;define BC: modify stiffness matrix for displacement BC, calculate consistent force BC&#39;</span>
        <span class="k">def</span> <span class="nf">calc_BC</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ul</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">dbcr</span><span class="p">,</span> <span class="n">dbct</span><span class="p">):</span>
            <span class="c1"># BC on lhs nodes is always x-displacement </span>
            <span class="c1"># apply BC by adding known boundary forces to solution vector</span>
            <span class="c1"># to reduce rank of system of equations by 1 (one row eliminated)</span>
            <span class="c1"># Paramaters:</span>
            <span class="c1"># K : stiffness matrix</span>
            <span class="c1"># ul, ub : fixed displacement on lhs and bottom nodes</span>
            <span class="c1"># dbcr, dbct : increment of BC on rhs and top noes</span>
            <span class="n">du</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>  <span class="c1"># list of all nodal DOF, will be shortened according to BC</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">noleft</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>   <span class="c1"># postion of x-values of node #j in u/f vector</span>
                <span class="n">ind</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">du</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ul</span>
                <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">ul</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="c1"># BC on bottom nodes is always y-displacement </span>
                <span class="c1"># apply BC by adding known boundary forces to solution vector</span>
                <span class="c1"># to reduce rank of system of equations by 1 (one row eliminated)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nobot</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>   <span class="c1"># postion of y-values of node #j in u/f vector</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">du</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ub</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">ub</span>

            <span class="c1"># rhs node BC can be force or displacement</span>
            <span class="c1"># apply BC and solve corresponding system of equations</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubcright</span><span class="p">):</span>
                <span class="c1"># displacement BC</span>
                <span class="c1"># add known boundary force to solution vector to</span>
                <span class="c1"># eliminate row Ndof from system of equations</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">noright</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
                    <span class="n">ind</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
                    <span class="n">hh</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">du</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbcr</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">hh</span><span class="p">]</span> <span class="o">-=</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">hh</span><span class="p">]</span><span class="o">*</span><span class="n">dbcr</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># force bc on rhs nodes</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">noright</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
                    <span class="n">hh</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NnodeY</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">hy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#y-position of node</span>
                    <span class="k">if</span> <span class="n">hy</span><span class="o">&lt;</span><span class="mf">1.e-3</span> <span class="ow">or</span> <span class="n">hy</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">leny</span><span class="o">-</span><span class="mf">1.e-3</span><span class="p">:</span>
                        <span class="n">hh</span><span class="o">*=</span><span class="mf">0.5</span>  <span class="c1"># reduce force on corner nodes</span>
                    <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dbcr</span><span class="o">*</span><span class="n">hh</span>
                
            <span class="c1"># BC on top nodes can be force or displacement</span>
            <span class="c1"># apply BC and solve corresponding system of equations</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubctop</span><span class="p">):</span>
                    <span class="c1"># displacement BC</span>
                    <span class="c1"># add known boundary force to solution vector to</span>
                    <span class="c1"># eliminate row Ndof from system of equations</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notop</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">ind</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">du</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbct</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">-=</span> <span class="n">K</span><span class="p">[</span><span class="n">ind</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">dbct</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># force bc on top nodes</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">notop</span><span class="p">:</span>
                        <span class="n">i</span> <span class="o">=</span> <span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">hh</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NnodeX</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">hx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#x-position of node</span>
                        <span class="k">if</span> <span class="n">hx</span><span class="o">&lt;</span><span class="mf">1.e-3</span> <span class="ow">or</span> <span class="n">hx</span><span class="o">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">lenx</span><span class="o">-</span><span class="mf">1.e-3</span><span class="p">:</span>
                            <span class="n">hh</span><span class="o">*=</span><span class="mf">0.5</span>  <span class="c1"># reduce force on corner nodes</span>
                        <span class="n">df</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">dbct</span><span class="o">*</span><span class="n">hh</span>
            <span class="k">return</span> <span class="n">du</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ind</span>
            
        <span class="c1"># test if all necessary BC have been set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uleft</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uleft</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: BC on lhs nodes has been set to 0&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcr</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubrtop</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">namebcr</span> <span class="o">=</span> <span class="s1">&#39;force&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubot</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubot</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: BC on bottom nodes has been set to 0&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bct</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bct</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubctop</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">namebct</span> <span class="o">=</span> <span class="s1">&#39;force&#39;</span>
                
        <span class="n">jin</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">noinner</span><span class="p">:</span>
            <span class="n">jin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>
            <span class="n">jin</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># declare and initialize solution and result vectors, and boundary conditions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">egl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> 
            <span class="s1">&#39;initialize element quantities&#39;</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">elstiff</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">CV</span>
                <span class="n">el</span><span class="o">.</span><span class="n">calc_Kel</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">el</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
                <span class="n">el</span><span class="o">.</span><span class="n">epl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">bcr0</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">bct0</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bct_mem</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bcr_mem</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bcr0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcr_mem</span>
            <span class="n">bct0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bct_mem</span>
        <span class="n">ul</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uleft</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubot</span>
        <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupK</span><span class="p">()</span>  <span class="c1"># assemble system stiffness matrix from element stiffness matrices</span>
        
        <span class="s1">&#39;define loop for external load steps (BC subdivision)&#39;</span>
        <span class="s1">&#39;during each load step mechanical equilibrium is calculated for sub-step&#39;</span>
        <span class="s1">&#39;the tangent stiffness matrix of the last load step is used as initial guess&#39;</span>
        <span class="s1">&#39;current tangent stiffness matrix compatible with BC is determined iteratively&#39;</span>
        <span class="n">il</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bc_inc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">bc_inc</span><span class="p">:</span>
            <span class="s1">&#39;define global increments for boundary conditions&#39;</span>
            <span class="k">if</span> <span class="n">min_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_dbct</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_dbct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bct</span> <span class="o">-</span> <span class="n">bct0</span>
                <span class="n">max_dbcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcr</span> <span class="o">-</span> <span class="n">bcr0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">min_step</span><span class="o">-</span><span class="n">il</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">max_dbct</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_dbct</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bct</span><span class="o">-</span><span class="n">bct0</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span>
                <span class="n">max_dbcr</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcr</span><span class="o">-</span><span class="n">bcr0</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span>
            <span class="s1">&#39;calculate du and df fulfilling mech. equil. for max. load step consistent with stiffness matrix K&#39;</span>
            <span class="n">dbcr</span> <span class="o">=</span> <span class="n">max_dbcr</span>
            <span class="n">dbct</span> <span class="o">=</span> <span class="n">max_dbct</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">calc_BC</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ul</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">dbcr</span><span class="p">,</span> <span class="n">dbct</span><span class="p">)</span> <span class="c1"># consider BC for system of equ. </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Kred</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="c1"># Solve reduced system of equations</span>
            <span class="s1">&#39;calculate scaling factor for predictor step in case of non-linear model&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nonlin</span><span class="p">:</span>
                <span class="n">scale_bc</span> <span class="o">=</span> <span class="n">calc_scf</span><span class="p">()</span> <span class="c1"># calculate global predictor step to hit the yield surface</span>
                <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;##scaling factor&#39;</span><span class="p">,</span><span class="n">scale_bc</span><span class="p">)</span>
                <span class="n">dbcr</span> <span class="o">=</span> <span class="n">max_dbcr</span><span class="o">*</span><span class="n">scale_bc</span>  <span class="c1"># dbcr &gt;= self.bcr - bcr0</span>
                <span class="n">dbct</span> <span class="o">=</span> <span class="n">max_dbct</span><span class="o">*</span><span class="n">scale_bc</span>  <span class="c1"># dbct &lt;= self.bct - bct0</span>
                <span class="s1">&#39;calculate du and df fulfilling for scaled load step consistent with stiffness matrix K&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">calc_BC</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ul</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">dbcr</span><span class="p">,</span> <span class="n">dbct</span><span class="p">)</span> <span class="c1"># consider BC for system of equ.  </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Kred</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="c1"># Solve reduced system of equations</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">calc_el_yldfct</span><span class="p">()</span> <span class="c1"># evaluate elemental yld.fct. and  modify elem. stiffness matrix if required</span>
                <span class="n">conv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">f</span><span class="o">&lt;=</span><span class="n">ptol</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;**Load step #&#39;</span><span class="p">,</span><span class="n">il</span><span class="p">)</span>
                    <span class="n">fres</span> <span class="o">=</span> <span class="n">K</span><span class="o">@</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;yield function=&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="s1">&#39;residual forces on inner nodes=&#39;</span><span class="p">,</span><span class="n">fres</span><span class="p">[</span><span class="n">jin</span><span class="p">])</span>
                <span class="k">while</span> <span class="ow">not</span> <span class="n">conv</span><span class="p">:</span>
                    <span class="s1">&#39;if not converged with predictor step and initial stiffness matrix,&#39;</span>
                    <span class="s1">&#39;use tangent stiffness assigned to elements in &quot;calc_el_yldfct&quot;&#39;</span>
                    <span class="s1">&#39;same step size is used for initial predictor step&#39;</span>
                    <span class="n">K</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupK</span><span class="p">()</span>  <span class="c1"># assemble tangent stiffness matrix</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">ind</span> <span class="o">=</span> <span class="n">calc_BC</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">ul</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">dbcr</span><span class="p">,</span> <span class="n">dbct</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Kred</span><span class="p">(</span><span class="n">ind</span><span class="p">),</span> <span class="n">df</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span> <span class="c1"># solve du with current stiffness matrix</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">calc_el_yldfct</span><span class="p">()</span>
                    <span class="n">conv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">f</span><span class="o">&lt;=</span><span class="n">ptol</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;+++Inner load step #&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                        <span class="n">fres</span> <span class="o">=</span> <span class="n">K</span><span class="o">@</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">du</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;load increment right:&#39;</span><span class="p">,</span> <span class="n">dbcr</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;load increment top:&#39;</span><span class="p">,</span><span class="n">dbct</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;yield function=&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="s1">&#39;residual forces on inner nodes=&#39;</span><span class="p">,</span><span class="n">fres</span><span class="p">[</span><span class="n">jin</span><span class="p">])</span>
                        <span class="n">el</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;sig, disg, epl, depl, deps:&#39;</span><span class="p">,</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">dsig</span><span class="p">(),</span> <span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">,</span> <span class="n">el</span><span class="o">.</span><span class="n">depl</span><span class="p">(),</span> <span class="n">el</span><span class="o">.</span><span class="n">deps</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;</span><span class="mi">7</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">conv</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: No convergence achieved, abandoning&#39;</span><span class="p">)</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;conv,i,f,ptol,dbcr,dbct&#39;</span><span class="p">,</span><span class="n">conv</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">ptol</span><span class="p">,</span><span class="n">dbcr</span><span class="p">,</span><span class="n">dbct</span><span class="p">)</span>
                        <span class="n">conv</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">conv</span><span class="p">:</span>
                        <span class="n">dbcr</span> <span class="o">*=</span> <span class="mf">0.25</span>
                        <span class="n">dbct</span> <span class="o">*=</span> <span class="mf">0.25</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="s1">&#39;update internal variables with results of load step&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">du</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f</span> <span class="o">+=</span> <span class="n">K</span><span class="nd">@self</span><span class="o">.</span><span class="n">du</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
                <span class="n">el</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">eps_t</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">epl</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">depl</span><span class="p">()</span>
                <span class="n">el</span><span class="o">.</span><span class="n">sig</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">dsig</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span>
                    <span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="o">.</span><span class="n">set_workhard</span><span class="p">(</span><span class="n">peeq</span><span class="p">)</span>
            <span class="s1">&#39;update load step&#39;</span>
            <span class="n">il</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">bcr0</span> <span class="o">+=</span> <span class="n">dbcr</span>
            <span class="n">hl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bcr0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bcr</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-6</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bcr</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-9</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">bct0</span> <span class="o">+=</span> <span class="n">dbct</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">bct0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">bct</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-6</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bct</span><span class="p">)</span><span class="o">&gt;</span><span class="mf">1.e-9</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hr</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">bc_inc</span> <span class="o">=</span> <span class="n">hr</span> <span class="ow">or</span> <span class="n">hl</span>
            <span class="s1">&#39;store time dependent quantities&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_global</span><span class="p">()</span>  <span class="c1"># calculate global values for solution</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sgl</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sgl</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">egl</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">egl</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epgl</span><span class="p">,[</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;epl&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                <span class="n">fres</span> <span class="o">=</span> <span class="n">K</span><span class="nd">@self</span><span class="o">.</span><span class="n">du</span>  <span class="c1"># residual forces </span>
                <span class="n">fnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fres</span><span class="p">[</span><span class="n">jin</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># norm of residual nodal forces</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load increment &#39;</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">namebct</span><span class="p">,</span><span class="s1">&#39;top &#39;</span><span class="p">,</span><span class="n">bct0</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bct</span><span class="p">,</span><span class="s1">&#39;; last step &#39;</span><span class="p">,</span><span class="n">dbct</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Load increment &#39;</span><span class="p">,</span> <span class="n">il</span><span class="p">,</span> <span class="s1">&#39;total&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">namebcr</span><span class="p">,</span><span class="s1">&#39;rhs&#39;</span><span class="p">,</span><span class="n">bcr0</span><span class="p">,</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">bcr</span><span class="p">,</span><span class="s1">&#39;; last step &#39;</span><span class="p">,</span><span class="n">dbcr</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield function after &#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s1">&#39;steps: f=&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;; norm(f_node)=&#39;</span><span class="p">,</span><span class="n">fnorm</span><span class="p">)</span>
                <span class="c1">#print(&#39;BC strain: &#39;, np.around([self.glob[&#39;ebc1&#39;],self.glob[&#39;ebc2&#39;]],decimals=5))</span>
                <span class="c1">#print(&#39;BC stress: &#39;, np.around([self.glob[&#39;sbc1&#39;],self.glob[&#39;sbc2&#39;]],decimals=5))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global strain: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global stress: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Global plastic strain: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;epl&#39;</span><span class="p">],</span><span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bct_mem</span> <span class="o">=</span> <span class="n">bct0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bcr_mem</span> <span class="o">=</span> <span class="n">bcr0</span></div>

<div class="viewcode-block" id="Model.bcval"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.bcval">[docs]</a>    <span class="k">def</span> <span class="nf">bcval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate average displacement and total force at (boundary) nodes</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes : list</span>
<span class="sd">            List of nodes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">hux</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">huy</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">hfx</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">hfy</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">hux</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span>
            <span class="n">hfx</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">huy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">hfy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">hux</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="n">huy</span><span class="o">/</span><span class="n">n</span><span class="p">,</span> <span class="n">hfx</span><span class="p">,</span> <span class="n">hfy</span></div>
    
<div class="viewcode-block" id="Model.calc_global"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.calc_global">[docs]</a>    <span class="k">def</span> <span class="nf">calc_global</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate global quantities and store in Model.glob;</span>
<span class="sd">        homogenization done by averaging residual forces (sbc1/2) and displacements (ebc1/2) at boundary nodes </span>
<span class="sd">        or by averaging element quantities (sig, eps, epl)</span>
<span class="sd">        </span>
<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        Model.glob : dictionary</span>
<span class="sd">            Values for stress (&#39;sig&#39;), total strain (&#39;eps&#39;) and plastic strain (&#39;epl&#39;)</span>
<span class="sd">            as homogenized element solutions (Voigt tensors); values for (11)- and </span>
<span class="sd">            (22)-components of stress (&#39;sbc1&#39;,&#39;scb2&#39;) and total strain (&#39;ebc1&#39;, &#39;ebc2&#39;)</span>
<span class="sd">            as homogenized values of boundary nodes.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="s1">&#39;calculate global values from BC&#39;</span>
        <span class="n">uxl</span><span class="p">,</span> <span class="n">uyl</span><span class="p">,</span> <span class="n">fxl</span><span class="p">,</span> <span class="n">fyl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noleft</span><span class="p">)</span>
        <span class="n">uxr</span><span class="p">,</span> <span class="n">uyr</span><span class="p">,</span> <span class="n">fxr</span><span class="p">,</span> <span class="n">fyr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noright</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;ebc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">uxr</span><span class="o">-</span><span class="n">uxl</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">lenx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;sbc1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fxr</span><span class="o">-</span><span class="n">fxl</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">leny</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">thick</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">uxb</span><span class="p">,</span> <span class="n">uyb</span><span class="p">,</span> <span class="n">fxb</span><span class="p">,</span> <span class="n">fyb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nobot</span><span class="p">)</span>
            <span class="n">uxt</span><span class="p">,</span> <span class="n">uyt</span><span class="p">,</span> <span class="n">fxt</span><span class="p">,</span> <span class="n">fyt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bcval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notop</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;ebc2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">uyt</span><span class="o">-</span><span class="n">uyb</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">leny</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;sbc2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">fyt</span><span class="o">-</span><span class="n">fyb</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lenx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">thick</span><span class="p">)</span>
        <span class="s1">&#39;calculate global values from element solutions&#39;</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">epl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="n">sig</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="o">*</span><span class="n">el</span><span class="o">.</span><span class="n">Vel</span>
            <span class="n">eps</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="o">*</span><span class="n">el</span><span class="o">.</span><span class="n">Vel</span>
            <span class="n">epl</span> <span class="o">+=</span> <span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="o">*</span><span class="n">el</span><span class="o">.</span><span class="n">Vel</span>
        <span class="n">Vm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lenx</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">leny</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">thick</span>   <span class="c1"># Volume of model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span><span class="o">/</span><span class="n">Vm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;eps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">eps</span><span class="o">/</span><span class="n">Vm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">glob</span><span class="p">[</span><span class="s1">&#39;epl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epl</span><span class="o">/</span><span class="n">Vm</span></div>

<div class="viewcode-block" id="Model.plot"><a class="viewcode-back" href="../pyLabFEA.html#model.Model.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fsel</span><span class="p">,</span> <span class="n">mag</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">cdepth</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">showmesh</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shownodes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">vmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Produce graphical output: draw elements in deformed shape with color </span>
<span class="sd">        according to field variable &#39;fsel&#39;; uses matplotlib</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fsel   : str</span>
<span class="sd">            Field selector for library field, see Keyword Arguments for possible values</span>
<span class="sd">        mag    : float</span>
<span class="sd">            Magnification factor for displacements (optional, default: 10)</span>
<span class="sd">        cdepth : int</span>
<span class="sd">            Number of colors in colormap (optional, default: 20)</span>
<span class="sd">        showmesh : Boolean</span>
<span class="sd">            Set/unset plotting of lines for element edges (optional, default: True)</span>
<span class="sd">        shownodes: Boolean</span>
<span class="sd">            Set/unset plotting of nodes (optional, default: True)</span>
<span class="sd">        colormap : str</span>
<span class="sd">            Name of colormap to be used (optional, default: viridis)</span>
<span class="sd">        annot : Boolean</span>
<span class="sd">            Show annotations for x and y-axis (optional, default: True)</span>
<span class="sd">        file  : str</span>
<span class="sd">            If a filename is provided, plot is exported as PDF (optional, default: None)</span>
<span class="sd">            </span>
<span class="sd">        Keyword Arguments</span>
<span class="sd">        -----------------</span>
<span class="sd">        strain1  : </span>
<span class="sd">            total strain in horizontal direction</span>
<span class="sd">        strain2  :</span>
<span class="sd">            total strain in vertical direction</span>
<span class="sd">        stress1  : </span>
<span class="sd">            horizontal stress component</span>
<span class="sd">        stress2  : </span>
<span class="sd">            vertical stress component</span>
<span class="sd">        plastic1 :</span>
<span class="sd">            plastic strain in horizontal direction</span>
<span class="sd">        plastic2 :</span>
<span class="sd">            plastic strain in vertical direction</span>
<span class="sd">        seq      :</span>
<span class="sd">            equivalent stress (Hill-formulation for anisotropic plasticity)</span>
<span class="sd">        seqJ2    :</span>
<span class="sd">            equivalent J2 stress</span>
<span class="sd">        peeq     : </span>
<span class="sd">            equivalent plastic strain</span>
<span class="sd">        etot     : </span>
<span class="sd">            equivalent total strain</span>
<span class="sd">        ux       : </span>
<span class="sd">            horizontal displacement</span>
<span class="sd">        uy       : </span>
<span class="sd">            vertical displacement</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">,</span> <span class="n">cdepth</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">strain1</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{tot}</span><span class="s1">_</span><span class="si">{11}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">strain2</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{tot}</span><span class="s1">_</span><span class="si">{22}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">stress1</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_</span><span class="si">{11}</span><span class="s1">$ (MPa)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">stress2</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_</span><span class="si">{22}</span><span class="s1">$ (MPa)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">plastic1</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{pl}</span><span class="s1">_</span><span class="si">{11}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">plastic2</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{pl}</span><span class="s1">_</span><span class="si">{22}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">stress_eq</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">Stress</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">seq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">Mat</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">stress_eqJ2</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">Stress</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">sJ2</span><span class="p">()</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\sigma^\mathrm</span><span class="si">{J2}</span><span class="s1">_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">strain_peeq</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{pl}</span><span class="s1">_</span><span class="si">{eq}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">strain_etot</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$\epsilon^\mathrm</span><span class="si">{tot}</span><span class="s1">_</span><span class="si">{eq}</span><span class="s1">$ (%)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">disp_x</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">lenx</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$u_x$ (mm)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="k">def</span> <span class="nf">disp_y</span><span class="p">():</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[</span><span class="n">el</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">leny</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
            <span class="n">text_cb</span> <span class="o">=</span> <span class="s1">&#39;$u_y$ (mm)&#39;</span>
            <span class="k">return</span> <span class="n">hh</span><span class="p">,</span> <span class="n">text_cb</span>
        <span class="n">field</span><span class="o">=</span><span class="p">{</span>
            <span class="s1">&#39;strain1&#39;</span> <span class="p">:</span> <span class="n">strain1</span><span class="p">(),</span>
            <span class="s1">&#39;strain2&#39;</span> <span class="p">:</span> <span class="n">strain2</span><span class="p">(),</span>
            <span class="s1">&#39;stress1&#39;</span> <span class="p">:</span> <span class="n">stress1</span><span class="p">(),</span>
            <span class="s1">&#39;stress2&#39;</span> <span class="p">:</span> <span class="n">stress2</span><span class="p">(),</span>
            <span class="s1">&#39;plastic1&#39;</span><span class="p">:</span> <span class="n">plastic1</span><span class="p">(),</span>
            <span class="s1">&#39;plastic2&#39;</span><span class="p">:</span> <span class="n">plastic2</span><span class="p">(),</span>
            <span class="s1">&#39;seq&#39;</span>     <span class="p">:</span> <span class="n">stress_eq</span><span class="p">(),</span>
            <span class="s1">&#39;seqJ2&#39;</span>   <span class="p">:</span> <span class="n">stress_eqJ2</span><span class="p">(),</span>
            <span class="s1">&#39;peeq&#39;</span>    <span class="p">:</span> <span class="n">strain_peeq</span><span class="p">(),</span>
            <span class="s1">&#39;etot&#39;</span>    <span class="p">:</span> <span class="n">strain_etot</span><span class="p">(),</span>
            <span class="s1">&#39;ux&#39;</span>      <span class="p">:</span> <span class="n">disp_x</span><span class="p">(),</span>
            <span class="s1">&#39;uy&#39;</span>      <span class="p">:</span> <span class="n">disp_y</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="s1">&#39;define color value by mapping field value of element to interval [0,1]&#39;</span>
        <span class="n">val</span><span class="p">,</span> <span class="n">text_cb</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">fsel</span><span class="p">]</span>
        <span class="n">auto_scale</span> <span class="o">=</span> <span class="p">(</span><span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auto_scale</span> <span class="ow">and</span> <span class="p">(</span><span class="n">delta</span> <span class="o">&lt;</span> <span class="mf">0.1</span> <span class="ow">or</span> <span class="n">delta</span><span class="o">/</span><span class="n">vmax</span> <span class="o">&lt;</span> <span class="mf">0.04</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vmax</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">+=</span> <span class="mf">0.05</span>
                <span class="n">vmin</span> <span class="o">-=</span> <span class="mf">0.05</span>
            <span class="k">elif</span> <span class="n">vmax</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">*=</span> <span class="mf">1.02</span>
                <span class="n">vmin</span> <span class="o">*=</span> <span class="mf">0.98</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vmax</span> <span class="o">*=</span> <span class="mf">0.98</span>
                <span class="n">vmin</span> <span class="o">*=</span> <span class="mf">1.02</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="s1">&#39;create element plots&#39;</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="c1"># draw filled polygon for each element</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>       <span class="c1"># left node of current element</span>
                <span class="n">jh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>    <span class="c1"># right node of current element</span>
                <span class="n">ih1</span> <span class="o">=</span> <span class="n">ih</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>            <span class="c1"># position of ux in u vector</span>
                <span class="n">jh1</span> <span class="o">=</span> <span class="n">jh</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>            <span class="c1"># position of ux in u vector</span>
                <span class="n">hx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">ih</span><span class="p">]</span> <span class="o">+</span> <span class="n">mag</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">ih1</span><span class="p">]</span> <span class="c1"># x position of left node </span>
                <span class="n">hx2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">jh</span><span class="p">]</span> <span class="o">+</span> <span class="n">mag</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">jh1</span><span class="p">]</span> <span class="c1"># x position of right node</span>
                <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thick</span><span class="o">*</span><span class="mf">0.5</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="p">[</span><span class="n">hx1</span><span class="p">,</span> <span class="n">hx2</span><span class="p">,</span> <span class="n">hx2</span><span class="p">,</span> <span class="n">hx1</span><span class="p">]</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">hh</span><span class="p">,</span> <span class="o">-</span><span class="n">hh</span><span class="p">,</span> <span class="n">hh</span><span class="p">,</span> <span class="n">hh</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">ih</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">ih</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span>
                    <span class="n">hx</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">mag</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">hy</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mag</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">p</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">col</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">el</span><span class="p">)]))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">showmesh</span><span class="p">):</span>
                <span class="n">hx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">hy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># plot edges of elements</span>

        <span class="s1">&#39;plot nodes&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">shownodes</span><span class="p">):</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npos</span> <span class="o">+</span> <span class="n">mag</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">u</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dim</span><span class="o">==</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="n">hh</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">hx</span> <span class="o">=</span> <span class="n">hh</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">hy</span> <span class="o">=</span> <span class="n">hh</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">hx</span><span class="p">,</span> <span class="n">hy</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
 
        <span class="s1">&#39;add colorbar&#39;</span>
        <span class="n">axl</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.01</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">])</span>  <span class="c1">#[left, bottom, width, height]</span>
        <span class="c1"># for use in juypter note book: left = 1.01, for python: left = 0.86</span>
        <span class="n">norm</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cb1</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">axl</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">)</span>
        <span class="n">cb1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">text_cb</span><span class="p">)</span>
        <span class="s1">&#39;add axis annotations&#39;</span>
        <span class="k">if</span> <span class="n">annot</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x (mm)&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y (mm)&#39;</span><span class="p">)</span>
        <span class="s1">&#39;save plot to file if filename is provided&#39;</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyLabFEA</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyLabFEA.html">Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>
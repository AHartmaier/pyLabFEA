
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>material &#8212; pyLabFEA 2.0.53 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for material</h1><div class="highlight"><pre>
<span></span><span class="c1"># Module pylabfea.material</span>
<span class="sd">&#39;&#39;&#39;Module pylabfea.material introduces class ``Material`` that contains attributes and methods</span>
<span class="sd">needed for elastic-plastic material definitions in FEA. It also enables the training of </span>
<span class="sd">machine learning algorithms as yield functions for plasticity.</span>
<span class="sd">The module pylabfea.model is used to calculate mechanical properties of a defined material </span>
<span class="sd">under various loading conditions.</span>

<span class="sd">uses NumPy, MatPlotLib, sklearn and pyLabFEA.model</span>

<span class="sd">Version: 2.1 (2020-04-01)</span>
<span class="sd">Author: Alexander Hartmaier, ICAMS/Ruhr-University Bochum, April 2020</span>
<span class="sd">Email: alexander.hartmaier@rub.de</span>
<span class="sd">distributed under GNU General Public License (GPLv3)&#39;&#39;&#39;</span>
<span class="kn">from</span> <span class="nn">pylabfea.basic</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylabfea.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">svm</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="s1">&#39;==========================&#39;</span>
<span class="s1">&#39;define class for materials&#39;</span>
<span class="s1">&#39;==========================&#39;</span>
<div class="viewcode-block" id="Material"><a class="viewcode-back" href="../pyLabFEA.html#material.Material">[docs]</a><span class="k">class</span> <span class="nc">Material</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Define class for Materials including material parameters (attributes), constitutive relations (methods)</span>
<span class="sd">    and derived properties und various loading conditions (dictionary)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of material (optional, default: &#39;Material&#39;)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name    : str</span>
<span class="sd">        Name of material</span>
<span class="sd">    sy      : float</span>
<span class="sd">        Yield strength</span>
<span class="sd">    ML_yf   : Boolean</span>
<span class="sd">        Existence of trained machine learning (ML) yield function (default: False)</span>
<span class="sd">    ML_grad : Boolean</span>
<span class="sd">        Existence of trained ML gradient (default: False)</span>
<span class="sd">    Tresca  : Boolean</span>
<span class="sd">        Indicate if Tresca equivalent stress should be used (default: False)</span>
<span class="sd">    msg     : dictionary</span>
<span class="sd">        Messages returned</span>
<span class="sd">    prop    : dictionary</span>
<span class="sd">        Derived properties under defined load paths</span>
<span class="sd">    propJ2  : dictionary</span>
<span class="sd">        Derived properties in form of J2 equivalent stress</span>
<span class="sd">    sigeps  : dictionary</span>
<span class="sd">        Data of stress-strain curves under defined load paths</span>
<span class="sd">    C11, C12, C44 : float</span>
<span class="sd">        Anisotropic elastic constants</span>
<span class="sd">    E, nu  : float</span>
<span class="sd">        Isotropic elastic constants, Young modulus and Poisson number</span>
<span class="sd">    msparam : ditionary</span>
<span class="sd">        Dicitionary with microstructural parameters assigned to this material</span>
<span class="sd">    Ndof   : int</span>
<span class="sd">        degress of freedom for yield function, mandatory: 1:seq, 2:theta; optional: 3:work_hard, 4:texture)</span>
<span class="sd">        </span>
<span class="sd">    Keyword Arguments</span>
<span class="sd">    -----------------</span>
<span class="sd">    prop-propJ2 :</span>
<span class="sd">        Store properties of material (Hill-formulation or J2 formulation) in sub-dictonaries:</span>
<span class="sd">        &#39;stx&#39; (tensile horiz. stress), &#39;sty&#39; (tensile vert. stress),</span>
<span class="sd">        &#39;et2&#39; (equibiaxial tensile strain), &#39;ect&#39; (pure shear)</span>
<span class="sd">    stx-sty-et2-ect  : sub-dictionaries</span>
<span class="sd">        Store data for &#39;ys&#39; (float - yield strength), seq (array - eqiv. stress),</span>
<span class="sd">        &#39;eeq&#39; (array - equiv. total strain), &#39;peeq&#39; (array - equiv. plastic strain),</span>
<span class="sd">        &#39;sytel&#39; (str - line style for plot), &#39;name&#39; (str - name in legend)</span>
<span class="sd">    sigeps :</span>
<span class="sd">        Store tensorial stress strain data in sub-directories;</span>
<span class="sd">        Contains data for &#39;sig&#39; (2d-array - stress), &#39;eps&#39; (2d-array - strain),</span>
<span class="sd">        &#39;epl&#39; (2d-array - plastic strain)</span>
<span class="sd">    msparam :</span>
<span class="sd">        Store data on microstructure parameters: &#39;Npl&#39;, &#39;Nlc, &#39;Ntext&#39;, &#39;texture&#39;, &#39;peeq_max&#39;, &#39;work_hard&#39;, &#39;flow_stress&#39; </span>
<span class="sd">        are obtained from data analysis module. Other parameters can be added.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="s1">&#39;Methods&#39;</span>
    <span class="c1">#elasticity: define elastic material parameters C11, C12, C44</span>
    <span class="c1">#plasticity: define plastic material parameter sy, khard</span>
    <span class="c1">#epl_dot: calculate plastic strain rate</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Material&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Elasticity will be considered unless sy is set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ML_yf</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># use conventional plasticity unless trained ML functions exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ML_grad</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># use conventional gradient unless ML function exists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tresca</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># use J2 or Hill equivalent stress unless defined otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;yield_fct&#39;</span> <span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;gradient&#39;</span>  <span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prop</span> <span class="o">=</span> <span class="p">{</span>    <span class="c1"># stores strength and stress-strain data along given load paths</span>
            <span class="s1">&#39;stx&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;style&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;sty&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;style&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;et2&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;style&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;ect&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;style&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span> <span class="o">=</span> <span class="p">{</span>    <span class="c1"># stores J2 equiv strain data along given load paths</span>
            <span class="s1">&#39;stx&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;sty&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;et2&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;ect&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;ys&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;seq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;peeq&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigeps</span> <span class="o">=</span> <span class="p">{</span>    <span class="c1"># calculates strength and stress strain data along given load paths</span>
            <span class="s1">&#39;stx&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;epl&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;sty&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;epl&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;et2&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;epl&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">},</span>
            <span class="s1">&#39;ect&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sig&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;eps&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;epl&#39;</span><span class="p">:</span><span class="kc">None</span><span class="p">}</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Material.calc_yf"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.calc_yf">[docs]</a>    <span class="k">def</span> <span class="nf">calc_yf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">peeq</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">ana</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pred</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate yield function</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig  : (3,), (6,) or (3,N) array</span>
<span class="sd">            Principal stresses (Voigt stress, princ. stress, or array of princ. stresses</span>
<span class="sd">        peeq : float or array</span>
<span class="sd">            Equivalent plastic strain (scalar or same length as sig) (optional, default: 0)</span>
<span class="sd">        ana  : Boolean</span>
<span class="sd">            Indicator if analytical solution should be used, rather than ML yield fct (optional, default: False)</span>
<span class="sd">        pred : Boolean</span>
<span class="sd">            Indicator if prediction value should be returned, rather then decision function (optional, default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        f    : flot or 1d-array</span>
<span class="sd">            Yield function for given stress (same length as sig)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ML_yf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ana</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
                <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sig</span><span class="p">])</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">6</span><span class="p">,):</span>
                <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">p</span><span class="p">])</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
            <span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">polar_ang</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wh_cur</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_cur</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="n">pred</span><span class="p">:</span>
                <span class="c1"># use prediction, returns either -1 or +1</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;yield_fct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ML_yf-predict&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># use smooth decision function in range [-1,+1]</span>
                <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;yield_fct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;ML_yf-decision-fct&#39;</span>
            <span class="k">if</span> <span class="n">N</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sh</span> <span class="o">==</span><span class="p">():</span>  <span class="c1"># eqiv. stress</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="n">sig</span>
            <span class="k">elif</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">6</span><span class="p">,):</span>   <span class="c1"># Voigt stress</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">seq</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># calculate equiv. stress</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># array of princ. stresses</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_seq</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">+</span> <span class="n">peeq</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sflow</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;yield_fct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;analytical&#39;</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Material.ML_full_yf"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.ML_full_yf">[docs]</a>    <span class="k">def</span> <span class="nf">ML_full_yf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">ld</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate full ML yield function as distance of given stress to yield locus in loading direction.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig : Voigt stress tensor</span>
<span class="sd">            Stress</span>
<span class="sd">        ld  : (3,) array</span>
<span class="sd">            Vector of loading direction in princ. stress space (optional)</span>
<span class="sd">        verb : Boolean</span>
<span class="sd">            Indicate whether to be verbose in text output (optional, default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        yf : float</span>
<span class="sd">            Full ML yield function, i.e. distance of sig to yield locus</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">p</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_seq</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Full YF:seq, ld&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">seq</span><span class="o">&lt;</span><span class="mf">0.01</span> <span class="ow">and</span> <span class="n">ld</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yf</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">-</span> <span class="mf">0.85</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sflow</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">seq</span><span class="o">&gt;=</span><span class="mf">0.01</span><span class="p">):</span>
                <span class="n">ld</span> <span class="o">=</span> <span class="n">sp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sflow</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span><span class="o">/</span><span class="n">seq</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="n">ld</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ld</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.e-5</span><span class="p">:</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tresca</span><span class="p">:</span>
                    <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.4</span>
            <span class="n">x1</span><span class="p">,</span> <span class="n">infodict</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_yloc</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">ld</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">infodict</span><span class="p">[</span><span class="s1">&#39;fvec&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.e-3</span> <span class="ow">and</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">3.</span><span class="p">:</span>
                <span class="c1"># zero of ML yield fct. detected at x1*sy</span>
                <span class="n">yf</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">-</span> <span class="n">x1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_seq</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># zero of ML yield fct. not found: get conservative estimate</span>
                <span class="n">yf</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">-</span> <span class="mf">0.85</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sflow</span>
                <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning in calc_scf&#39;</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** detection not successful. yf=&#39;</span><span class="p">,</span> <span class="n">yf</span><span class="p">,</span><span class="s1">&#39;, seq=&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** optimization result (x1,y1,ier,msg):&#39;</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">ier</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">yf</span></div>

<div class="viewcode-block" id="Material.setup_yf_SVM"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.setup_yf_SVM">[docs]</a>    <span class="k">def</span> <span class="nf">setup_yf_SVM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
                     <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cyl</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inherit</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Initialize and train Support Vector Classifier (SVC) as machine learning (ML) yield function. Training and test</span>
<span class="sd">        data (features) are accepted as either 3D principle stresses or cylindrical stresses. ML yield functions can also be inherited</span>
<span class="sd">        from other materials with a ML yield function. Graphical output on the trained SVC yield function is possible.</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x   :  (N,2) or (N,3) array</span>
<span class="sd">            Training data either as Cartesian princ. stresses (N,3) or cylindrical stresses (N,2)</span>
<span class="sd">        cyl : Boolean</span>
<span class="sd">            Indicator for cylindrical stresses if x is has shape (N,3)</span>
<span class="sd">        y_train : 1d-array</span>
<span class="sd">            Result vector for training data (same size as x)</span>
<span class="sd">        x_test  : (N,2) or (N,3) array</span>
<span class="sd">            Test data either as Cartesian princ. stresses (N,3) or cylindrical stresses (N,2) (optional)</span>
<span class="sd">        y_test</span>
<span class="sd">            Result vector for test data (optional)</span>
<span class="sd">        C  : float</span>
<span class="sd">            Parameter for training of SVC (optional, default: 10)</span>
<span class="sd">        gamma  : float</span>
<span class="sd">            Parameter for kernel function of SVC (optional, default: 1)</span>
<span class="sd">        fs  : float</span>
<span class="sd">            Parameters for size of periodic continuation of training data (optional, default:0.1)</span>
<span class="sd">        inherit : object of class ``Material``</span>
<span class="sd">            Material from which trained ML function is inherited</span>
<span class="sd">        plot : Boolean</span>
<span class="sd">            Indicates if plot of decision function should be generated (optional, default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        train_sc : float</span>
<span class="sd">            Training score</span>
<span class="sd">        test_sc  : float</span>
<span class="sd">            test score</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="s1">&#39;transformation of princ. stress into cyl. coordinates&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gam_yf</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="s1">&#39;calculate scaling factors need for SVC training from microstructure parameters&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">])</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cyl</span><span class="p">:</span>
            <span class="s1">&#39;princ. stresses&#39;</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">polar_ang</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using principle stresses for training&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="s1">&#39;cylindrical stresses&#39;</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using cyclindrical stresses for training&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using work hardening data for training: </span><span class="si">%i</span><span class="s1"> data sets up to PEEQ=</span><span class="si">%6.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;peeq_max&#39;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
            <span class="n">X_train</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using texture data for training: </span><span class="si">%i</span><span class="s1"> data sets with texture_parameters in range [</span><span class="si">%4.2f</span><span class="s1">,</span><span class="si">%4.2f</span><span class="s1">]&#39;</span> 
                  <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Ntext&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="s1">&#39;copy left and right borders to enforce periodicity in theta&#39;</span>
        <span class="n">indr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">1.</span><span class="o">-</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">indl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">fs</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">Xr</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indr</span><span class="p">]</span>
        <span class="n">Xl</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">indl</span><span class="p">]</span>
        <span class="n">Xr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">2.</span>  <span class="c1"># shift angle theta</span>
        <span class="n">Xl</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">2.</span>
        <span class="n">Xh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Xr</span><span class="p">,</span> <span class="n">Xl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">yh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">[</span><span class="n">indr</span><span class="p">],</span> <span class="n">y_train</span><span class="p">[</span><span class="n">indl</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">Xh</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">y_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">yh</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="s1">&#39;coordinate transformation for test data&#39;</span>
        <span class="k">if</span> <span class="n">x_test</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Ntest</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span>
            <span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Ntest</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cyl</span><span class="p">:</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">polar_ang</span><span class="p">(</span><span class="n">x_test</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_test</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="p">:</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_test</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">X_test</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">x_test</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span> <span class="o">-</span> <span class="mf">1.</span>
        <span class="s1">&#39;define and fit SVC&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span><span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ML_yf</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="sd">&#39;&#39;&#39;if (ptol&gt;=1.):</span>
<span class="sd">            ptol=0.9</span>
<span class="sd">            print(&#39;Warning: ptol must be &lt;1 for ML yield function&#39;)&#39;&#39;&#39;</span>
        <span class="s1">&#39;calculate scores&#39;</span>
        <span class="n">train_sc</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">x_test</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">test_sc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">test_sc</span>  <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="s1">&#39;create plot if requested&#39;</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot of extended training data for SVM classification in 2D cylindrical stress space&#39;</span><span class="p">)</span>
            <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">-</span><span class="n">fs</span><span class="p">,</span> <span class="mf">1.</span><span class="o">+</span><span class="n">fs</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">feat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2500</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span><span class="p">]</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">feat</span><span class="p">)</span>
            <span class="n">hl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">X_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Paired</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;extended SVM yield function in training&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$theta/\pi$&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">/\sigma_y$&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">train_sc</span><span class="p">,</span> <span class="n">test_sc</span></div>
    
<div class="viewcode-block" id="Material.train_SVC"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.train_SVC">[docs]</a>    <span class="k">def</span> <span class="nf">train_SVC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">Nlc</span><span class="o">=</span><span class="mi">36</span><span class="p">,</span> <span class="n">Nseq</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Train SVC for all yield functions of the microstructures provided in msparam and for flow stresses to capture </span>
<span class="sd">        work hardening. In first step, the </span>
<span class="sd">        training data for each set is generated by creating stresses on the deviatoric plane and calculating their catgegorial</span>
<span class="sd">        yield function (&quot;-1&quot;: elastic, &quot;+1&quot;: plastic). Furthermore, axes in different dimensions for microstructural</span>
<span class="sd">        features are introduced that describe the relation between the different sets.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        C     : float</span>
<span class="sd">            Parameter needed for training process, larger values lead to more flexibility (optional, default: 10)</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Parameter of Radial Basis Function of SVC kernel, larger values, lead to faster decay of influence of individual </span>
<span class="sd">            support vectors, i.e., to more short ranged kernels (optional, default: 4)</span>
<span class="sd">        Nlc   : int </span>
<span class="sd">            Number of load cases to be condidered, will be overwritten if material has microstructure information (optional, default: 36)</span>
<span class="sd">        Nseq  : int</span>
<span class="sd">            Number of training as test data values to be generated in elastic regime, same number will be produced in plastic regime</span>
<span class="sd">            (optional, default: 25)</span>
<span class="sd">        extend : Boolean</span>
<span class="sd">            Indicate whether training data should be extended further into plastic regime (optional, default: True)</span>
<span class="sd">        plot  : Boolean</span>
<span class="sd">            Indicate if graphical output should be performed (optional, default: False)</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            Fontsize for graph annotations (optional, default: 16)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">---------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVM classification training&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="s1">&#39;augment raw data and create result vector (yield function) for all data on work hardening and textures&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Npl</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">Ntext</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Nlc</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Nlc&#39;</span><span class="p">]</span>
            <span class="n">Npl</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">]</span>
            <span class="n">Ntext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Ntext&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">extend</span><span class="p">:</span>
            <span class="n">Ne</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ne</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">N0</span> <span class="o">=</span> <span class="n">Nlc</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Nseq</span><span class="o">+</span><span class="n">Ne</span><span class="p">)</span> <span class="c1"># total number of training data points per level of PEEQ for each microstructure</span>
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">Ntext</span><span class="o">*</span><span class="n">Npl</span><span class="o">*</span><span class="n">N0</span>    <span class="c1"># total numberof training data points</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nt</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
        <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nt</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntext</span><span class="p">):</span>    <span class="c1"># loop over all textures</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npl</span><span class="p">):</span>  <span class="c1"># loop over work hardening levels for each texture</span>
                <span class="s1">&#39;create training data in entire deviatoric stress plane from raw data&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">sc_train</span><span class="p">,</span> <span class="n">yf_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sig_data</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="n">Nlc</span><span class="p">,</span> <span class="n">Nseq</span><span class="o">=</span><span class="n">Nseq</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sc_train</span><span class="p">,</span> <span class="n">yf_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_sig_data</span><span class="p">(</span><span class="n">syc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">,:,:],</span> 
                                                            <span class="n">sflow</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">],</span> <span class="n">Nseq</span><span class="o">=</span><span class="n">Nseq</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1">#sc_test, yf_test   = self.create_sig_data(syc=self.msparam[&#39;flow_stress&#39;][k,j,::12,:], Nseq=15, rand=False)</span>
                <span class="n">i0</span> <span class="o">=</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="n">Npl</span><span class="p">)</span><span class="o">*</span><span class="n">N0</span>
                <span class="n">i1</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">N0</span>
                <span class="n">xt</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sc_train</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                    <span class="n">xt</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                    <span class="n">xt</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
                <span class="n">yt</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="n">yf_train</span>
        <span class="sd">&#39;&#39;&#39;nth = int(N0/18)</span>
<span class="sd">        x_test = xt[::nth,0:2]</span>
<span class="sd">        y_test = yt[::nth]&#39;&#39;&#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%i</span><span class="s1"> training data sets created from </span><span class="si">%i</span><span class="s1"> microstructures, with </span><span class="si">%i</span><span class="s1"> flow stresses in </span><span class="si">%i</span><span class="s1"> load cases&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Nt</span><span class="p">,</span> <span class="n">Ntext</span><span class="p">,</span> <span class="n">Npl</span><span class="p">,</span> <span class="n">Nlc</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yt</span><span class="p">)</span><span class="o">&lt;=</span><span class="mf">0.99</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: result vector for yield function contains more categories than &quot;-1&quot; and &quot;+1&quot;. Will result in higher dimensional SVC.&#39;</span><span class="p">)</span>
            
        <span class="s1">&#39;Train SVC with data from all microstructures in data&#39;</span>
        <span class="n">train_sc</span><span class="p">,</span> <span class="n">test_sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setup_yf_SVM</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cyl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>   

        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set score: </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_sc</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="s1">&#39;plot ML yield loci with reference and test data&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot ML yield loci with reference curve and test data&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial yield locus plotted together with flow stresses for PEEQ in range [</span><span class="si">%6.3f</span><span class="s1">,</span><span class="si">%6.3f</span><span class="s1">]&#39;</span> 
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Initial yield locus plotted for texture parameter in range [</span><span class="si">%6.3f</span><span class="s1">,</span><span class="si">%6.3f</span><span class="s1">]&#39;</span> 
                      <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
                <span class="n">Npl</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># only plot initial yield surface</span>

            <span class="n">ncol</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">nrow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Npl</span><span class="o">*</span><span class="n">Ntext</span><span class="o">/</span><span class="n">ncol</span> <span class="o">+</span> <span class="mf">0.95</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">8</span><span class="o">*</span><span class="n">nrow</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="mi">36</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntext</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_microstructure</span><span class="p">(</span><span class="s1">&#39;texture&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">],</span> <span class="n">verb</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Npl</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">Npl</span><span class="o">/</span><span class="mi">5</span><span class="p">))):</span>
                    <span class="s1">&#39;Warning: x_test and y_test should be setup properly above!!!&#39;</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">((</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">Npl</span><span class="p">)</span><span class="o">*</span><span class="n">N0</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">Npl</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N0</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">N0</span><span class="o">/</span><span class="n">Nlc</span><span class="p">)))</span>
                    <span class="n">y_test</span> <span class="o">=</span> <span class="n">yt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                    <span class="n">x_test</span> <span class="o">=</span> <span class="n">xt</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span>
                    <span class="n">peeq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_workhard</span><span class="p">(</span><span class="n">peeq</span><span class="p">)</span>
                    <span class="n">iel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">y_test</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ipl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">y_test</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">x_test</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">sflow</span><span class="o">*</span><span class="mf">1.5</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nrow</span><span class="p">,</span> <span class="n">ncol</span><span class="p">,</span> <span class="n">j</span><span class="o">+</span><span class="n">k</span><span class="o">*</span><span class="n">Npl</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">x_test</span><span class="p">[</span><span class="n">ipl</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_test</span><span class="p">[</span><span class="n">ipl</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test data above yield point&#39;</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">x_test</span><span class="p">[</span><span class="n">iel</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">x_test</span><span class="p">[</span><span class="n">iel</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;b.&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;test data below yield point&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">syc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">,</span><span class="n">j</span><span class="p">,:,:]</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reference yield locus&#39;</span><span class="p">)</span>
                    <span class="s1">&#39;ML yield fct: find norm of princ. stess vector lying on yield surface&#39;</span>
                    <span class="n">snorm</span> <span class="o">=</span> <span class="n">sp_cart</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">sflow</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.5</span><span class="p">),</span> <span class="n">theta</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
                    <span class="n">x1</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_yloc</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">36</span><span class="p">),</span> <span class="n">args</span><span class="o">=</span><span class="n">snorm</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1.e-5</span><span class="p">)</span>
                    <span class="n">sig</span> <span class="o">=</span> <span class="n">snorm</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">s_yld</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">theta</span><span class="p">,</span> <span class="n">s_yld</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ML yield locus&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Flow stress, PEEQ=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39;, TP=&#39;</span>
                                  <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">)),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                    <span class="c1">#plt.xlabel(r&#39;$\theta$ (rad)&#39;, fontsize=fontsize-2)</span>
                    <span class="c1">#plt.ylabel(r&#39;$\sigma_{eq}$ (MPa)&#39;, fontsize=fontsize-2)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="o">.</span><span class="mi">95</span><span class="p">,</span><span class="mf">0.85</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Material.calc_fgrad"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.calc_fgrad">[docs]</a>    <span class="k">def</span> <span class="nf">calc_fgrad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">peeq</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ana</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate gradient to yield surface. Three different methods can be used: (i) analytical gradient to Hill-like yield</span>
<span class="sd">        function (default if no ML yield function exists - ML_yf=False), (ii) gradient to ML yield function (default if ML yield</span>
<span class="sd">        function exists - ML_yf=True; can be overwritten if ana=True), (iii) ML gradient fitted seperately from ML yield function</span>
<span class="sd">        (activated if ML_grad=True and ana=False)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig : (3,) or (N,3) array</span>
<span class="sd">            Principal stresses</span>
<span class="sd">        seq : float or (N,) array</span>
<span class="sd">            Equivalent stresses (optional)</span>
<span class="sd">        ana : Boolean</span>
<span class="sd">            Indicator if analytical solution should be used, rather than ML yield fct (optional, default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        fgrad : (3,) or (N,3) array</span>
<span class="sd">            Gradient to yield surface at given position in princ. stress space</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">fgrad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># sig is vector of principle stresses</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sig</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sh</span><span class="o">!=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Unknown format of stress in calc_fgrad&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ML_grad</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ana</span><span class="p">:</span>
            <span class="s1">&#39;use SVR fitted to gradient&#39;</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">sig</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad0</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;SVR gradient&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ML_yf</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ana</span><span class="p">:</span>
            <span class="s1">&#39;use numerical gradient of SVC yield fct. in sigma space&#39;</span>
            <span class="s1">&#39;gradient of rbf-Kernel function w.r.t. theta&#39;</span>
            <span class="k">def</span> <span class="nf">grad_rbf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xp</span><span class="p">):</span>
                <span class="n">hv</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">xp</span>
                <span class="n">hh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hv</span><span class="o">*</span><span class="n">hv</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># ||x-x&#39;||^2=sum_i(x_i-x&#39;_i)^2</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">gam_yf</span><span class="o">*</span><span class="n">hh</span><span class="p">)</span>
                <span class="n">arg</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">gam_yf</span><span class="o">*</span><span class="n">hv</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">grad</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">arg</span>
                <span class="k">return</span> <span class="n">grad</span>
            <span class="s1">&#39;define Jacobian of coordinate transformation&#39;</span>
            <span class="k">def</span> <span class="nf">Jac</span><span class="p">(</span><span class="n">sig</span><span class="p">):</span>
                <span class="k">global</span> <span class="n">flag</span>
                <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                <span class="n">hyd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span>  <span class="c1"># hydrostatic stress</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">-</span> <span class="n">hyd</span>  <span class="c1"># deviatoric princ. stress</span>
                <span class="n">vn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>  <span class="c1">#norm of stress vector</span>
                <span class="k">if</span> <span class="n">vn</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="p">:</span>
                    <span class="s1">&#39;only calculate Jacobian if sig&gt;0&#39;</span>
                    <span class="n">dseqds</span> <span class="o">=</span> <span class="mf">3.</span><span class="o">*</span><span class="n">dev</span><span class="o">/</span><span class="n">vn</span>
                    <span class="n">J</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">/=</span> <span class="mf">3.</span>
                    <span class="n">J</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">dseqds</span>
                    <span class="n">dsa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">a_vec</span><span class="p">)</span>
                    <span class="n">dsb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sig</span><span class="p">,</span><span class="n">b_vec</span><span class="p">)</span>
                    <span class="n">sc</span> <span class="o">=</span> <span class="n">dsa</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">dsb</span>
                    <span class="n">z</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="p">((</span><span class="n">a_vec</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">b_vec</span><span class="p">)</span><span class="o">/</span><span class="n">sc</span> <span class="o">-</span> <span class="n">dseqds</span><span class="o">/</span><span class="n">vn</span><span class="p">)</span>
                    <span class="n">J</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">J</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="p">))</span>
            <span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_seq</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="n">x</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">polar_ang</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&gt;=</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">peeq</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_wh</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>
                <span class="n">x</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms_cur</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">scale_text</span> <span class="o">-</span> <span class="mf">1.</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">dual_coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">sv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">svm_yf</span><span class="o">.</span><span class="n">support_vectors_</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">dKdt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dc</span><span class="o">*</span><span class="n">grad_rbf</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="n">sv</span><span class="p">))</span>
                <span class="n">fgrad</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Jac</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span><span class="nd">@np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">dKdt</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;gradient to ML_yf&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">h0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">d3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drucker</span><span class="o">/</span><span class="mf">3.</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">seq</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_seq</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">h0</span><span class="o">+</span><span class="n">h2</span><span class="p">)</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">h0</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h2</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">seq</span> <span class="o">+</span> <span class="n">d3</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">h1</span><span class="o">+</span><span class="n">h0</span><span class="p">)</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h0</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">h1</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="n">seq</span> <span class="o">+</span> <span class="n">d3</span>
            <span class="n">fgrad</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">h2</span><span class="o">+</span><span class="n">h1</span><span class="p">)</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">h2</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">h1</span><span class="o">*</span><span class="n">sig</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">seq</span> <span class="o">+</span> <span class="n">d3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">[</span><span class="s1">&#39;gradient&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;analytical&#39;</span>
        <span class="k">if</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">fgrad</span> <span class="o">=</span> <span class="n">fgrad</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">return</span> <span class="n">fgrad</span></div>

<div class="viewcode-block" id="Material.setup_fgrad_SVM"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.setup_fgrad_SVM">[docs]</a>    <span class="k">def</span> <span class="nf">setup_fgrad_SVM</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X_grad_train</span><span class="p">,</span> <span class="n">y_grad_train</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Inititalize and train SVM regression for gradient evaluation</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        X_grad_train : (N,3) array</span>
<span class="sd">        y_grad_train : (N,) array</span>
<span class="sd">        C     : float</span>
<span class="sd">            Paramater for training of Support Vector Regression (SVR) (optional, default:10)</span>
<span class="sd">        gamma : float</span>
<span class="sd">            Parameter for kernel of SVR (optional, default: 0.1)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="s1">&#39;define support vector regressor parameters&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad0</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
              <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shrinking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad1</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
              <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shrinking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad2</span> <span class="o">=</span> <span class="n">svm</span><span class="o">.</span><span class="n">SVR</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">3000</span><span class="p">,</span> <span class="n">coef0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
              <span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">shrinking</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="s1">&#39;fit SVM to training data&#39;</span>
        <span class="n">X_grad_train</span> <span class="o">=</span> <span class="n">X_grad_train</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
        <span class="n">gmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">y_grad_train</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">y_grad_train</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gscale</span> <span class="o">=</span> <span class="n">gmax</span> <span class="o">-</span> <span class="n">gmin</span>
        <span class="n">y_grad_train0</span> <span class="o">=</span> <span class="n">y_grad_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y_grad_train1</span> <span class="o">=</span> <span class="n">y_grad_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">y_grad_train2</span> <span class="o">=</span> <span class="n">y_grad_train</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">gscale</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad0</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_grad_train</span><span class="p">,</span> <span class="n">y_grad_train0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad1</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_grad_train</span><span class="p">,</span> <span class="n">y_grad_train1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">svm_grad2</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_grad_train</span><span class="p">,</span> <span class="n">y_grad_train2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ML_grad</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Material.calc_seq"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.calc_seq">[docs]</a>    <span class="k">def</span> <span class="nf">calc_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sprinc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate generalized equivalent stress from pricipal stresses;</span>
<span class="sd">        equivalent to J2 for isotropic flow behavior and tension compression invariance;</span>
<span class="sd">        Hill-type approach for anisotropic plastic yielding;</span>
<span class="sd">        Drucker-like approach for tension-compression assymetry</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sprinc : (3,), (N,3) or (N,6) array</span>
<span class="sd">            Principal stress values</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        seq : float or (N,) array</span>
<span class="sd">            Hill-Drucker-type equivalent stress</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sprinc</span><span class="p">)</span>
        <span class="n">sh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">sprinc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># sprinc is single principle stress vector</span>
            <span class="n">sprinc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sprinc</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">sprinc</span>
            <span class="n">sprinc</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                <span class="n">sprinc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span><span class="o">.</span><span class="n">p</span>
        <span class="k">elif</span> <span class="n">sh</span><span class="o">!=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** calc_seq: N, sh&#39;</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Unknown format of stress in calc_seq&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tresca</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">sprinc</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">sprinc</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d12</span> <span class="o">=</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">d23</span> <span class="o">=</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">d31</span> <span class="o">=</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">sprinc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">=</span> <span class="n">h2</span> <span class="o">=</span> <span class="mf">1.</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">h1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">h2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hill</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">d0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">drucker</span>
            <span class="c1"># consider anisotropy in flow behavior in second invariant in Hill-type approach</span>
            <span class="n">I2</span>  <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">h0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">d12</span><span class="p">)</span> <span class="o">+</span> <span class="n">h1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">d23</span><span class="p">)</span> <span class="o">+</span> <span class="n">h2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">d31</span><span class="p">))</span>
            <span class="c1"># consider hydrostatic stresses for tension-compression assymetry</span>
            <span class="n">I1</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">sprinc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span>
            <span class="n">seq</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">I2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d0</span><span class="o">*</span><span class="n">I1</span>   <span class="c1"># generalized eqiv. stress</span>
        <span class="k">if</span> <span class="n">sh</span><span class="o">==</span><span class="p">(</span><span class="mi">3</span><span class="p">,):</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">seq</span></div>

<div class="viewcode-block" id="Material.elasticity"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.elasticity">[docs]</a>    <span class="k">def</span> <span class="nf">elasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C11</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C12</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">C44</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># standard parameters for crystals with cubic symmetry</span>
                   <span class="n">CV</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>                            <span class="c1"># user specified Voigt matrix</span>
                   <span class="n">E</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>                   <span class="c1"># parameters for isotropic material</span>
        <span class="sd">&#39;&#39;&#39;Define elastic material properties</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        C11 : float</span>
<span class="sd">        C12 : float</span>
<span class="sd">        C44 : float</span>
<span class="sd">            Anisoptropic elastic constants of material (optional,</span>
<span class="sd">            if (C11,C12,C44) not given, either (E,nu) or CV must be specified)</span>
<span class="sd">        E   : float</span>
<span class="sd">        nu  : float</span>
<span class="sd">            Isotropic parameters Young&#39;s modulus and Poisson&#39;s number (optional,</span>
<span class="sd">            if (E,nu) not given, either (C11,C12,C44) or CV must be specified)</span>
<span class="sd">        CV  : (6,6) array</span>
<span class="sd">            Voigt matrix of elastic constants (optional, if CV not given, either</span>
<span class="sd">            (C11,C12,C44) or (E,nu) must be specified)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">E</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Inconsistent definition of material parameters: Only E provided&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">C11</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span><span class="ow">or</span><span class="p">(</span><span class="n">C12</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span><span class="ow">or</span><span class="p">(</span><span class="n">C44</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Inconsistent definition of material parameters: E provided together with C_ij&#39;</span><span class="p">)</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">E</span><span class="o">/</span><span class="p">((</span><span class="mf">1.</span><span class="o">+</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">nu</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C11</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="n">hh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C12</span> <span class="o">=</span> <span class="n">nu</span><span class="o">*</span><span class="n">hh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C44</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="n">nu</span><span class="p">)</span><span class="o">*</span><span class="n">hh</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">C11</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nu</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Inconsistent definition of material parameters: nu provided together with C_ij&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">C12</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span><span class="ow">or</span><span class="p">(</span><span class="n">C44</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Inconsistent definition of material parameters: C_12 or C_44 values missing&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C11</span> <span class="o">=</span> <span class="n">C11</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C12</span> <span class="o">=</span> <span class="n">C12</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">C44</span> <span class="o">=</span> <span class="n">C44</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">C12</span><span class="o">/</span><span class="p">(</span><span class="n">C11</span><span class="o">+</span><span class="n">C12</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">C44</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span> <span class="c1"># only for isotropy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: E and nu calculated from anisotropic elastic parameters&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">CV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">CV</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">CV</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">CV</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span> <span class="c1"># only for isotropy</span>
            <span class="c1">#print(&#39;Warning: E and nu calculated from anisotropic elastic parameters&#39;)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error: Inconsistent definition of material parameters&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Material.plasticity"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.plasticity">[docs]</a>    <span class="k">def</span> <span class="nf">plasticity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">hill</span><span class="o">=</span><span class="p">[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">drucker</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">khard</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">Tresca</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define plastic material parameters; anisotropic Hill-like and Drucker-like</span>
<span class="sd">        behavior is supported</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sy   : float</span>
<span class="sd">            Yield strength</span>
<span class="sd">        hill : (3,) array</span>
<span class="sd">            Parameters for Hill-like orthotropic anisotropy (optional, default: isotropy)</span>
<span class="sd">        drucker : float</span>
<span class="sd">            Parameter for Drucker-like tension-compression asymmetry (optional, default: 0)</span>
<span class="sd">        khard: float</span>
<span class="sd">            Paramater for linear strain hardening (optional, default: 0)</span>
<span class="sd">        Tresca : Boolean</span>
<span class="sd">            Indicate if Tresca equivalent stress should be used (optional, default: False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="n">sy</span>   <span class="c1"># yield strength</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sflow</span> <span class="o">=</span> <span class="n">sy</span> <span class="c1"># initialize flow stress (will be increase with work hardening)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">khard</span> <span class="o">=</span> <span class="n">khard</span>  <span class="c1"># work hardening rate (linear w.h.)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span> <span class="o">=</span> <span class="n">khard</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">khard</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>  <span class="c1"># constant for w.h.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hill</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hill</span><span class="p">)</span>  <span class="c1"># Hill anisotropic parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drucker</span> <span class="o">=</span> <span class="n">drucker</span>   <span class="c1"># Drucker-Prager parameter: weight of hydrostatic stress</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tresca</span> <span class="o">=</span> <span class="n">Tresca</span></div>

<div class="viewcode-block" id="Material.microstructure"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.microstructure">[docs]</a>    <span class="k">def</span> <span class="nf">microstructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">grain_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grain_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">porosity</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define microstructural parameters of the material: crstallographic texture, grain size, grain shape</span>
<span class="sd">        and porosity.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data : Object of class ``Data``</span>
<span class="sd">            Assign data to microstructure of material</span>
<span class="sd">        grain_size : float</span>
<span class="sd">            Average grain size of material (optional)</span>
<span class="sd">        grain_shape : (3,) array</span>
<span class="sd">            Lengths of the three main axes of ellipsoid describing grain shape (optional)</span>
<span class="sd">        porosity : float</span>
<span class="sd">            Porosity of the material</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="s1">&#39;import dictionary will all microstructure parameters resulting from data module&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span> <span class="o">=</span> <span class="n">param</span> 
        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&lt;</span><span class="mi">3</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span> <span class="o">=</span> <span class="mi">3</span>   <span class="c1"># add dof for work hardening</span>
        <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;Ntext&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span><span class="o">&lt;</span><span class="mi">4</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndof</span> <span class="o">=</span> <span class="mi">4</span>   <span class="c1"># add dof for texture</span>
        <span class="s1">&#39;add additional microstructure information&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;grain_size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grain_size</span>  <span class="c1"># add further microstructure parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;grain_shape&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">grain_shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;porosity&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">porosity</span>        </div>
        
<div class="viewcode-block" id="Material.set_microstructure"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.set_microstructure">[docs]</a>    <span class="k">def</span> <span class="nf">set_microstructure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set current microstrcuture of material if material has variable microstructure</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        active  : str</span>
<span class="sd">            Active microstructure component from dictionary ``msparam``</span>
<span class="sd">        current : float</span>
<span class="sd">            Value of currently active microstructure parameter</span>
<span class="sd">        verb : Boolean</span>
<span class="sd">            Be verbose </span>
<span class="sd">            </span>
<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        Material.ms_act : str</span>
<span class="sd">            Keyword of active microstructure component, e.g. &#39;texture&#39;</span>
<span class="sd">        Material.ms_cur : float</span>
<span class="sd">            Current value of microstructural parameter for active microstructure</span>
<span class="sd">        Material.sy  : float</span>
<span class="sd">            Yield stength is redefined accoring to texture parameter</span>
<span class="sd">        Material.khard, Material.Hpr : float</span>
<span class="sd">            Work hardening parameters are redefined according to texture parameter</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms_act</span> <span class="o">=</span> <span class="n">active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms_cur</span> <span class="o">=</span> <span class="n">current</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="n">active</span><span class="p">]</span> <span class="o">-</span> <span class="n">current</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">hh</span><span class="p">))</span>
        <span class="s1">&#39;redefine plasticity parameters according to texture parameter&#39;</span>
        <span class="c1">#print(active, current, self.msparam[active],self.msparam[&#39;flow_seq_av&#39;][self.ms_index,0])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">current</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="n">active</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="s1">&#39;set strain hardening parameters to initial value for selected texture&#39;</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># assuming isotropic hardening</span>
            <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span> <span class="o">=</span>  <span class="n">ds</span><span class="o">/</span><span class="n">de</span> <span class="c1"># linear work hardening rate b/w values for w.h. in data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">khard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>  <span class="c1"># constant for w.h.</span>
        <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;New microstructure selected: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;ms_name&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">],</span>
                  <span class="s1">&#39;(Norm parameter:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">],</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Actual microstructure parameter:&#39;</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield strength:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Work hardening modulus:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">khard</span><span class="p">,</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="Material.set_workhard"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.set_workhard">[docs]</a>    <span class="k">def</span> <span class="nf">set_workhard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">peeq</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set current status of work hardening.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        peeq : float</span>
<span class="sd">            Current value of equivalent plastic strain </span>
<span class="sd">            </span>
<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        Material.wh_cur : float</span>
<span class="sd">            Work hardening parameter or microstructural value of equiv. plastic</span>
<span class="sd">            strain, which is the mechanical peeq plus the critical value for yield onset.</span>
<span class="sd">        Material.sflow : float</span>
<span class="sd">            Flow stress associated with work hardening parameter</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wh_cur</span> <span class="o">=</span> <span class="n">peeq</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sflow</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wh_cur</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">],</span> 
                                <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">,:])</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">wh_cur</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">hh</span><span class="o">&lt;=</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i0</span> <span class="o">=</span> <span class="n">ind</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># index of w.h. parameter with value just below peeq</span>
            <span class="n">i1</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">i1</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;Npl&#39;</span><span class="p">]:</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">,</span><span class="n">i1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">ms_index</span><span class="p">,</span><span class="n">i0</span><span class="p">]</span> <span class="c1"># assuming isotropic hardening</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">msparam</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">][</span><span class="n">i0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span> <span class="o">=</span>  <span class="n">ds</span><span class="o">/</span><span class="n">de</span> <span class="c1"># linear work hardening rate b/w values for w.h. in data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">khard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>  <span class="c1"># constant for w.h.</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="s1">&#39;assume ideal plasticity after last data point&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">khard</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">verb</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Currect work hardening parameter:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">wh_cur</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current flow stress (MPa): &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sflow</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Yield strength:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Work hardening modulus:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">khard</span><span class="p">,</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Material.epl_dot"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.epl_dot">[docs]</a>    <span class="k">def</span> <span class="nf">epl_dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">epl</span><span class="p">,</span> <span class="n">Cel</span><span class="p">,</span> <span class="n">deps</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate plastic strain increment relaxing stress back to yield locus;</span>
<span class="sd">        Reference: M.A. Crisfield, Non-linear finite element analysis of solids and structures,</span>
<span class="sd">        Chapter 6, Eqs. (6.4), (6.8) and (6.17)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig : Voigt tensor</span>
<span class="sd">            Stress</span>
<span class="sd">        epl : Voigt tensor</span>
<span class="sd">            Plastic strain</span>
<span class="sd">        Cel : (6,6) array</span>
<span class="sd">            Elastic stiffnes tensor</span>
<span class="sd">        deps: Voigt tensor</span>
<span class="sd">            Strain increment from predictor step</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pdot : Voigt tensor</span>
<span class="sd">            Plastic strain increment</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">epl</span><span class="p">)</span>     <span class="c1"># equiv. plastic strain</span>
        <span class="n">yfun</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">sig</span><span class="o">+</span><span class="n">Cel</span><span class="nd">@deps</span><span class="p">,</span> <span class="n">peeq</span><span class="o">=</span><span class="n">peeq</span><span class="p">)</span>
        <span class="c1">#for DEBUGGING</span>
        <span class="sd">&#39;&#39;&#39;yf0  = self.calc_yf(sig, peeq=peeq)</span>
<span class="sd">        if yf0&lt;-ptol and yfun&gt;ptol and peeq&lt;1.e-5:</span>
<span class="sd">            if self.ML_yf:</span>
<span class="sd">                ds = Cel@deps</span>
<span class="sd">                yfun = self.ML_full_yf(sig+ds)</span>
<span class="sd">            print(&#39;*** Warning in epl_dot: Step crosses yield surface&#39;)</span>
<span class="sd">            print(&#39;sig, epl, deps, yfun, yf0, peeq,caller&#39;, sig, epl, deps, yfun, yf0, peeq, sys._getframe().f_back.f_code.co_name)</span>
<span class="sd">            yfun=0. # catch error that can be produced for anisotropic materials&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">yfun</span><span class="o">&lt;=</span><span class="n">ptol</span><span class="p">):</span>
            <span class="n">pdot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fgrad</span><span class="p">(</span><span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Cel</span> <span class="o">@</span> <span class="n">a</span> <span class="o">+</span> <span class="mf">4.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span>
            <span class="n">lam_dot</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Cel</span> <span class="o">@</span> <span class="n">deps</span> <span class="o">/</span> <span class="n">hh</span>  <span class="c1"># deps must not contain elastic strain components</span>
            <span class="n">pdot</span> <span class="o">=</span> <span class="n">lam_dot</span> <span class="o">*</span> <span class="n">a</span>
        <span class="k">return</span> <span class="n">pdot</span></div>

<div class="viewcode-block" id="Material.C_tan"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.C_tan">[docs]</a>    <span class="k">def</span> <span class="nf">C_tan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">Cel</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculate tangent stiffness relaxing stress back to yield locus;</span>
<span class="sd">        Reference: M.A. Crisfield, Non-linear finite element analysis of solids and structures,</span>
<span class="sd">        Chapter 6, Eqs. (6.9) and (6.18)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig : Voigt tensor</span>
<span class="sd">            Stress</span>
<span class="sd">        Cel : (6,6) array</span>
<span class="sd">            Elastic stiffness tensor used for predictor step</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Ct : (6,6) array</span>
<span class="sd">            Tangent stiffness tensor</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_fgrad</span><span class="p">(</span><span class="n">Stress</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span><span class="o">.</span><span class="n">princ</span><span class="p">)</span>
        <span class="n">hh</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Cel</span> <span class="o">@</span> <span class="n">a</span> <span class="o">+</span> <span class="mf">4.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Hpr</span>
        <span class="n">ca</span> <span class="o">=</span> <span class="n">Cel</span> <span class="o">@</span> <span class="n">a</span>
        <span class="n">Ct</span> <span class="o">=</span> <span class="n">Cel</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">ca</span><span class="p">,</span> <span class="n">ca</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span><span class="o">/</span><span class="n">hh</span>
        <span class="k">return</span> <span class="n">Ct</span></div>

<div class="viewcode-block" id="Material.create_sig_data"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.create_sig_data">[docs]</a>    <span class="k">def</span> <span class="nf">create_sig_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mat_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">syc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Nseq</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">sflow</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offs</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rand</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Function to create consistent data sets on the deviatoric stress plane</span>
<span class="sd">        for training or testing of ML yield function. Either the number &quot;N&quot; of raw data points, i.e. load angles, to be </span>
<span class="sd">        generated and a reference material &quot;mat_ref&quot; has to be provided, or a list of raw data points &quot;syc&quot; with </span>
<span class="sd">        cylindrical stress tensors lying on the yield surface serves as input. Based on the raw data, stress tensors </span>
<span class="sd">        from the yield locus are distributed into the entire deviatoric space, by linear downscaling into the elastic </span>
<span class="sd">        region and upscaling into the plastic region. Data is created in form of cylindrical stresses that lie densly </span>
<span class="sd">        around the expected yield locus and more sparsely in the outer plastic region.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        N    : int</span>
<span class="sd">            Number of load cases (polar angles) to be created (optional,</span>
<span class="sd">            either N and mat_ref or syc must be provided)</span>
<span class="sd">        mat_ref : object of class ``Material``</span>
<span class="sd">            reference material needed to calculate yield function if only N is provided (optional, ignored if syc is given)</span>
<span class="sd">        syc: (N,3) array</span>
<span class="sd">            List of cyl. stress tensors lying on yield locus from which training data in entire deviatoric stress plane is created</span>
<span class="sd">            (optional, either syc or N and mat_ref must be provided)</span>
<span class="sd">        Nseq : int</span>
<span class="sd">            Number of equiv. stresses generated up to yield strength (optional, default: 12)</span>
<span class="sd">        sflow : float</span>
<span class="sd">            Expected flow stress of data set (optional, default: self.sy)</span>
<span class="sd">        offs : float</span>
<span class="sd">            Start of range for equiv. stress (optional, default: 0.01)</span>
<span class="sd">        extend : Boolean</span>
<span class="sd">            Create additional data in plastic regime (optional, default: False)</span>
<span class="sd">        rand   : Boolean</span>
<span class="sd">            Chose random load cases (polar angles) (optional, default: False)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        st : (M,3) array</span>
<span class="sd">            Cylindrical training stresses, M = N (2 Nseq + Nextend)</span>
<span class="sd">        yt : (M,) array</span>
<span class="sd">            Result vector of categorial yield function for supervised training</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sflow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sflow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
        <span class="k">if</span> <span class="n">syc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">N</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning in create_sig_data: Neither N not theta provided.&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Continuing with N=36&#39;</span><span class="p">)</span>
                <span class="n">N</span> <span class="o">=</span> <span class="mi">36</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rand</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">theta</span> <span class="o">=</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">syc</span><span class="p">)</span>
            <span class="n">sc</span>    <span class="o">=</span> <span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">theta</span> <span class="o">=</span> <span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">offs</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">sflow</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">Nseq</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span><span class="p">:</span>
            <span class="c1"># add training points in plastic regime to avoid fallback of SVC decision fct. to zero</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mf">4.</span><span class="p">,</span> <span class="mf">5.</span><span class="p">])</span><span class="o">*</span><span class="n">sflow</span><span class="p">)</span>
        <span class="n">Nd</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">*</span><span class="n">Nd</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">yt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">Nd</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nd</span><span class="p">):</span>
            <span class="n">j0</span> <span class="o">=</span> <span class="n">i</span><span class="o">*</span><span class="n">N</span>
            <span class="n">j1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N</span>
            <span class="n">st</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">st</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta</span>
            <span class="k">if</span> <span class="n">syc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yt</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">mat_ref</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">sp_cart</span><span class="p">(</span><span class="n">st</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span><span class="p">,:])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yt</span><span class="p">[</span><span class="n">j0</span><span class="p">:</span><span class="n">j1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">sc</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">st</span><span class="p">,</span> <span class="n">yt</span></div>

<div class="viewcode-block" id="Material.find_yloc"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.find_yloc">[docs]</a>    <span class="k">def</span> <span class="nf">find_yloc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sp</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Function to expand unit stresses by factor and calculate yield function;</span>
<span class="sd">        used by search algorithm to find zeros of yield function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x : 1d-array</span>
<span class="sd">            Multiplyer for stress</span>
<span class="sd">        sp : (N,3) array</span>
<span class="sd">            Principal stress</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        f : 1d-array</span>
<span class="sd">            Yield function evaluated at sig=x.sp</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">sp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">f</span></div>

<div class="viewcode-block" id="Material.ellipsis"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.ellipsis">[docs]</a>    <span class="k">def</span> <span class="nf">ellipsis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">72</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create ellipsis with main axis along 45 axis, used for graphical representation of isotropic yield locus.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        a : float</span>
<span class="sd">            Long half-axis of ellipsis (optional, default: 1)</span>
<span class="sd">        a : float</span>
<span class="sd">            Short half-axis of ellipsis (optional, default: 1/sqrt(3))</span>
<span class="sd">        n : int</span>
<span class="sd">            Number of points on ellipsis to be calculated</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : (n,) arrayy</span>
<span class="sd">            x and y coordinates of points on ellipsis</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">n</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

<div class="viewcode-block" id="Material.plot_data"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.plot_data">[docs]</a>    <span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plotting data in stress space to visualize yield loci.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Z   : array</span>
<span class="sd">            Data for field plot</span>
<span class="sd">        axs : handle</span>
<span class="sd">            Axes where plot is added</span>
<span class="sd">        xx  : meshgrid</span>
<span class="sd">            x-coordinates</span>
<span class="sd">        yy  : meshgrid</span>
<span class="sd">            y-coordinates</span>
<span class="sd">        field : Boolean</span>
<span class="sd">            Decide if field is plotted (optional, default: True)</span>
<span class="sd">        c   : str</span>
<span class="sd">            Color for contour line (optional, default: &#39;red&#39;)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        line : handle</span>
<span class="sd">            Reference to plotted line</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="s1">&#39;symmetrize Z values&#39;</span>
        <span class="n">zmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="n">zmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">zmin</span> <span class="o">&lt;</span> <span class="n">zmax</span><span class="p">):</span>
            <span class="n">Z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Z</span><span class="o">&gt;-</span><span class="n">zmin</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">zmin</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Z</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">Z</span><span class="o">&lt;-</span><span class="n">zmax</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="n">zmax</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="s1">&#39;display data&#39;</span>
        <span class="k">if</span> <span class="n">field</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
               <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">xx</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">yy</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
               <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">PuOr_r</span><span class="p">)</span>
            <span class="c1">#fig.colorbar(im, ax=axs)</span>
        <span class="n">contour</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">contour</span><span class="o">.</span><span class="n">collections</span>
        <span class="k">return</span> <span class="n">line</span></div>

<div class="viewcode-block" id="Material.plot_yield_locus"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.plot_yield_locus">[docs]</a>    <span class="k">def</span> <span class="nf">plot_yield_locus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trange</span><span class="o">=</span><span class="mf">1.e-2</span><span class="p">,</span>
                         <span class="n">xstart</span><span class="o">=-</span><span class="mf">2.</span><span class="p">,</span> <span class="n">xend</span><span class="o">=</span><span class="mf">2.</span><span class="p">,</span> <span class="n">axis1</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">iso</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ref_mat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">field</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">Nmesh</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot different cuts through yield locus in 3D principle stress space.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fun   : function handle</span>
<span class="sd">            Yield function to be plotted (optional, default: own yield function)</span>
<span class="sd">        label : str</span>
<span class="sd">            Label for yield function (optional, default: own name)</span>
<span class="sd">        data  : (N,3) array</span>
<span class="sd">            Stress data to be used for scatter plot (optional)</span>
<span class="sd">        trange : float</span>
<span class="sd">            Cut-off for data to be plotted on slice (optional, default: 1.e-2)</span>
<span class="sd">        xstart : float</span>
<span class="sd">            Smallest value on x-axis (optional, default: -2)</span>
<span class="sd">        xend   : float</span>
<span class="sd">            Largest value on x-axis (optional, default: 2)</span>
<span class="sd">        axis1 : list</span>
<span class="sd">            Cartesian stress coordinates to be plotted on x-axis of slices (optional, default: [0])</span>
<span class="sd">        axis2 : list</span>
<span class="sd">            Cartesian stress coordinates to be plotted on y-axis of slices (optional, default: [1])</span>
<span class="sd">        iso   : Boolean</span>
<span class="sd">            Decide if reference ellipsis for isotropic material is plotted (optional, default: False)</span>
<span class="sd">        ref_mat=None</span>
<span class="sd">            Reference material to plot yield locus (optional)</span>
<span class="sd">        field : Boolean</span>
<span class="sd">            Decide if field of yield function is plotted (optional, default: False)</span>
<span class="sd">        Nmesh : int</span>
<span class="sd">            Number of mesh points per axis on which yield function is evaluated (optional, default:100)</span>
<span class="sd">        file  : str</span>
<span class="sd">            File name for output of olot (optional)</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            Fontsize for axis annotations (optional, default: 20)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        axs : pyplot axis handle</span>
<span class="sd">            Axis of the plot</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">,</span> <span class="n">Nmesh</span><span class="p">),</span>
                         <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">,</span> <span class="n">Nmesh</span><span class="p">))</span>
        <span class="n">Nm2</span> <span class="o">=</span> <span class="n">Nmesh</span><span class="o">*</span><span class="n">Nmesh</span>
        <span class="n">Nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis1</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">axis2</span><span class="p">)</span><span class="o">!=</span><span class="n">Nc</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="s1">&#39;Error in plot_yield_locus: mismatch in dimensions of ax1 and ax2&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Nc</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
            <span class="n">fontsize</span> <span class="o">*=</span> <span class="mi">4</span><span class="o">/</span><span class="mi">5</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">Nc</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="s1">&#39;loop over subplots in axis1 and axis2&#39;</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nc</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">Nc</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">axs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">lines</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
            <span class="s1">&#39;select slice in 3D stress space&#39;</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">s2</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">s3</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="s1">&#39;first axis&#39;</span>
            <span class="k">if</span> <span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_1$&#39;</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_1 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_2$&#39;</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_2 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_3$&#39;</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_3 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;$p=\sigma_1=\sigma_2$&#39;</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;$p / \sigma_y$&#39;</span>
                <span class="n">ref</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning in plot_yield_locus: axis1 not defined properly, set to sig_1&#39;</span><span class="p">,</span> <span class="n">axis1</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">xx</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_1$&#39;</span>
                <span class="n">xlab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_1 / \sigma_y$&#39;</span>
            <span class="s1">&#39;second axis&#39;</span>
            <span class="k">if</span> <span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;-$\sigma_1$ slice&#39;</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_1 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;-$\sigma_2$ slice&#39;</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_2 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;-$\sigma_3$ slice&#39;</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_3 / \sigma_y$&#39;</span>
            <span class="k">elif</span> <span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;-$\sigma_3$ slice&#39;</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_3 / \sigma_y$&#39;</span>
                <span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning in plot_yield_locus: axis2 not defined properly, set to sig_2&#39;</span><span class="p">,</span> <span class="n">axis2</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;-$\sigma_2$ slice&#39;</span>
                <span class="n">ylab</span> <span class="o">=</span> <span class="s1">&#39;$\sigma_2 / \sigma_y$&#39;</span>
            <span class="n">si3</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># slice for data</span>
            <span class="k">if</span> <span class="n">s1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nm2</span><span class="p">)</span>
                <span class="n">si3</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">s2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nm2</span><span class="p">)</span>
                <span class="n">si3</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">s3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nm2</span><span class="p">)</span>
                <span class="n">si3</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">]</span>  <span class="c1"># set stresses for yield locus calculation</span>

            <span class="s1">&#39;evaluate yield function to be plotted&#39;</span>
            <span class="k">if</span> <span class="n">fun</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">sig</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">pred</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">sig</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">pred</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
            <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">hl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">label</span><span class="p">])</span>
            <span class="s1">&#39;plot reference function if provided&#39;</span>
            <span class="k">if</span> <span class="n">ref_mat</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">Z</span> <span class="o">=</span> <span class="n">ref_mat</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">sig</span><span class="o">*</span><span class="n">ref_mat</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">pred</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">/</span><span class="n">ref_mat</span><span class="o">.</span><span class="n">sy</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">ref_mat</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span>
            <span class="s1">&#39;plot ellipsis as reference if requested&#39;</span>
            <span class="k">if</span> <span class="n">iso</span><span class="p">:</span>
                <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ellipsis</span><span class="p">()</span>  <span class="c1"># reference for isotropic material</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="s1">&#39;-b&#39;</span><span class="p">)</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;isotropic J2&#39;</span><span class="p">])</span>
            <span class="s1">&#39;plot data if provided&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># select data from 3D stress space within range [xstart, xend] and to fit to slice</span>
                <span class="n">dat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span>
                <span class="n">dsel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dat</span><span class="p">[:,</span><span class="n">si3</span><span class="p">])</span><span class="o">&lt;</span><span class="n">trange</span><span class="p">,</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">dat</span><span class="p">[:,</span><span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">&gt;</span><span class="n">xstart</span><span class="p">,</span> <span class="n">dat</span><span class="p">[:,</span><span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span><span class="o">&lt;</span><span class="n">xend</span><span class="p">)))</span>
                <span class="n">ir</span> <span class="o">=</span> <span class="n">dsel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">yf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">calc_yf</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">ir</span><span class="p">,:]))</span>
                <span class="n">h1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">axis1</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">dat</span><span class="p">[</span><span class="n">ir</span><span class="p">,</span><span class="n">axis2</span><span class="p">[</span><span class="n">j</span><span class="p">]],</span> <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">yf</span><span class="p">,</span>
                                    <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Paired</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">lines</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="c1">#ax.set_title(title,fontsize=fontsize)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylab</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">6</span><span class="p">)</span>
        <span class="s1">&#39;save plot to file if filename is provided&#39;</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">axs</span></div>

<div class="viewcode-block" id="Material.calc_properties"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.calc_properties">[docs]</a>    <span class="k">def</span> <span class="nf">calc_properties</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">Nel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">verb</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">min_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sigeps</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Use pylabfea.model to calculate material strength and stress-strain data along a given load path.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        size : int</span>
<span class="sd">            Size of FE model (optional, defaul: 2)</span>
<span class="sd">        Nel : int</span>
<span class="sd">            Number of elements per axis (optional, defaul: 2)</span>
<span class="sd">        verb : Boolean</span>
<span class="sd">            Be verbose with output (optional, default: False)</span>
<span class="sd">        eps : float</span>
<span class="sd">            Maximum total strain (optional, default:0.005)</span>
<span class="sd">        min_step : int</span>
<span class="sd">            Minumum number of load steps (optional)</span>
<span class="sd">        sigeps : Boolean</span>
<span class="sd">            Decide if data for stress-strain curves in stored in dictionary Material.sigeps (optional, default: False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">calc_strength</span><span class="p">(</span><span class="n">vbc1</span><span class="p">,</span> <span class="n">nbc1</span><span class="p">,</span> <span class="n">vbc2</span><span class="p">,</span> <span class="n">nbc2</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
            <span class="n">fe</span><span class="o">=</span><span class="n">Model</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">planestress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">geom</span><span class="p">([</span><span class="n">size</span><span class="p">],</span> <span class="n">LY</span><span class="o">=</span><span class="n">size</span><span class="p">)</span> <span class="c1"># define section in absolute length</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">assign</span><span class="p">([</span><span class="bp">self</span><span class="p">])</span>        <span class="c1"># assign material to section</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">bcleft</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>            <span class="c1"># fix lhs nodes in x-direction</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">bcbot</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>             <span class="c1"># fix bottom nodes in y-direction</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">bcright</span><span class="p">(</span><span class="n">vbc1</span><span class="p">,</span> <span class="n">nbc1</span><span class="p">)</span>   <span class="c1"># define BC in x-direction</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">bctop</span><span class="p">(</span><span class="n">vbc2</span><span class="p">,</span> <span class="n">nbc2</span><span class="p">)</span>     <span class="c1"># define BC in y-direction</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">mesh</span><span class="p">(</span><span class="n">NX</span><span class="o">=</span><span class="n">Nel</span><span class="p">,</span> <span class="n">NY</span><span class="o">=</span><span class="n">Nel</span><span class="p">)</span>  <span class="c1"># create mesh</span>
            <span class="n">fe</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verb</span><span class="o">=</span><span class="n">verb</span><span class="p">,</span><span class="n">min_step</span><span class="o">=</span><span class="n">min_step</span><span class="p">)</span>      <span class="c1"># solve mechanical equilibrium condition under BC</span>
            <span class="n">seq</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_seq</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">sgl</span><span class="p">)</span>   <span class="c1"># store time dependent mechanical data of model</span>
            <span class="n">eeq</span>  <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">egl</span><span class="p">)</span>
            <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">epgl</span><span class="p">)</span>
            <span class="n">iys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">peeq</span><span class="o">&lt;</span><span class="mf">1.e-6</span><span class="p">)</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">iys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">ys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">seq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;eeq&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">eeq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;peeq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peeq</span>
            <span class="n">seq</span>  <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">sgl</span><span class="p">)</span>   <span class="c1"># store time dependent mechanical data of model</span>
            <span class="n">eeq</span>  <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">egl</span><span class="p">)</span>
            <span class="n">peeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="n">fe</span><span class="o">.</span><span class="n">epgl</span><span class="p">)</span>
            <span class="n">iys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">peeq</span><span class="o">&lt;</span><span class="mf">1.e-6</span><span class="p">)</span>  <span class="c1"># take stress at last index of elastic regime</span>
            <span class="n">ys</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">iys</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span>   <span class="o">=</span> <span class="n">ys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">seq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;eeq&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">eeq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;peeq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peeq</span>
            <span class="k">if</span> <span class="n">sigeps</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigeps</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">sgl</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigeps</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;eps&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">egl</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sigeps</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;epl&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fe</span><span class="o">.</span><span class="n">epgl</span>
            <span class="k">return</span>
        <span class="k">def</span> <span class="nf">calc_stx</span><span class="p">():</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">calc_strength</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="s1">&#39;stx&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;stx&#39;</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-r&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;stx&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;uniax-x&#39;</span>
            <span class="k">return</span>
        <span class="k">def</span> <span class="nf">calc_sty</span><span class="p">():</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">calc_strength</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="s1">&#39;force&#39;</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="s1">&#39;sty&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;sty&#39;</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-b&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;sty&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;uniax-y&#39;</span>
            <span class="k">return</span>
        <span class="k">def</span> <span class="nf">calc_et2</span><span class="p">():</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="mf">0.4</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">calc_strength</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="s1">&#39;et2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;et2&#39;</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-k&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;et2&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;equibiax&#39;</span>
            <span class="k">return</span>
        <span class="k">def</span> <span class="nf">calc_ect</span><span class="p">():</span>
            <span class="n">u1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.8</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">u2</span> <span class="o">=</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">eps</span><span class="o">*</span><span class="n">size</span>
            <span class="n">calc_strength</span><span class="p">(</span><span class="n">u1</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="s1">&#39;disp&#39;</span><span class="p">,</span> <span class="s1">&#39;ect&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ect&#39;</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;-m&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="s1">&#39;ect&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="s1">&#39;shear&#39;</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="p">{</span>    <span class="c1"># calculates strength and stress strain data along given load paths</span>
            <span class="s1">&#39;stx&#39;</span>   <span class="p">:</span> <span class="n">calc_stx</span><span class="p">(),</span>   <span class="c1"># uniaxial tensile yield strength in horizontal (x-)direction</span>
            <span class="s1">&#39;sty&#39;</span>   <span class="p">:</span> <span class="n">calc_sty</span><span class="p">(),</span>   <span class="c1"># uniaxial tensile yield strength in vertical (y-)direction</span>
            <span class="s1">&#39;et2&#39;</span>   <span class="p">:</span> <span class="n">calc_et2</span><span class="p">(),</span>   <span class="c1"># strength under plane stress, equibiaxial strain in x and y direction</span>
            <span class="s1">&#39;ect&#39;</span>   <span class="p">:</span> <span class="n">calc_ect</span><span class="p">()</span>    <span class="c1"># strength under pure shear strain (x-compression, y-tension), plane stress</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="Material.plot_stress_strain"><a class="viewcode-back" href="../pyLabFEA.html#material.Material.plot_stress_strain">[docs]</a>    <span class="k">def</span> <span class="nf">plot_stress_strain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Hill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot stress-strain data and print values for strength.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Hill : Boolean</span>
<span class="sd">            Decide if data for Hill-type equivalent stress is presented (optional, default: False)</span>
<span class="sd">        file : str</span>
<span class="sd">            Filename to save plot (optional)</span>
<span class="sd">        fontsize : int</span>
<span class="sd">            Fontsize for axis annotations (optional, default: 14)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">legend</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;J2 yield stress under&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="s1">&#39;loading:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;eeq&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">100.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">propJ2</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">])</span>
            <span class="n">legend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Material: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon_\mathrm</span><span class="si">{eq}</span><span class="s1">$ (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma^\mathrm</span><span class="si">{J2}</span><span class="s1">_\mathrm</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;J2.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Hill</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hill yield stress under&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span><span class="s1">&#39;loading:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;ys&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="s1">&#39;MPa&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---------------------------------------------------------&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;eeq&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">100.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;seq&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;style&#39;</span><span class="p">])</span>
                <span class="n">legend</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prop</span><span class="p">[</span><span class="n">sel</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Material: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon_\mathrm</span><span class="si">{eq}</span><span class="s1">$ (%)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_\mathrm</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;Hill.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyLabFEA</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyLabFEA.html">Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>
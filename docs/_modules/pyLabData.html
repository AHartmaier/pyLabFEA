
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>pyLabData &#8212; pyLabFEA 0.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pyLabData</h1><div class="highlight"><pre>
<span></span><span class="c1">#Module Data</span>
<span class="sd">&#39;&#39;&#39;Introduces a class for data resulting from virtual or physical mechanical tests</span>
<span class="sd">for use in pyLabFEA package.</span>

<span class="sd">uses NumPy, SciPy, MatPlotLib</span>

<span class="sd">Version: 2.0 (2020-03-31)</span>
<span class="sd">Author: Alexander Hartmaier, ICAMS/Ruhr-University Bochum, March 2020</span>
<span class="sd">Email: alexander.hartmaier@rub.de</span>
<span class="sd">distributed under GNU General Public License (GPLv3)&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">pyLabFEM</span> <span class="k">as</span> <span class="nn">FE</span>
<span class="kn">from</span> <span class="nn">pyLabMaterial</span> <span class="kn">import</span> <span class="n">Material</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="s1">&#39;=================&#39;</span>
<span class="s1">&#39;define data class&#39;</span>
<span class="s1">&#39;=================&#39;</span>
<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Define class for handling data from virtual mechanical tests in micromechanical </span>
<span class="sd">    simulations and data from physical mechanical tests on materials with various </span>
<span class="sd">    microstructures</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    msl  : list</span>
<span class="sd">        List with names of JOSN files with metadata for all microstructures</span>
<span class="sd">    path_data : str</span>
<span class="sd">        Trunc of pathname for data files</span>
<span class="sd">    path_json : str</span>
<span class="sd">        Trunc of pathname for JSON metadata files (Optional, default: path_data)</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of Dataset (optional, default: &#39;Dataset&#39;)</span>
<span class="sd">    nth  : int</span>
<span class="sd">        Read only every nth lines of input file (optional, default: 1)</span>
<span class="sd">    epl_crit : float</span>
<span class="sd">        Critical plastic strain at which yield strength is defined (optional, default: 2.e-3)</span>
<span class="sd">    d_ep     : float</span>
<span class="sd">        Range around critical value of plastic strain in which flow stresses are</span>
<span class="sd">        evaluated (optional, default: 5.e-4)</span>
<span class="sd">        </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    msl   : list</span>
<span class="sd">    Nset  : int</span>
<span class="sd">    name  : str</span>
<span class="sd">    pd    : str</span>
<span class="sd">    pj    : str</span>
<span class="sd">    epc   : float</span>
<span class="sd">    dep   : float</span>
<span class="sd">    set   : list</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msl</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">path_json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="n">nth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">epl_crit</span><span class="o">=</span><span class="mf">2.e-3</span><span class="p">,</span> <span class="n">d_ep</span><span class="o">=</span><span class="mf">5.e-4</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msl</span>  <span class="o">=</span> <span class="n">msl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="n">path_data</span>
        <span class="k">if</span> <span class="n">path_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pj</span> <span class="o">=</span> <span class="n">path_json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="n">nth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epc</span> <span class="o">=</span> <span class="n">epl_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dep</span> <span class="o">=</span> <span class="n">d_ep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">msl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>

        
<div class="viewcode-block" id="Data.Set"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.Set">[docs]</a>    <span class="k">class</span> <span class="nc">Set</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define class for handling of a dataset for one individual material </span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        db   : object of type ``Data``</span>
<span class="sd">            Parent database from which properties are inherited</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of JSON file with metadata for microstructure to be stored in this dataset</span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        db : object of class ``Data``</span>
<span class="sd">        name : str</span>
<span class="sd">        N  : int</span>
<span class="sd">        eps, epl, eel, sig, ang : (N,) array</span>
<span class="sd">        Ndat : int</span>
<span class="sd">        sfc, sfpr, peeq : (Ndat,) array</span>
<span class="sd">        f_yld : (Ndat,) array</span>
<span class="sd">        C11, C12 : float</span>
<span class="sd">        E, nu : float</span>
<span class="sd">    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">prop_elastic</span><span class="p">():</span>
                <span class="sd">&#39;&#39;&#39;calculate estimates for elastic properties E, nu associated to data set</span>
<span class="sd">                Note: should be calculated from micromechnical data</span>
<span class="sd">                &#39;&#39;&#39;</span>
                <span class="s1">&#39;select data points with eqiv. stress in range [0.1,0.4]sy&#39;</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">seq_J2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">seq</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">seq</span><span class="o">&lt;</span><span class="mf">0.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">seq_J2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="n">eeq</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eel</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">seq</span><span class="o">/</span><span class="n">eeq</span><span class="p">)</span>
            
                <span class="n">ssig</span> <span class="o">=</span> <span class="mf">1.e-2</span>
                <span class="n">seps</span> <span class="o">=</span> <span class="mf">1.e4</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">seps</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eel</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span>
                <span class="n">b</span> <span class="o">=</span> <span class="n">ssig</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">seps</span><span class="o">/</span><span class="n">ssig</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C11</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C12</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C13</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C21</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C22</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C23</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C31</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C32</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C33</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
                
                <span class="c1">#self.nu = self.C12/(self.C11 + self.C12) # estimate for isotropic materials</span>
                <span class="c1">#self.E = self.C12*(1.+self.nu)*(1.-2.*self.nu)/self.nu</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated elasic constants: E=</span><span class="si">%5.2f</span><span class="s1"> GPa, nu=</span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated elasic tensor C_ij (GPa): </span><span class="se">\n</span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">&#39;</span> 
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C11</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C12</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C13</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">&#39;</span> 
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C21</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C22</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C23</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">, </span><span class="si">%8.2f</span><span class="s1">&#39;</span> 
                       <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C31</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C32</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">C33</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residuals of fitting elastic parameters: &#39;</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">pj</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="s1">&#39;import data from CSV files of micromechanical simulations&#39;</span>
            <span class="n">sep</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_separator&#39;</span><span class="p">]</span>
            <span class="n">file</span>  <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_data&#39;</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_format&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">AllData</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">sig_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S11&#39;</span><span class="p">,</span><span class="s1">&#39;S22&#39;</span><span class="p">,</span><span class="s1">&#39;S33&#39;</span><span class="p">]</span>
            <span class="n">epl_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ep11&#39;</span><span class="p">,</span><span class="s1">&#39;Ep22&#39;</span><span class="p">,</span><span class="s1">&#39;Ep33&#39;</span><span class="p">]</span>
            <span class="n">eps_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span><span class="s1">&#39;E22&#39;</span><span class="p">,</span><span class="s1">&#39;E33&#39;</span><span class="p">]</span>
            <span class="n">eel_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ee11&#39;</span><span class="p">,</span><span class="s1">&#39;Ee22&#39;</span><span class="p">,</span><span class="s1">&#39;Ee33&#39;</span><span class="p">]</span>
            <span class="n">ubc_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StrainX&#39;</span><span class="p">,</span> <span class="s1">&#39;StrainY&#39;</span><span class="p">,</span> <span class="s1">&#39;StrainZ&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">eps_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epl</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">epl_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eel</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">eel_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">sig_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">ubc_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***Microstructure &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39; imported into database &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="s1">&#39; data points imported&#39;</span><span class="p">)</span>
            
            <span class="s1">&#39;calculate eqiv. stresses and strains and theta values&#39;</span>
            <span class="n">sc_full</span>   <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">s_cyl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span>   <span class="c1"># transform stresses into cylindrical coordinates</span>
            <span class="n">peeq_full</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span>  <span class="c1"># calculate equiv. plastic strain from data</span>
            
            <span class="s1">&#39;Consistency checks&#39;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** Warning: Large hydrostatic stresses: minimum p=</span><span class="si">%5.2f</span><span class="s1"> MPa, maximum p=</span><span class="si">%5.2f</span><span class="s1"> MPa&#39;</span> 
                      <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])))</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eel</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">hh</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mf">1.e-8</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** WARNING: Inconsistency in eps_el!&#39;</span><span class="p">)</span>
            <span class="sd">&#39;&#39;&#39;hh = self.ang - sc_full[:,1]</span>
<span class="sd">            if np.amax(np.abs(hh)) &gt; 1.e-6:</span>
<span class="sd">                print(&#39;*** WARNING: Inconsistency in theta!&#39;)</span>
<span class="sd">                print(self.ang[0:self.N:2500], sc_full[0:self.N:2500,1], hh[0:self.N:2500])&#39;&#39;&#39;</span>

            <span class="s1">&#39;filter load cases&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_case</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of lists with data set indices belonging to one load case</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">-</span><span class="n">uvec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
                    <span class="n">hh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
                    
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            &#39;import Fourier coefficients&#39;</span>
<span class="sd">            fc_name = db.pd + self.meta[&#39;Fourier_coeff&#39;]</span>
<span class="sd">            f = open(fc_name, &#39;r&#39;)</span>
<span class="sd">            for x in f:</span>
<span class="sd">                print(x[0], x)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture_param</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">1.</span>
            
            <span class="s1">&#39;select data points close to yield point =&gt; raw data&#39;</span>
            <span class="n">ind</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">peeq_full</span><span class="o">&gt;</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">dep</span><span class="p">,</span> <span class="n">peeq_full</span><span class="o">&lt;</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">dep</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scyl_raw</span> <span class="o">=</span> <span class="n">sc_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">peeq_raw</span> <span class="o">=</span> <span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># calculate average yield point</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated yield strength: </span><span class="si">%5.2f</span><span class="s1"> MPa, from </span><span class="si">%i</span><span class="s1"> data sets with PEEQ approx. </span><span class="si">%5.3f</span><span class="s1">&#39;</span> 
                  <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">,</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="p">))</span>
            <span class="n">prop_elastic</span><span class="p">()</span>
                
            <span class="s1">&#39;define material&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;ML-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">elasticity</span><span class="p">(</span><span class="n">E</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">plasticity</span><span class="p">(</span><span class="n">sy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">microstructure</span><span class="p">(</span><span class="n">texture</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">texture_param</span><span class="p">)</span>
            
            <span class="s1">&#39;mirror stress data in theta space&#39;</span>
            <span class="n">sc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sc2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sc2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">ih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sc2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sc2</span><span class="p">[</span><span class="n">ih</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            
            <span class="s1">&#39;calculate associated load vector for boundary conditions&#39;</span>
            <span class="n">hs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span>   <span class="c1"># mirrored stresses</span>
            <span class="n">hs2</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">sp_cart</span><span class="p">(</span><span class="n">sc2</span><span class="p">)</span>   <span class="c1"># original stresses</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">hs1</span><span class="o">*</span><span class="n">hs2</span><span class="p">)</span> <span class="c1"># filter stress components where sign has changed by mirroring</span>
            <span class="n">ubc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">sign</span>    <span class="c1"># change sign accordingly in BC vector</span>

            <span class="s1">&#39;add mirrored data to flow stresses and augment plastic strain arrays accordingly&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peeq_raw</span><span class="p">,</span> <span class="n">peeq_raw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ubc2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_</span>  <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">sp_cart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">)</span> <span class="c1"># transform back into 3D principle stress space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span> <span class="o">*=</span> <span class="mi">2</span>
            
            <span class="s1">&#39;calculate yield function of mirrored raw data&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span> <span class="o">-</span> <span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_el_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_pl_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="s1">&#39;filter load cases of mirrored raw data&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of lists with data set indices belonging to one load case</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">-</span><span class="n">uvec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
                    <span class="n">hh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of load cases: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="p">))</span>

            <span class="s1">&#39;calculate yield stress for each load case&#39;</span>
            <span class="n">hs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">iel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># find elastic data sets in load case</span>
                <span class="n">ipl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># find plastic data sets in load case</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># difference in first plastic sfc and last elastic sfc</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>  <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>  <span class="c1"># difference in first plastic peeq and last elastic peeq</span>
                <span class="s1">&#39;interpolated value of crit. equiv. stress at yield onset&#39;</span>
                <span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">*</span><span class="n">ds</span><span class="o">/</span><span class="n">de</span><span class="p">)</span>   
                <span class="n">ht</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># polar angle of load case</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ht</span><span class="p">)</span>   <span class="c1"># sort w.r.t polar angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>  <span class="c1"># critical cylindrical stress tensor at yield onset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hs</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ht</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>
                   
<div class="viewcode-block" id="Data.Set.augment_data"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.Set.augment_data">[docs]</a>        <span class="k">def</span> <span class="nf">augment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Raw data is distributed over entire deviatoric plane to create a suited</span>
<span class="sd">            data set for training of SVC, graphical output of raw data together with </span>
<span class="sd">            augmented data can be created.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            
            <span class="s1">&#39;augment raw data and create result vector (yield function)&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_train</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yf_train</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">create_sig_data</span><span class="p">(</span><span class="n">syc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">,</span> <span class="n">Nseq</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_test</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yf_test</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">create_sig_data</span><span class="p">(</span><span class="n">syc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">:</span><span class="mi">10</span><span class="p">,:])</span>

            <span class="k">if</span> <span class="n">graph</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Plot raw data and training data extended over deviatoric plane for data set &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>  <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
                <span class="n">Ncol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_train</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_train</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_train</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">yf_train</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Paired</span><span class="p">)</span>
                <span class="c1">#ax.plot(self.sfc_[:,1], self.sfc_[:,0], &#39;.y&#39;)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;SVC yield function for data set &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (rad)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="Data.Set.plot_seq"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.Set.plot_seq">[docs]</a>        <span class="k">def</span> <span class="nf">plot_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;.b&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;.r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;equiv. plastic strain vs. equiv. stress (mirrored data)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon_</span><span class="si">{eq}</span><span class="s1">^</span><span class="si">{pl}</span><span class="s1">$ (%)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">^\mathrm</span><span class="si">{J2}</span><span class="s1">$ (MPa)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
            
<div class="viewcode-block" id="Data.Set.plot_theta"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.Set.plot_theta">[docs]</a>        <span class="k">def</span> <span class="nf">plot_theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;.b&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;.r&#39;</span><span class="p">)</span>
            <span class="c1">#plt.plot(t_dat[self.i_el],self.sfc[self.i_el,0],&#39;.b&#39;)</span>
            <span class="c1">#plt.plot(t_dat[self.i_pl],self.sfc[self.i_pl,0],&#39;.r&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;polar angle vs. equiv. stress&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (rad)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">^\mathrm</span><span class="si">{J2}</span><span class="s1">$ (MPa)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="Data.Set.plot_flow_stress"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.Set.plot_flow_stress">[docs]</a>        <span class="k">def</span> <span class="nf">plot_flow_stress</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="s1">&#39;.r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="s1">&#39;.b&#39;</span><span class="p">)</span>
            <span class="c1">#plt.polar(np.linspace(0.,2*np.pi,36), np.ones(36), &#39;-k&#39;, linewidth=2)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;polar angle vs. J2 equiv. stress&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;data above yield crit.&#39;</span><span class="p">,</span><span class="s1">&#39;data below yield crit.&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.8</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
            
<div class="viewcode-block" id="Data.train_SVC"><a class="viewcode-back" href="../pyLabFEA.html#pyLabData.Data.train_SVC">[docs]</a>    <span class="k">def</span> <span class="nf">train_SVC</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Train SVC for all yield functions of the microstructures provided in the list ``Data.msl``. In First step, the </span>
<span class="sd">            training data for each set is generated by creating stresses on the deviatoric plane and calculating their catgegorial</span>
<span class="sd">            yield function (&quot;-1&quot;: elastic, &quot;+1&quot;: plastic). Furthermore, axes in different dimensions for microstructural</span>
<span class="sd">            features are introduced that describe the relation between the different sets.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="k">for</span> <span class="nb">set</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">:</span>
                <span class="nb">set</span><span class="o">.</span><span class="n">augment_data</span><span class="p">()</span>   <span class="c1"># create training data in entire deviatoric stress plane from raw data</span>
            <span class="n">train_sc</span><span class="p">,</span> <span class="n">test_sc</span> <span class="o">=</span> <span class="n">mat_ml</span><span class="o">.</span><span class="n">setup_yf_SVM</span><span class="p">(</span><span class="n">xt</span><span class="p">,</span> <span class="n">yt</span><span class="p">,</span> <span class="n">cyl</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">4.</span><span class="p">,</span> <span class="n">fs</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">-------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SVM classification fitted&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------------------</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">mat_ml</span><span class="o">.</span><span class="n">svm_yf</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training data points:&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">,</span><span class="s2">&quot; raw data points, &quot;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xt</span><span class="p">),</span><span class="s2">&quot;augmented data points (polar angles)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training set score: </span><span class="si">{}</span><span class="s2"> %&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">train_sc</span><span class="p">))</span></div></div>
        
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyLabFEA</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyLabFEA.html">Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>
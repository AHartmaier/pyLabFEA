<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pylabfea.data &#8212; pyLabFEA 4.3.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/classic.css?v=2bf1fcf8" />
    
    <script src="../../_static/documentation_options.js?v=32fb297c"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyLabFEA 4.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pylabfea.data</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylabfea.data</h1><div class="highlight"><pre>
<span></span><span class="c1"># Module pylabfea.data</span>
<span class="sd">&quot;&quot;&quot;Module pylabfea.data introduces the class ``Data`` for handling of data resulting</span>
<span class="sd">from virtual or physical mechanical tests in the pyLabFEA package. This class provides the</span>
<span class="sd">methods necessary for analyzing data. During this processing, all information is gathered</span>
<span class="sd">that is required to define a material, i.e., all parameters for elasticity, plasticity,</span>
<span class="sd">and microstructures are provided from the data. Materials are defined in</span>
<span class="sd">module pylabfea.material based on the analyzed data of this module.</span>

<span class="sd">uses NumPy, SciPy, MatPlotLib</span>

<span class="sd">Version: 4.0 (2021-11-27)</span>
<span class="sd">Last Update: (24-04-2023)</span>
<span class="sd">Authors: Ronak Shoghi, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany</span>
<span class="sd">Email: alexander.hartmaier@rub.de</span>
<span class="sd">distributed under GNU General Public License (GPLv3)&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">pylabfea</span> <span class="k">as</span> <span class="nn">FE</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">savgol_filter</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>


<div class="viewcode-block" id="find_transition_index">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.find_transition_index">[docs]</a>
<span class="k">def</span> <span class="nf">find_transition_index</span><span class="p">(</span><span class="n">stress</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates the index at which a significant transition in the total stress-strain relationship occurs.</span>
<span class="sd">    The function applies a Savitzky-Golay filter to smooth the stress data and to calculate the first</span>
<span class="sd">    and second derivatives. It identifies the transition index by finding the point where the second</span>
<span class="sd">    derivative starts to change from zero, i.e. the value in the elastic regime. This approach relies on</span>
<span class="sd">    the overall behavior of the stress-strain relationship</span>
<span class="sd">    rather than focusing on a specific plastic strain threshold (e.g., 0.002%).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    stress: 1-d numpy array</span>
<span class="sd">        Array of equivalent stress values along one load path.</span>

<span class="sd">    Returns:</span>
<span class="sd">    ----------</span>
<span class="sd">    idx: int</span>
<span class="sd">        The index within the stress array where a significant transition from linear behavior occurs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nst</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stress</span><span class="p">)</span>
    <span class="n">wl1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nst</span> <span class="o">/</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">wl2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">nst</span> <span class="o">/</span> <span class="mi">50</span><span class="p">))</span>
    <span class="n">sig_d1</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">stress</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="n">wl1</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sig_d2</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">sig_d1</span><span class="p">,</span> <span class="n">window_length</span><span class="o">=</span><span class="n">wl2</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">deriv</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">i0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nst</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sig_d2</span><span class="p">[</span><span class="n">i0</span><span class="p">:</span><span class="n">i0</span> <span class="o">+</span> <span class="n">wl2</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.2</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">iend</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">nst</span> <span class="o">-</span> <span class="n">i0</span><span class="p">)</span> <span class="o">/</span> <span class="n">wl2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">iend</span><span class="p">):</span>
        <span class="n">mav</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sig_d2</span><span class="p">[</span><span class="n">i0</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">wl2</span><span class="p">:</span><span class="n">i0</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">wl2</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mav</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">i0</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">wl2</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: Transition not determined properly&#39;</span><span class="p">)</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">i0</span>
    <span class="k">return</span> <span class="n">idx</span></div>



<div class="viewcode-block" id="get_elastic_coefficients">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.get_elastic_coefficients">[docs]</a>
<span class="k">def</span> <span class="nf">get_elastic_coefficients</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;least_square&#39;</span><span class="p">,</span> <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A function to compute the elastic coefficients (stiffness matrix) for a material</span>
<span class="sd">    based on stress-strain data. This function supports two methods for determining</span>
<span class="sd">    the stiffness matrix: a direct least squares approach and an optimization approach.</span>
<span class="sd">    The least squares method is used when &#39;least_square&#39; is specified, which processes</span>
<span class="sd">    any desired stress-strain pairs( minimum must be 4).  The optimization approach,</span>
<span class="sd">    used when &#39;decomposition&#39; method is specified, iteratively adjusts the</span>
<span class="sd">    stiffness matrix to minimize an objective function that measures the fit to the</span>
<span class="sd">    observed data, subject to physical plausibility constraints.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    eps: (N, 6)-array</span>
<span class="sd">        Array with Voigt strain tensors at the end of the linear-elastic regime of different load cases.</span>
<span class="sd">    sig: (N, 6)-array</span>
<span class="sd">    Array of corresponding Voigt stress tensors at the end of the linear elastic regime of different load cases.</span>
<span class="sd">    method: str</span>
<span class="sd">        Method to be used for calculating the stiffness matrix. Options</span>
<span class="sd">        include &#39;least_square&#39; and &#39;decomposition&#39;. The &#39;least_square&#39; method</span>
<span class="sd">        calculates the stiffness matrix using a least squares fit to the stress-strain data.</span>
<span class="sd">        The &#39;decomposition&#39; method uses an optimization approach with the</span>
<span class="sd">        specified method for interpreting the stiffness matrix from the optimization</span>
<span class="sd">        variables. (Optional: default is &#39;least_square&#39;).</span>
<span class="sd">    initial_guess: np.ndarray or None</span>
<span class="sd">        Initial guess for the stiffness matrix coefficients</span>
<span class="sd">        used in the optimization approach. If None, a random initial guess is generated.</span>
<span class="sd">        This parameter is ignored when using the &#39;least_square&#39; method. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">    C: (6, 6)-array</span>
<span class="sd">        The optimized symmetric 6x6 stiffness matrix (elastic coefficients) as a numpy array.</span>
<span class="sd">        If the optimization or calculation fails to converge to a solution within the</span>
<span class="sd">        maximum number of attempts, the function may return the last attempted solution</span>
<span class="sd">        or raise an error, depending on implementation details.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">map_flat_to_matrix</span><span class="p">(</span><span class="n">C_flat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps a flat array of coefficients into a symmetric matrix C. This function takes the</span>
<span class="sd">        elements from the input array and places them into both the upper and the lower</span>
<span class="sd">        triangular portions of the matrix, ensuring symmetry. The operation is particularly</span>
<span class="sd">        useful for reconstructing symmetric matrices, such as stiffness or elasticity matrices,</span>
<span class="sd">        from a set of parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        C_flat: np.ndarray</span>
<span class="sd">            A flat array containing the unique coefficients of a symmetric</span>
<span class="sd">            matrix. The length of C_flat should be 21, corresponding to the number of unique</span>
<span class="sd">            elements in a 6x6 symmetric matrix (6 diagonal + 15 off-diagonal elements).</span>

<span class="sd">        Returns:</span>
<span class="sd">        C: np.ndarray</span>
<span class="sd">            A 6x6 symmetric matrix constructed from the input coefficients.</span>
<span class="sd">         &quot;&quot;&quot;</span>

        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">C</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">C_flat</span>
        <span class="n">C</span><span class="p">[(</span><span class="n">indices</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">C_flat</span>
        <span class="k">return</span> <span class="n">C</span>

        <span class="c1"># for Cholesky decomporion: https://en.wikipedia.org/wiki/Cholesky_decomposition</span>

    <span class="k">def</span> <span class="nf">map_flat_to_L_and_C</span><span class="p">(</span><span class="n">C_flat</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maps a flat array of coefficients into a lower triangular matrix L, and then</span>
<span class="sd">        computes a symmetric positive definite matrix C by multiplying L with its transpose.</span>
<span class="sd">        This approach is commonly used in the decomposition of a stiffness or elasticity matrix,</span>
<span class="sd">        enabling the reconstruction of these matrices from a reduced set of parameters in</span>
<span class="sd">        optimization problems.</span>

<span class="sd">        Parameters:</span>
<span class="sd">        - C_flat (np.ndarray): A flat array of coefficients. The length of this array should</span>
<span class="sd">          be such that it can fill the lower triangular part of a 6x6 matrix, it should</span>
<span class="sd">          have 21 elements (6+5+4+3+2+1).</span>

<span class="sd">        Returns:</span>
<span class="sd">        - tuple of np.ndarray: A tuple containing two numpy arrays:</span>
<span class="sd">            - L (np.ndarray): The lower triangular matrix formed by placing the elements of `C_flat`</span>
<span class="sd">              into the lower triangular indices of a 6x6 matrix.</span>
<span class="sd">            - C (np.ndarray): The symmetric positive definite matrix computed as the dot product of L and its transpose.</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril_indices</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">L</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">C_flat</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">,</span> <span class="n">C</span>

    <span class="k">def</span> <span class="nf">is_positive_definite</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks whether a given matrix is positive definite. A matrix is positive definite</span>
<span class="sd">        if all its eigenvalues are greater than zero. This characteristic is essential for</span>
<span class="sd">        ensuring the stability and uniqueness of solutions in many mathematical contexts,</span>
<span class="sd">        including optimization problems and systems of linear equations.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        C: np.ndarray</span>
<span class="sd">            The matrix to be checked. This should be a square matrix.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        _: bool:</span>
<span class="sd">            True if the matrix is positive definite, meaning all its eigenvalues are</span>
<span class="sd">            greater than zero; False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_stress_from_strain</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the predicted stress for a given strain using the material&#39;s stiffness</span>
<span class="sd">        matrix. This function multiplies the stiffness matrix C by the strain vector to</span>
<span class="sd">        predict the resulting stress, according to Hooke&#39;s Law for linear elastic materials.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strain: list or np.ndarray</span>
<span class="sd">            The strain vector, representing the deformation in the material. This should be a</span>
<span class="sd">            1D array or list of length 6, corresponding to the three normal and three shear</span>
<span class="sd">            components of strain.</span>
<span class="sd">        C: np.ndarray</span>
<span class="sd">            The stiffness matrix of the material. This should be a 6x6 symmetric</span>
<span class="sd">            matrix representing the material&#39;s resistance to deformation. The matrix correlates</span>
<span class="sd">            the strain to the stress in the material.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        _: np.ndarray</span>
<span class="sd">            The predicted stress vector, calculated as the dot product of the stiffness</span>
<span class="sd">            matrix C and the strain vector. This vector has the same dimension as the strain</span>
<span class="sd">            input, containing the three normal and three shear components of stress.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">strain_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strain</span><span class="p">)</span>
        <span class="n">stress_predicted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">strain_vector</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">stress_predicted</span>

    <span class="k">def</span> <span class="nf">objective_function</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">x_flat</span><span class="p">,</span> <span class="n">penalty_weight</span><span class="o">=</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">lambda_reg</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the objective function value for an optimization problem that aims</span>
<span class="sd">        to find the stiffness matrix coefficients using the decomposition method</span>
<span class="sd">        to construct the stiffness matrix from a flat array of coefficients. It includes</span>
<span class="sd">        penalties for non-positive definiteness of the matrix and a regularization term</span>
<span class="sd">        to prevent overfitting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        x_flat: np.ndarray</span>
<span class="sd">            A flat array of stiffness matrix coefficients.</span>
<span class="sd">        penalty_weight: float</span>
<span class="sd">            The weight of the penalty for non-positive definiteness. (Optional, default is 1e9).</span>
<span class="sd">        lambda_reg: float</span>
<span class="sd">            The regularization parameter to prevent overfitting by penalizing</span>
<span class="sd">            large coefficients. (Optional, default is 1e-3).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        _: float</span>
<span class="sd">            The value of the objective function, which includes the sum of squared residuals</span>
<span class="sd">            between observed and predicted stresses, a penalty for non-positive definiteness, and</span>
<span class="sd">            a regularization term.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">map_flat_to_L_and_C</span><span class="p">(</span><span class="n">x_flat</span><span class="p">)</span>
        <span class="n">penalty</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_positive_definite</span><span class="p">(</span><span class="n">C</span><span class="p">):</span>
            <span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty_weight</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">C</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sum_squared_residuals</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">strain</span><span class="p">,</span> <span class="n">observed_stress</span> <span class="ow">in</span> <span class="n">data_pairs</span><span class="p">:</span>
            <span class="n">predicted_stress</span> <span class="o">=</span> <span class="n">calculate_stress_from_strain</span><span class="p">(</span><span class="n">strain</span><span class="p">,</span> <span class="n">C</span><span class="p">)</span>
            <span class="n">residuals</span> <span class="o">=</span> <span class="n">observed_stress</span> <span class="o">-</span> <span class="n">predicted_stress</span>
            <span class="n">sum_squared_residuals</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">residuals</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">regularization_term</span> <span class="o">=</span> <span class="n">lambda_reg</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">x_flat</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sum_squared_residuals</span> <span class="o">+</span> <span class="n">penalty</span> <span class="o">+</span> <span class="n">regularization_term</span>

    <span class="k">def</span> <span class="nf">least_square</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">random_pairs_number</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the least squares solution for a set of equations derived from</span>
<span class="sd">        a specified number of random experiment pairs. Each pair consists of strains</span>
<span class="sd">        and stresses. In the case of general symmetry, the coefficients of the stiffness</span>
<span class="sd">        matrix are reduced to 21 from 36, and at least 4 stress-strain pairs (24 equations) are required</span>
<span class="sd">        to accurately determine these coefficients. This function solves for the coefficients</span>
<span class="sd">        that minimize the difference between the observed stresses and those predicted by</span>
<span class="sd">        the strains through a linear model, under the assumption of general symmetry.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        - random_pairs_number (int): The number of random pairs of strains and stresses</span>
<span class="sd">          to use in the calculation. Default is 100, Minimum must be 4.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        - C (np.ndarray): The stiffness matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">random_pairs_number</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">):</span>
            <span class="n">random_pairs_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: number of random pairs larger than data set. Using </span><span class="si">{random_pairs_number}</span><span class="s2"> pairs.}&quot;</span><span class="p">)</span>
        <span class="n">random_pairs</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">random_pairs_number</span><span class="p">)</span>
        <span class="n">C_column_locator</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C11&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;C12&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C13&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C14&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C15&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;C16&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                            <span class="s2">&quot;C21&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;C22&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">&quot;C23&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;C24&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;C25&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;C26&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
                            <span class="s2">&quot;C31&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;C32&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;C33&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="s2">&quot;C34&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;C35&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;C36&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span>
                            <span class="s2">&quot;C41&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;C42&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;C43&quot;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span> <span class="s2">&quot;C44&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;C45&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;C46&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span>
                            <span class="s2">&quot;C51&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;C52&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;C53&quot;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="s2">&quot;C54&quot;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span> <span class="s2">&quot;C55&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span> <span class="s2">&quot;C56&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
                            <span class="s2">&quot;C61&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">&quot;C62&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s2">&quot;C63&quot;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;C64&quot;</span><span class="p">:</span> <span class="mi">18</span><span class="p">,</span> <span class="s2">&quot;C65&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;C66&quot;</span><span class="p">:</span> <span class="mi">21</span><span class="p">}</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">random_pairs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">random_pairs</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
        <span class="n">row_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">experiment</span> <span class="ow">in</span> <span class="n">random_pairs</span><span class="p">:</span>
            <span class="n">Pair_Counter</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">strains</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">stresses</span> <span class="o">=</span> <span class="n">experiment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stresses</span><span class="p">)):</span>
                <span class="n">stress</span> <span class="o">=</span> <span class="n">stresses</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">C_locations</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">1&quot;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">2&quot;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">3&quot;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">4&quot;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">5&quot;</span><span class="p">,</span>
                               <span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">Pair_Counter</span><span class="si">}</span><span class="s2">6&quot;</span><span class="p">]</span>
                <span class="n">C_locations_translated</span> <span class="o">=</span> <span class="p">[</span><span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                          <span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                          <span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                                          <span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                          <span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                                          <span class="n">C_column_locator</span><span class="p">[</span><span class="n">C_locations</span><span class="p">[</span><span class="mi">5</span><span class="p">]]]</span>

                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">A</span><span class="p">[</span><span class="n">row_counter</span><span class="p">][</span><span class="n">C_locations_translated</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">strains</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">b</span><span class="p">[</span><span class="n">row_counter</span><span class="p">]</span> <span class="o">=</span> <span class="n">stress</span>

                <span class="n">row_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">Pair_Counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># b.reshape(-1, 1)</span>
        <span class="n">C_flat</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">rcond</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">map_flat_to_matrix</span><span class="p">(</span><span class="n">C_flat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">C</span>

    <span class="c1"># start elastic coefficient identification</span>
    <span class="n">data_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">sig</span><span class="p">))</span>
    <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">success</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">npairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">attempts</span> <span class="o">&lt;</span> <span class="n">max_attempts</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;least_square&#39;</span><span class="p">:</span>
            <span class="n">optimized_C</span> <span class="o">=</span> <span class="n">least_square</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">random_pairs_number</span><span class="o">=</span><span class="n">npairs</span><span class="p">)</span>
            <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;decomposition&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">initial_guess</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">initial_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
                    <span class="mi">21</span><span class="p">)</span>  <span class="c1"># Adjust the number according to the actual problem dimension</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">objective_function</span><span class="p">,</span> <span class="n">initial_guess</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">data_pairs</span><span class="p">,</span> <span class="n">method</span><span class="p">,),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">optimized_C</span> <span class="o">=</span> <span class="n">map_flat_to_L_and_C</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimization attempt </span><span class="si">{}</span><span class="s2"> failed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attempts</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid method selected. Choose &#39;least_square&#39; or &#39;decomposition&#39;.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Optimization of material stiffness matrix failed after </span><span class="si">{}</span><span class="s2"> attempts&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">max_attempts</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimized_C</span><span class="p">)</span></div>



<div class="viewcode-block" id="Data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data">[docs]</a>
<span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Define class for handling data from virtual mechanical tests in micromechanical</span>
<span class="sd">    simulations and data from physical mechanical tests on materials with various</span>
<span class="sd">    microstructures. Data is used to train machine learning flow rules in pyLabFEA.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    source: str or data array</span>
<span class="sd">        Either filename of datafile or array of initial yield stresses</span>
<span class="sd">    path_data: str</span>
<span class="sd">        Trunc of pathname for data files (optional, default: &#39;./&#39;)</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of Dataset (optional, default: &#39;Dataset&#39;)</span>
<span class="sd">    mat_name : str</span>
<span class="sd">        Name of material (optional, default: &#39;Simulanium)</span>
<span class="sd">    sdim: int</span>
<span class="sd">        Dimensionality of stresses; if sdim = 3 only principal stresses are considered (optional, default: 6)</span>
<span class="sd">    epl_crit : float</span>
<span class="sd">        Critical plastic strain at which yield strength is defined(optional, default: 2.e-3)</span>
<span class="sd">    epl_start : float</span>
<span class="sd">        Start value of equiv. plastic strain at which data will be sampled(optional, default: 1.e-3)</span>
<span class="sd">    epl_max : float</span>
<span class="sd">        Maximum equiv. plastic strain up to which data is considered (optional, default: 0.05)</span>
<span class="sd">    plot : Boolean</span>
<span class="sd">        Plot data (optional, default: False)</span>
<span class="sd">    wh_data : Boolean</span>
<span class="sd">        Data for flow stresses and plastic strain tensors in work hardening regime exists (optional, default: True)</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of dataset</span>
<span class="sd">    sy_av: float</span>
<span class="sd">        Average initial yield stress</span>
<span class="sd">    E_av: float</span>
<span class="sd">        Average Young&#39;s modulus</span>
<span class="sd">    nu_av: float</span>
<span class="sd">        Average Poisson ratio</span>
<span class="sd">    mat_param: dictionary</span>
<span class="sd">        | Contains available data for ML yield function and for microstructural parameters</span>
<span class="sd">        | Items</span>
<span class="sd">        |    epc : critical value of equiv. plastic strain that defines the onset of plastic yielding</span>
<span class="sd">        |    ep_start : start value of equiv. plastic strain at which data is acquired</span>
<span class="sd">        |    ep_max : maximum value of equiv. plastic strain up to which data is considered</span>
<span class="sd">        |    delta_ep : minimum separation of plastic strains used for training, if 0 no separation is enforced</span>
<span class="sd">        |    lc_indices : array with start index for each load case</span>
<span class="sd">        |    peeq_max : maximum of equiv. plastic strain that occurred in data set, corrected for onset of plasticity at epc</span>
<span class="sd">        |    sdim : dimension of stress vector (must be 3 or 6)</span>
<span class="sd">        |    Name : material name</span>
<span class="sd">        |    Dataset : Name of dataset</span>
<span class="sd">        |    wh_data : indicate if strain hardening data exists</span>
<span class="sd">        |    Ntext : number of textures</span>
<span class="sd">        |    tx_name : name of texture</span>
<span class="sd">        |    texture : texture parameters</span>
<span class="sd">        |    flow_stress : array of flow stresses correlated to plastic strains</span>
<span class="sd">        |    plastic_strain : array of plastic strains corrected for onset of plasticity at epc</span>
<span class="sd">        |    E_av : avereage Young&#39;s modulus derived from data</span>
<span class="sd">        |    nu_av : average Poisson&#39;s ratio derived from data</span>
<span class="sd">        |    sy_av : average yield strength, i.e. flow stress at epc, obtained from data</span>
<span class="sd">        |    Nlc : number of load cases in data</span>
<span class="sd">        |    sy_list : ???</span>
<span class="sd">        |    sig_ideal : interpolated stress tensors at onset of plastic yielding (epc) for each load case</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">path_data</span><span class="o">=</span><span class="s1">&#39;./&#39;</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="n">mat_name</span><span class="o">=</span><span class="s2">&quot;Simulanium&quot;</span><span class="p">,</span>
                 <span class="n">sdim</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                 <span class="n">epl_crit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">epl_start</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">epl_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">depl</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
                 <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">wh_data</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">texture_name</span><span class="o">=</span><span class="s1">&#39;Random&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sdim</span> <span class="o">!=</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">sdim</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Value of sdim must be either 3 or 6&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epl_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epl_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">epl_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;delta_ep&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">depl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sdim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sdim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mat_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;Dataset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;wh_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wh_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;Ntext&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;tx_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">texture_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;texture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_data</span><span class="p">(</span><span class="n">path_data</span> <span class="o">+</span> <span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">(</span><span class="n">epl_crit</span><span class="p">,</span> <span class="n">epl_start</span><span class="p">,</span> <span class="n">epl_max</span><span class="p">,</span> <span class="n">depl</span><span class="p">)</span>  <span class="c1"># add data to mat_data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">convert_data</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>  <span class="c1"># add data to mat_data</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_training_data</span><span class="p">()</span>

<div class="viewcode-block" id="Data.key_parser">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.key_parser">[docs]</a>
    <span class="k">def</span> <span class="nf">key_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">Keys_Parsed</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Stress_Type&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;Load_Type&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;Hash_Load&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                       <span class="s2">&quot;Hash_Orientation&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;Texture_Type&quot;</span><span class="p">:</span> <span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">]}</span>
        <span class="k">return</span> <span class="n">Keys_Parsed</span></div>


<div class="viewcode-block" id="Data.read_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.read_data">[docs]</a>
    <span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Data_File</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">Data_File</span><span class="p">))</span>
        <span class="n">Final_Data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;Results&#39;</span><span class="p">]</span>
            <span class="n">Sigma</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;S11&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;S22&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;S33&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;S23&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;S13&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;S12&quot;</span><span class="p">]]</span>  <span class="c1"># Order !!!</span>
            <span class="n">E_Total</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;E11&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;E22&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;E33&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;E23&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;E13&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;E12&quot;</span><span class="p">]]</span>
            <span class="n">E_Plastic</span> <span class="o">=</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep11&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep22&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep33&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep23&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep13&quot;</span><span class="p">],</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;Ep12&quot;</span><span class="p">]]</span>
            <span class="n">Len_Sigma</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">seq_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Len_Sigma</span><span class="p">)</span>
            <span class="n">peeq_full</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Len_Sigma</span><span class="p">)</span>
            <span class="n">peeq_plastic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Len_Sigma</span><span class="p">)</span>
            <span class="n">Original_Stresses</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Len_Sigma</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">Original_Plastic_Strains</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Len_Sigma</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">Original_Total_Strains</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Len_Sigma</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">Plastic_Strains_Shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Len_Sigma</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
            <span class="n">epl</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">epc</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">epc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Len_Sigma</span><span class="p">):</span>
                <span class="n">Stress_6D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Sigma</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>
                <span class="n">Original_Stresses</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Stress_6D</span>
                <span class="n">seq_full</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">sig_eq_j2</span><span class="p">(</span><span class="n">Stress_6D</span><span class="p">)</span>

                <span class="n">E_Plastic_6D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E_Plastic</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Plastic</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Plastic</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                         <span class="n">E_Plastic</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Plastic</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Plastic</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>

                <span class="n">peeq_plastic</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">E_Plastic_6D</span><span class="p">)</span>
                <span class="n">Original_Plastic_Strains</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">E_Plastic_6D</span>

                <span class="n">E_Total_6D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">E_Total</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Total</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Total</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                                       <span class="n">E_Total</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Total</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">E_Total</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]])</span>

                <span class="n">peeq_full</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">E_Total_6D</span><span class="p">)</span>
                <span class="n">Original_Total_Strains</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_Total_6D</span>
                <span class="c1"># For having also the elastic data and shift the 0 plastic strain</span>
                <span class="c1"># to 0.02% to match the micromechanical data.</span>
                <span class="c1"># Can be used in Stress-Strain Reconstruction.</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">peeq_plastic</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">1.e-10</span><span class="p">)</span>
                <span class="n">Plastic_Strains_Shifted</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">E_Plastic_6D</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">epc</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span>

            <span class="n">Final_Data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Stress&quot;</span><span class="p">:</span> <span class="n">Original_Stresses</span><span class="p">,</span>
                               <span class="s2">&quot;Eq_Stress&quot;</span><span class="p">:</span> <span class="n">seq_full</span><span class="p">,</span>
                               <span class="s2">&quot;Strain_Plastic&quot;</span><span class="p">:</span> <span class="n">Original_Plastic_Strains</span><span class="p">,</span>
                               <span class="s2">&quot;Eq_Strain_Plastic&quot;</span><span class="p">:</span> <span class="n">peeq_plastic</span><span class="p">,</span>  <span class="c1"># always shifted ???</span>
                               <span class="s2">&quot;Shifted_Strain_Plastic&quot;</span><span class="p">:</span> <span class="n">Plastic_Strains_Shifted</span><span class="p">,</span>  <span class="c1"># required ???</span>
                               <span class="s2">&quot;Strain_Total&quot;</span><span class="p">:</span> <span class="n">Original_Total_Strains</span><span class="p">,</span>
                               <span class="s2">&quot;Eq_Strain_Total&quot;</span><span class="p">:</span> <span class="n">peeq_full</span><span class="p">,</span>
                               <span class="p">}</span>
        <span class="k">return</span> <span class="n">Final_Data</span></div>


<div class="viewcode-block" id="Data.parse_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.parse_data">[docs]</a>
    <span class="k">def</span> <span class="nf">parse_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epl_crit</span><span class="p">,</span> <span class="n">epl_start</span><span class="p">,</span> <span class="n">epl_max</span><span class="p">,</span> <span class="n">depl</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data and store in attribute &#39;mat_data&#39;</span>
<span class="sd">        Estimate elastic properties and initial yield strength from data for each load case and form averages.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        epl_crit : float</span>
<span class="sd">            Critical value for onset of yielding</span>
<span class="sd">        epl_start : float</span>
<span class="sd">            Start value of equiv. plastic strain at which data acquisition of flow stresses will start</span>
<span class="sd">        epl_max : float</span>
<span class="sd">            Maximum equiv. strain up to which data is considered</span>
<span class="sd">        depl : float</span>
<span class="sd">            Minimum separation of plastic strains used for training, if 0, no minimum is enforced</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># initializations</span>
        <span class="n">Nlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">sy_av</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">peeq_max</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">ct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">ep_c</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ep_s</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">ep_m</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">sy_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">epl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sig_ideal</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lc_ind_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">Nlc</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">elstrain</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">elstress</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">it_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># estimate yield point for load case</span>
            <span class="c1"># (1) find transition index w/o definition of critical plastic strain</span>
            <span class="n">it</span> <span class="o">=</span> <span class="n">find_transition_index</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;Eq_Stress&quot;</span><span class="p">])</span>
            <span class="n">elstrain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;Strain_Total&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">])</span>  <span class="c1"># total strain tensor at transition</span>
            <span class="n">elstress</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">][</span><span class="n">it</span><span class="p">])</span>  <span class="c1"># stress tensor at transition</span>
            <span class="n">peeq</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;Eq_Strain_Plastic&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">epl_crit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">epc_lc</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">epc_lc</span> <span class="o">=</span> <span class="n">epl_crit</span>
            <span class="k">if</span> <span class="n">epl_start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">eps_lc</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">it</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">eps_lc</span> <span class="o">=</span> <span class="n">epl_start</span>
            <span class="k">if</span> <span class="n">epl_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">epm_lc</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">peeq</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">epm_lc</span> <span class="o">=</span> <span class="n">epl_max</span>

            <span class="c1"># (2) estimate yield point for ideal plasticity consideration</span>
            <span class="n">i_ideal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">peeq</span> <span class="o">&lt;</span> <span class="n">epc_lc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i_ideal</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Skipping data set </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> (No </span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s1">): No elastic range before yield onset.&#39;</span><span class="p">)</span>
                <span class="n">Nlc</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">continue</span>

            <span class="c1"># (3) identify elastic and plastic regions based on critical values for plastic strain</span>
            <span class="n">iel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">peeq</span> <span class="o">&lt;</span> <span class="n">eps_lc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ipl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">peeq</span> <span class="o">&gt;=</span> <span class="n">eps_lc</span><span class="p">,</span> <span class="n">peeq</span> <span class="o">&lt;=</span> <span class="n">epm_lc</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">iel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping data set </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> (No </span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s1">): No elastic range: IEL: </span><span class="si">{</span><span class="n">iel</span><span class="si">}</span><span class="s1">, vals: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">peeq</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">Nlc</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipl</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Skipping data set </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> (No </span><span class="si">{</span><span class="n">ct</span><span class="si">}</span><span class="s1">): No plastic range: IPL: </span><span class="si">{</span><span class="n">ipl</span><span class="si">}</span><span class="s1">, vals: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">peeq</span><span class="p">)</span><span class="si">}</span><span class="s1">; &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">epl_start</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">epl_max</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">Nlc</span> <span class="o">-=</span> <span class="mi">1</span>
                <span class="k">continue</span>
            <span class="c1"># store different indices and critical values for statistical analysis</span>
            <span class="n">it_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">it</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">i_ideal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
            <span class="n">ep_c</span> <span class="o">+=</span> <span class="n">epc_lc</span>
            <span class="n">ep_s</span> <span class="o">+=</span> <span class="n">eps_lc</span>
            <span class="n">ep_m</span> <span class="o">+=</span> <span class="n">epm_lc</span>

            <span class="c1"># get initial yield stress</span>
            <span class="n">sig_ideal</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">][</span><span class="n">i_ideal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>  <span class="c1"># stress tensor at crit. plastic strain</span>
            <span class="n">sy_av</span> <span class="o">+=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;Eq_Stress&#39;</span><span class="p">][</span><span class="n">i_ideal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># calculate avereaged equiv. stress at epc over all load cases</span>
            <span class="n">s0</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;Eq_Stress&#39;</span><span class="p">][</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">s1</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="s1">&#39;Eq_Stress&#39;</span><span class="p">][</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">e0</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
            <span class="n">e1</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">s_start</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="p">(</span><span class="n">eps_lc</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">s1</span> <span class="o">-</span> <span class="n">s0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">e1</span> <span class="o">-</span> <span class="n">e0</span><span class="p">)</span>
            <span class="n">sy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_start</span><span class="p">)</span>  <span class="c1"># interpolated equiv. stress at plastic strain eps_lc</span>
            <span class="k">if</span> <span class="n">peeq</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">&gt;</span> <span class="n">peeq_max</span><span class="p">:</span>
                <span class="n">peeq_max</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>

            <span class="c1"># enforce minimum distance depl between strain values along load cases</span>
            <span class="c1"># shift values to have 0 equivalent plastic strain at start of yielding.</span>
            <span class="c1"># values might be negative (atomistic / noisy data), cutoff at 0 enforced</span>
            <span class="c1"># difference to &#39;Shifted_Strain_Plastic&#39; ???</span>
            <span class="n">eps</span> <span class="o">=</span> <span class="o">-</span><span class="n">depl</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ipl</span><span class="p">:</span>
                <span class="n">hh</span> <span class="o">=</span> <span class="n">peeq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hh</span> <span class="o">&gt;=</span> <span class="n">eps</span> <span class="o">+</span> <span class="n">depl</span><span class="p">:</span>
                    <span class="n">sig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;Stress&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">sc_epl</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">epc_lc</span> <span class="o">/</span> <span class="n">hh</span><span class="p">)</span>
                    <span class="n">epl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s1">&#39;Strain_Plastic&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">sc_epl</span><span class="p">)</span>
                    <span class="n">eps</span> <span class="o">=</span> <span class="n">hh</span>
                    <span class="n">nv</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">lc_ind_list</span><span class="p">[</span><span class="n">ct</span><span class="p">]</span> <span class="o">=</span> <span class="n">nv</span> <span class="o">+</span> <span class="n">lc_ind_list</span><span class="p">[</span><span class="n">ct</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># store end index for values of this load case</span>

            <span class="c1"># get texture name</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39; Warning: This should be read only once from metadata !!!&#39;&#39;&#39;</span>
            <span class="n">Key_Translated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_parser</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ms_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Key_Translated</span><span class="p">[</span><span class="s2">&quot;Texture_Type&quot;</span><span class="p">]</span>  <span class="c1"># unimodal texture type</span>
            <span class="n">ct</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># initialize mat_data dictionary used to create material objects</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">get_elastic_coefficients</span><span class="p">(</span><span class="n">elstrain</span><span class="p">,</span> <span class="n">elstress</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;least_square&#39;</span><span class="p">)</span>
        <span class="n">sy_av</span> <span class="o">/=</span> <span class="n">Nlc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>  <span class="c1"># list of stress tensors for all load cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;plastic_strain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">epl</span><span class="p">)</span>  <span class="c1"># list of plastic strain tensors for all load cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;lc_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lc_ind_list</span>  <span class="c1"># list of starting indices of data sets for different load cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ep_c</span> <span class="o">/</span> <span class="n">Nlc</span>  <span class="c1"># critical value of plastic strain for yield onset definition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_start&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ep_s</span> <span class="o">/</span> <span class="n">Nlc</span>  <span class="c1"># start value of plastic strain for training data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ep_m</span> <span class="o">/</span> <span class="n">Nlc</span>  <span class="c1"># nominal maximum plastic strain to be considered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;peeq_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">peeq_max</span> <span class="o">-</span> <span class="n">ep_c</span> <span class="o">/</span> <span class="n">Nlc</span>  <span class="c1"># maximum plastic strain occuring in training data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;elast_const&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">C</span>  <span class="c1"># anisotropic elastic coefficients obtained from data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sy_av&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy_av</span>  <span class="c1"># equiv. stress at epc averaged over all load cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;Nlc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nlc</span>  <span class="c1"># number of load cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sy_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sy_list</span>  <span class="c1"># equiv. stress at ep_start</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sig_ideal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sig_ideal</span><span class="p">)</span>  <span class="c1"># stress tensor at epc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;elstress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elstress</span>  <span class="c1"># list of all stress tensors at the end of linear regime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;elstrain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">elstrain</span>  <span class="c1"># list of all total strain tensors at end of linear regime</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;transition_ind&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">it_list</span>  <span class="c1"># list of indices identified at elastic/plastic transition</span>
                                                   <span class="c1"># by various methods</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###   Data set: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">  ###&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type of microstructure: </span><span class="si">{</span><span class="n">Key_Translated</span><span class="p">[</span><span class="s2">&quot;Texture_Type&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estimated elastic constants (in GPa): C=</span><span class="si">{</span><span class="n">C</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1.E-3</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># get units from metadata ???</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estimated yield strength: </span><span class="si">{</span><span class="n">sy_av</span><span class="si">:</span><span class="s1">5.2f</span><span class="si">}</span><span class="s1"> MPa at PEEQ = </span><span class="si">{</span><span class="n">ep_s</span><span class="si">:</span><span class="s1">5.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Data.convert_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.convert_data">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sig</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data provided only for stress tensor at yield point into mat_param dictionary</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        sig : ndarray</span>
<span class="sd">            Stress tensors at yield onset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;inside where it should not be&quot;</span><span class="p">)</span>
        <span class="n">Nlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
        <span class="n">sdim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sig</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
        <span class="k">if</span> <span class="n">sdim</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sdim&#39;</span><span class="p">]:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s1">&#39;Warning: dimension of stress in data does not agree with parameter sdim. Use value from data.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sig_ideal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;wh_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">lc_ind_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Nlc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;lc_indices&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lc_ind_list</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;E_av&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>  <span class="c1"># WARNING: value cannot be derived from data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;nu_av&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.3</span>  <span class="c1"># WARNING: value cannot be derived from data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;sy_av&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">FE</span><span class="o">.</span><span class="n">sig_eq_j2</span><span class="p">(</span><span class="n">sig</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;peeq_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;Nlc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nlc</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">###   Data set: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">  ###&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Converted data for </span><span class="si">{</span><span class="n">Nlc</span><span class="si">}</span><span class="s1"> stress tensors at yield onset into material data.&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;WARNING: Elastic parameters cannot be derived from data. Please set them manually.&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Data.add2mat_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.add2mat_data">[docs]</a>
    <span class="k">def</span> <span class="nf">add2mat_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_dict</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="c1"># create shifted plastic strain ???</span>
        <span class="n">epl_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;epc&#39;</span><span class="p">]</span>
        <span class="n">epl_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_start&#39;</span><span class="p">]</span>
        <span class="n">epl_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;ep_max&#39;</span><span class="p">]</span>
        <span class="n">depl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;delta_ep&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_data</span><span class="p">(</span><span class="n">epl_crit</span><span class="p">,</span> <span class="n">epl_start</span><span class="p">,</span> <span class="n">epl_max</span><span class="p">,</span> <span class="n">depl</span><span class="p">)</span></div>


<div class="viewcode-block" id="Data.plot_training_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.plot_training_data">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_training_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Function for plotting stress strain curves from the database using total strain and plastic strain values.</span>
        <span class="k">for</span> <span class="n">data</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span> <span class="ow">in</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span><span class="p">,</span> <span class="s2">&quot;Total Strain&quot;</span><span class="p">,</span> <span class="s2">&quot;Stress&quot;</span><span class="p">),</span>
                                     <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_data</span><span class="p">,</span> <span class="s2">&quot;Plastic Strain&quot;</span><span class="p">,</span> <span class="s2">&quot;Stress&quot;</span><span class="p">)]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="n">emax</span><span class="p">)</span></div>


<div class="viewcode-block" id="Data.plot_data">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.plot_data">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">emax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="s2">&quot;Strain_Total&quot;</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="s2">&quot;Stress&quot;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">emax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">emax</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="Data.plot_set">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.plot_set">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">mat_param</span><span class="p">):</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">polar_ang</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Load&#39;</span><span class="p">]))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Main_Strains&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span>
                     <span class="n">FE</span><span class="o">.</span><span class="n">seq_J2</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Main_Stresses&#39;</span><span class="p">])),</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon_</span><span class="si">{eq}</span><span class="s1">^\mathrm</span><span class="si">{tot}</span><span class="s1">$ (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Equiv. total strain vs. equiv. J2 stress&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">syc_0</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">syc_1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># , projection=&#39;polar&#39;)</span>
            <span class="n">syc</span> <span class="o">=</span> <span class="n">FE</span><span class="o">.</span><span class="n">s_cyl</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;S_yld&quot;</span><span class="p">]))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;S_Cyl&quot;</span><span class="p">])[</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;Plastic_data&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;S_Cyl&quot;</span><span class="p">])[</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;Plastic_data&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;or&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;S_Cyl&quot;</span><span class="p">])[</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;Elastic_data&quot;</span><span class="p">],</span> <span class="mi">1</span><span class="p">],</span>
                     <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;S_Cyl&quot;</span><span class="p">])[</span><span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;Parsed_Data&quot;</span><span class="p">][</span><span class="s2">&quot;Elastic_data&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ob&#39;</span><span class="p">)</span>
            <span class="n">syc_0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">syc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">syc_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">syc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">syc_1</span><span class="p">,</span> <span class="n">syc_0</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">syc_1</span><span class="p">,</span> <span class="n">syc_0</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">syc_1</span><span class="p">,</span> <span class="n">syc_0</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="p">[</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;sy_av&#39;</span><span class="p">],</span> <span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;sy_av&#39;</span><span class="p">]],</span> <span class="s1">&#39;--k&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;raw data above yield point&#39;</span><span class="p">,</span> <span class="s1">&#39;raw data below yield point&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;interpolated yield strength&#39;</span><span class="p">,</span> <span class="s1">&#39;average yield strength&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Raw data &#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (rad)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="c1"># Check</span>
<div class="viewcode-block" id="Data.plot_yield_locus">
<a class="viewcode-back" href="../../pyLabFEA.html#pylabfea.data.Data.plot_yield_locus">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_yield_locus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">mat_data</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">scatter</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">data_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arrow</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="s1">&#39;polar&#39;</span><span class="p">},</span>
                               <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="c1"># ms_max = np.amax(self.mat_param[active])</span>
        <span class="n">Ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mat_data</span><span class="p">[</span><span class="n">active</span><span class="p">])</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="n">mat_data</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">mat_data</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v0</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-3</span><span class="p">):</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ppe</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ndat</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">active</span> <span class="o">==</span> <span class="s1">&#39;flow_stress&#39;</span><span class="p">:</span>
                <span class="n">sc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FE</span><span class="o">.</span><span class="n">s_cyl</span><span class="p">(</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">ppe</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FE</span><span class="o">.</span><span class="n">eps_eq</span><span class="p">(</span><span class="n">mat_data</span><span class="p">[</span><span class="s1">&#39;plastic_strain&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ppe</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">ppe</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.003</span><span class="p">:</span>
                        <span class="n">scy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Flow Stress&#39;</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
        <span class="n">scy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scy</span><span class="p">)</span>
        <span class="n">scy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scy</span><span class="p">)</span>
        <span class="n">scy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scy</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">scy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">scy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pyLabFEA 4.3.2 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">pylabfea.data</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020 2022, 2024, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>
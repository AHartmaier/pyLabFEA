
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>data &#8212; pyLabFEA 2.0.53 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for data</h1><div class="highlight"><pre>
<span></span><span class="c1">#Module pylabfea.data</span>
<span class="sd">&#39;&#39;&#39;Module pylabfea.data introduces the class ``Data`` for handling of data resulting </span>
<span class="sd">from virtual or physical mechanical tests in the pyLabFEA package. This class provides the </span>
<span class="sd">methods necessary for analyzing data. During this processing, all information is gathered </span>
<span class="sd">that is required to define a material, i.e., all parameters for elasticity, plasticity, </span>
<span class="sd">and microstructures are provided from the data.</span>

<span class="sd">uses NumPy, SciPy, MatPlotLib</span>

<span class="sd">Version: 2.1 (2020-04-05)</span>
<span class="sd">Author: Alexander Hartmaier, ICAMS/Ruhr-University Bochum, April 2020</span>
<span class="sd">Email: alexander.hartmaier@rub.de</span>
<span class="sd">distributed under GNU General Public License (GPLv3)&#39;&#39;&#39;</span>

<span class="kn">from</span> <span class="nn">pylabfea.basic</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylabfea.model</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">pylabfea.material</span> <span class="kn">import</span> <span class="n">Material</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="s1">&#39;=================&#39;</span>
<span class="s1">&#39;define data class&#39;</span>
<span class="s1">&#39;=================&#39;</span>
<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../pyLabFEA.html#data.Data">[docs]</a><span class="k">class</span> <span class="nc">Data</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Define class for handling data from virtual mechanical tests in micromechanical </span>
<span class="sd">    simulations and data from physical mechanical tests on materials with various </span>
<span class="sd">    microstructures</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    msl  : list</span>
<span class="sd">        List with names of JOSN files with metadata for all microstructures</span>
<span class="sd">    path_data : str</span>
<span class="sd">        Trunc of pathname for data files</span>
<span class="sd">    path_json : str</span>
<span class="sd">        Trunc of pathname for JSON metadata files (Optional, default: path_data)</span>
<span class="sd">    name : str</span>
<span class="sd">        Name of Dataset (optional, default: &#39;Dataset&#39;)</span>
<span class="sd">    nth  : int</span>
<span class="sd">        Read only every nth lines of input file (optional, default: 1)</span>
<span class="sd">    epl_crit : float</span>
<span class="sd">        Critical plastic strain at which yield strength is defined (optional, default: 2.e-3)</span>
<span class="sd">    d_ep     : float</span>
<span class="sd">        Range around critical value of plastic strain in which flow stresses are</span>
<span class="sd">        evaluated (optional, default: 5.e-4)</span>
<span class="sd">    npe : int</span>
<span class="sd">        Number of equiv. plastic strains used for work hardening</span>
<span class="sd">        </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    msl   : list</span>
<span class="sd">    Nset  : int</span>
<span class="sd">    name  : str</span>
<span class="sd">    pd    : str</span>
<span class="sd">    pj    : str</span>
<span class="sd">    epc   : float</span>
<span class="sd">    dep   : float</span>
<span class="sd">    set   : list</span>
<span class="sd">    sy_av : float</span>
<span class="sd">    E_av  : float</span>
<span class="sd">    nu_av : float</span>
<span class="sd">    mat_param : dictionary</span>
<span class="sd">        Contains available data for microstructural parameters (&quot;texture&quot;, &quot;work_hard&quot;, &quot;flow_stress&quot;) to be transfered to material.microstructure</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msl</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">path_json</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Dataset&#39;</span><span class="p">,</span> <span class="n">nth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
                            <span class="n">epl_crit</span><span class="o">=</span><span class="mf">2.e-3</span><span class="p">,</span> <span class="n">d_ep</span><span class="o">=</span><span class="mf">5.e-4</span><span class="p">,</span> <span class="n">npe</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msl</span>  <span class="o">=</span> <span class="n">msl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Nset</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">msl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="n">path_data</span>
        <span class="k">if</span> <span class="n">path_json</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pj</span> <span class="o">=</span> <span class="n">path_json</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nth</span> <span class="o">=</span> <span class="n">nth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epc</span> <span class="o">=</span> <span class="n">epl_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dep</span> <span class="o">=</span> <span class="n">d_ep</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="s1">&#39;import and pre-process data of all microstructure&#39;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">msl</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">))</span>
        <span class="s1">&#39;calculate average properties over all microstructures&#39;</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">micr</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ttyp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">sfl</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">peeq_min</span> <span class="o">=</span> <span class="mf">10.</span>  <span class="c1"># minimum equiv. plastic strain reached in sets</span>
        <span class="n">Nlc_min</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># minimum number of load cases reached in sets</span>
        <span class="k">for</span> <span class="n">dset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">:</span>
            <span class="n">prop</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dset</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">nu</span><span class="p">])</span>
            <span class="n">micr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">texture_param</span><span class="p">)</span>
            <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">texture_name</span><span class="p">)</span>
            <span class="n">ttyp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">texture_type</span><span class="p">)</span>
            <span class="n">peeq_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">peeq_min</span><span class="p">,</span> <span class="n">dset</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">])</span>
            <span class="n">Nlc_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">Nlc_min</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">load_case</span><span class="p">))</span>
        <span class="n">prop</span> <span class="o">/=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nset</span>  <span class="c1"># average properties over all microstructures</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sy_av</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># information needed when material.plasticity is initiated </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E_av</span>  <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># information needed when material.elasticity is initiated </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu_av</span> <span class="o">=</span> <span class="n">prop</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span> <span class="o">=</span> <span class="p">{</span>      <span class="c1"># this information of the data will be copied into the material upon definition of its microstructure</span>
            <span class="s1">&#39;Npl&#39;</span>         <span class="p">:</span> <span class="n">npe</span><span class="p">,</span>       <span class="c1"># number of PEEQ values </span>
            <span class="s1">&#39;Nlc&#39;</span>         <span class="p">:</span> <span class="n">Nlc_min</span><span class="p">,</span>   <span class="c1"># number of load cases covered in data (minimum of load cases reached over all sets)</span>
            <span class="s1">&#39;Ntext&#39;</span>       <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nset</span><span class="p">,</span> <span class="c1"># number of microstructures covered by sets</span>
            <span class="s1">&#39;texture&#39;</span>     <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">micr</span><span class="p">),</span>  <span class="c1"># texture parameters for each set</span>
            <span class="s1">&#39;ms_name&#39;</span>     <span class="p">:</span> <span class="n">name</span><span class="p">,</span>      <span class="c1"># list of names of differnt microstructures</span>
            <span class="s1">&#39;ms_type&#39;</span>     <span class="p">:</span> <span class="n">ttyp</span><span class="p">,</span>      <span class="c1"># unimodal texture type</span>
            <span class="s1">&#39;peeq_max&#39;</span>    <span class="p">:</span> <span class="n">peeq_min</span><span class="p">,</span>  <span class="c1"># maximum PEEQ covered in data (must be minimum of value reached over all sets)</span>
            <span class="s1">&#39;epc&#39;</span>         <span class="p">:</span> <span class="n">epl_crit</span><span class="p">,</span>  <span class="c1"># critical PEEQ for with yield stress is defined </span>
            <span class="s1">&#39;work_hard&#39;</span>   <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">epl_crit</span><span class="p">,</span><span class="n">peeq_min</span><span class="p">,</span><span class="n">npe</span><span class="p">)</span> <span class="c1"># values of PEEQ for which flow stresses are available</span>
        <span class="p">}</span>
        <span class="s1">&#39;for each load case in each set: interpolate flow stress to fixed PEEQ grid&#39;</span>
        <span class="n">Nlc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;Nlc&#39;</span><span class="p">]</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nset</span><span class="p">,</span><span class="n">npe</span><span class="p">,</span><span class="n">Nlc</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>  
        <span class="n">sflow_av</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nset</span><span class="p">,</span><span class="n">npe</span><span class="p">))</span>
        <span class="n">iset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">dset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">:</span>   <span class="c1"># loop over data sets</span>
            <span class="n">ipeeq</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">N0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Nlc</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">load_case</span><span class="p">)</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N0</span><span class="p">)</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="p">)</span>
            <span class="n">ilc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">peeq</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;work_hard&#39;</span><span class="p">]:</span>  <span class="c1"># loop over PEEQS for which flow stresses are required</span>
                <span class="n">hs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">ht</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N0</span><span class="p">):</span>  <span class="c1"># loop over load cases for each level of PEEQ</span>
                    <span class="s1">&#39;this should be generalized for the case that Nlc varies strongly over the sets&#39;</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">load_case</span><span class="p">[</span><span class="n">ilc</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>  <span class="c1"># indices of data points belonging to this load case</span>
                    <span class="s1">&#39;select data points above and below peeq&#39;</span>
                    <span class="n">iel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="n">peeq</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># find elastic data sets in load case</span>
                    <span class="n">ipl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">dset</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">peeq</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># find plastic data sets in load case</span>
                    <span class="n">eel</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>  <span class="c1"># last data point &lt; peeq</span>
                    <span class="n">epl</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>   <span class="c1"># first data point &gt; peeq</span>
                    <span class="n">s0</span>  <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># largest flow stress below peeq</span>
                    <span class="n">s1</span>  <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># smallest flow stress above peeq</span>
                    <span class="n">ds</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">-</span> <span class="n">s0</span>     <span class="c1"># difference in seq b/w data points around peeq</span>
                    <span class="n">de</span> <span class="o">=</span> <span class="n">epl</span>  <span class="o">-</span> <span class="n">eel</span>  <span class="c1"># difference in peeq for closest data points</span>
                    <span class="n">sint</span> <span class="o">=</span> <span class="n">s0</span> <span class="o">+</span> <span class="p">(</span><span class="n">peeq</span><span class="o">-</span><span class="n">eel</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="o">/</span><span class="n">de</span> <span class="c1"># linearly interpolated equiv. flow stress at peeq</span>
                    <span class="n">theta</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># polar angle (not interpolated)</span>
                    <span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sint</span><span class="p">)</span>
                    <span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sint</span><span class="p">)</span>  <span class="c1"># append twice to consider tension compression symmetry in material</span>
                    <span class="n">ht</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c1"># append original polar angles</span>
                    <span class="n">theta</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>   <span class="c1"># mirror polar angle</span>
                    <span class="k">if</span> <span class="n">theta</span><span class="o">&lt;-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">:</span>
                        <span class="n">theta</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                    <span class="n">ht</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="c1"># append mirrored polar angles</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ht</span><span class="p">)</span> <span class="c1"># sort w.r.t. polar angle</span>
                <span class="n">sf</span><span class="p">[</span><span class="n">iset</span><span class="p">,</span><span class="n">ipeeq</span><span class="p">,:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hs</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>   <span class="c1"># first component: seq</span>
                <span class="n">sf</span><span class="p">[</span><span class="n">iset</span><span class="p">,</span><span class="n">ipeeq</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ht</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>   <span class="c1"># second component: polar angle</span>
                <span class="n">sflow_av</span><span class="p">[</span><span class="n">iset</span><span class="p">,</span><span class="n">ipeeq</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">hs</span><span class="p">)</span>    <span class="c1"># average seq over polar angles</span>
                <span class="n">ipeeq</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">iset</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sf</span>       <span class="c1"># cylindrical flow stresses at PEEQs in &#39;work_hard&#39; for each texture</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;flow_seq_av&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sflow_av</span> <span class="c1"># averaged equiv. flow stresses at PEEQs in &#39;work_hard&#39; for each texture</span>
        
<div class="viewcode-block" id="Data.Set"><a class="viewcode-back" href="../pyLabFEA.html#data.Data.Set">[docs]</a>    <span class="k">class</span> <span class="nc">Set</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define class for handling of a dataset for one individual material </span>
<span class="sd">    </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        db   : object of type ``Data``</span>
<span class="sd">            Parent database from which properties are inherited</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of JSON file with metadata for microstructure to be stored in this dataset</span>
<span class="sd">        plot : Boolean</span>
<span class="sd">            Graphical output of data in each set (optional, default: False)</span>
<span class="sd">        </span>
<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        db : object of class ``Data``</span>
<span class="sd">        name : str</span>
<span class="sd">        N  : int</span>
<span class="sd">            Number of imported data points</span>
<span class="sd">        Ndat : int</span>
<span class="sd">            Number of raw data points (filtered data lying around yield point mirrored wrt polar angle)</span>
<span class="sd">        Nlc  : int</span>
<span class="sd">            Number of loadcase in raw data</span>
<span class="sd">        E, nu : float</span>
<span class="sd">            Elastic parameters obtained from data</span>
<span class="sd">        sy    : float</span>
<span class="sd">            Yield strength obtained from data</span>
<span class="sd">        texture_param : float</span>
<span class="sd">            Microstructure parameter for texture</span>
<span class="sd">        eps, epl, eel, sig, ubc : (N,) array</span>
<span class="sd">        sfc_   : (Ndat,) array</span>
<span class="sd">            Filtered cyl. stress tensor around yield point</span>
<span class="sd">        peeq_  : (Ndat,) array</span>
<span class="sd">            Filtered equiv. plastic strain around yield point</span>
<span class="sd">        ubc_   : (Ndat,) array</span>
<span class="sd">            Filtered boundary condition vector around yield point</span>
<span class="sd">        sig_   : (Ndat,) array</span>
<span class="sd">            Filtered princ. stress tensor around yield point</span>
<span class="sd">        f_yld_ : (Ndat,) array</span>
<span class="sd">            Categorial yield function of data points around yield point (&quot;-1&quot;: elastic, &quot;+1&quot;: plastic)</span>
<span class="sd">        i_el_  : (Ndat,) array</span>
<span class="sd">            Filtered indeces of data points lying in elastic regime</span>
<span class="sd">        i_pl_  : (Ndat,) array</span>
<span class="sd">            Filtered indeces for data points lying in plastic regime</span>
<span class="sd">        syc    : (Nlc,3) array</span>
<span class="sd">            Yield strength: interpolated cyl. stress tensor at onset of yielding for individual load cases</span>
<span class="sd">        load_case : list</span>
<span class="sd">            List of lists with data set indices belonging to one single load case (index space: [0,N])</span>
<span class="sd">        lc_    : list</span>
<span class="sd">            List of lists with data set indices belonging to one single load case (index space: [0,Ndat])</span>
<span class="sd">    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;def prop_elastic():</span>
<span class="sd">                &#39;calculate estimates for elastic properties E, nu associated to data set&#39;</span>
<span class="sd">                ssig = 1.e-1</span>
<span class="sd">                seps = 1.e3</span>
<span class="sd">                a = seps*self.eps[ind,:]</span>
<span class="sd">                b = ssig*self.sig[ind,:]</span>
<span class="sd">                x = np.linalg.lstsq(a, b, rcond=None)</span>
<span class="sd">                c = x[0]*seps/ssig</span>
<span class="sd">                self.C11 = c[0,0]</span>
<span class="sd">                self.C12 = c[1,0]</span>
<span class="sd">                self.C13 = c[2,0]</span>
<span class="sd">                self.C21 = c[0,1]</span>
<span class="sd">                self.C22 = c[1,1]</span>
<span class="sd">                self.C23 = c[2,1]</span>
<span class="sd">                self.C31 = c[0,2]</span>
<span class="sd">                self.C32 = c[1,2]</span>
<span class="sd">                self.C33 = c[2,2]</span>
<span class="sd">                </span>
<span class="sd">                #self.nu = self.C12/(self.C11 + self.C12) # estimate for isotropic materials</span>
<span class="sd">                #self.E = self.C12*(1.+self.nu)*(1.-2.*self.nu)/self.nu</span>
<span class="sd">                </span>
<span class="sd">                print(&#39;Estimated elasic tensor C_ij (GPa): \n%8.2f, %8.2f, %8.2f&#39; </span>
<span class="sd">                       % (self.C11/1000, self.C12/1000, self.C13/1000))</span>
<span class="sd">                print(&#39;%8.2f, %8.2f, %8.2f&#39; </span>
<span class="sd">                       % (self.C21/1000, self.C22/1000, self.C23/1000))</span>
<span class="sd">                print(&#39;%8.2f, %8.2f, %8.2f&#39; </span>
<span class="sd">                       % (self.C31/1000, self.C32/1000, self.C33/1000))</span>
<span class="sd">                print(&#39;Residuals of fitting elastic parameters: &#39;,x[1])&#39;&#39;&#39;</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">pj</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="s1">&#39;import data from CSV files of micromechanical simulations&#39;</span>
            <span class="n">sep</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_separator&#39;</span><span class="p">]</span>
            <span class="n">file</span>  <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">pd</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_data&#39;</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;CSV_format&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">AllData</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">)</span>
            <span class="n">sig_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S11&#39;</span><span class="p">,</span><span class="s1">&#39;S22&#39;</span><span class="p">,</span><span class="s1">&#39;S33&#39;</span><span class="p">]</span>
            <span class="n">epl_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ep11&#39;</span><span class="p">,</span><span class="s1">&#39;Ep22&#39;</span><span class="p">,</span><span class="s1">&#39;Ep33&#39;</span><span class="p">]</span>
            <span class="n">eps_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;E11&#39;</span><span class="p">,</span><span class="s1">&#39;E22&#39;</span><span class="p">,</span><span class="s1">&#39;E33&#39;</span><span class="p">]</span>
            <span class="n">eel_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ee11&#39;</span><span class="p">,</span><span class="s1">&#39;Ee22&#39;</span><span class="p">,</span><span class="s1">&#39;Ee33&#39;</span><span class="p">]</span>
            <span class="n">ubc_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StrainX&#39;</span><span class="p">,</span> <span class="s1">&#39;StrainY&#39;</span><span class="p">,</span> <span class="s1">&#39;StrainZ&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">eps_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">epl</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">epl_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eel</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">eel_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">sig_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span> <span class="o">=</span> <span class="n">AllData</span><span class="p">[</span><span class="n">ubc_names</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[::</span><span class="n">db</span><span class="o">.</span><span class="n">nth</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">*** Microstructure:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span><span class="s1">&#39; data points imported into database &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            
            <span class="s1">&#39;import texture parameters&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture_param</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Texture_index&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture_name</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Texture_name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">texture_type</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;Texture_type&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Texture &#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">texture_name</span><span class="p">,</span> <span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">texture_name</span><span class="p">,</span><span class="s1">&#39;) with texture parameter: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">texture_param</span><span class="p">)</span>
            
            <span class="s1">&#39;calculate eqiv. stresses and strains and theta values&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sc_full</span>   <span class="o">=</span> <span class="n">s_cyl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span>   <span class="c1"># transform stresses into cylindrical coordinates</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">peeq_full</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epl</span><span class="p">)</span>  <span class="c1"># calculate equiv. plastic strain from data</span>
            
            <span class="s1">&#39;Consistency checks&#39;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">1.</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*** Warning: Large hydrostatic stresses: minimum p=</span><span class="si">%5.2f</span><span class="s1"> MPa, maximum p=</span><span class="si">%5.2f</span><span class="s1"> MPa&#39;</span> 
                      <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])))</span>
            <span class="sd">&#39;&#39;&#39;hh = self.eel - (self.eps-self.epl)</span>
<span class="sd">            if np.amax(eps_eq(hh)) &gt; 1.e-8:</span>
<span class="sd">                print(&#39;*** WARNING: Inconsistency in eps_el!&#39;)</span>
<span class="sd">            hh = self.ang - self.sc_full[:,1]</span>
<span class="sd">            if np.amax(np.abs(hh)) &gt; 1.e-6:</span>
<span class="sd">                print(&#39;*** WARNING: Inconsistency in theta!&#39;)</span>
<span class="sd">                print(self.ang[0:self.N:2500], self.sc_full[0:self.N:2500,1], hh[0:self.N:2500])&#39;&#39;&#39;</span>

            <span class="s1">&#39;filter load cases&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_case</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of lists with data set indices belonging to one load case</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">-</span><span class="n">uvec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-6</span><span class="p">:</span>
                    <span class="n">hh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">load_case</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            
            <span class="s1">&#39;select data points close to yield point =&gt; yield strength sy and raw data for ML flow rule&#39;</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq_full</span><span class="o">&gt;</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">-</span><span class="n">db</span><span class="o">.</span><span class="n">dep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_full</span><span class="o">&lt;</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">+</span><span class="n">db</span><span class="o">.</span><span class="n">dep</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scyl_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sc_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">peeq_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_full</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># get first estimate of yield point, will be refined later</span>
            
            <span class="s1">&#39;mirror stress data w.r.t. theta in deviatoric stress space&#39;</span>
            <span class="n">sc2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">sc2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sc2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">ih</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">sc2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">sc2</span><span class="p">[</span><span class="n">ih</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            
            <span class="s1">&#39;calculate associated load vector for boundary conditions&#39;</span>
            <span class="n">hs1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">,:]</span>     <span class="c1"># original stresses</span>
            <span class="n">hs2</span> <span class="o">=</span> <span class="n">sp_cart</span><span class="p">(</span><span class="n">sc2</span><span class="p">)</span>        <span class="c1"># mirrored stresses</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">hs1</span><span class="o">*</span><span class="n">hs2</span><span class="p">)</span>   <span class="c1"># filter stress components where sign has changed by mirroring</span>
            <span class="n">ubc2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">sign</span> <span class="c1"># change sign accordingly in BC vector</span>

            <span class="s1">&#39;add mirrored data to flow stresses and augment plastic strain arrays accordingly&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scyl_raw</span><span class="p">[:,</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">sc2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">peeq_raw</span><span class="p">,</span> <span class="n">peeq_raw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc</span><span class="p">[</span><span class="n">ind</span><span class="p">],</span> <span class="n">ubc2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sig_</span>  <span class="o">=</span> <span class="n">sp_cart</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">)</span> <span class="c1"># transform back into 3D principle stress space</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span> <span class="o">*=</span> <span class="mi">2</span>    <span class="c1"># number of load cases in raw data</span>
            
            <span class="s1">&#39;calculate yield function of raw data&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span> <span class="o">-</span> <span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_el_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">i_pl_</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="s1">&#39;filter load cases of raw data&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span> <span class="o">=</span> <span class="p">[]</span>   <span class="c1"># list of lists with data set indices belonging to one load case</span>
            <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">-</span><span class="n">uvec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.e-5</span><span class="p">:</span>
                    <span class="n">hh</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hh</span><span class="p">)</span>
                    <span class="n">hh</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">uvec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubc_</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of load cases: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">,</span> <span class="s1">&#39;; initially: &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">)</span>

            <span class="s1">&#39;for each load case: interpolate flow stress to fixed PEEQ&#39;</span>
            <span class="n">hs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">ht</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lc_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">iel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&lt;</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># find elastic data sets in load case</span>
                <span class="n">ipl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_yld_</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">&gt;=</span><span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># find plastic data sets in load case</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span>   <span class="c1"># difference in seq b/w first plastic and last elastic data point</span>
                <span class="n">de</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">ipl</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>  <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>    <span class="c1"># difference in peeq b/w first plastic and last elastic data point</span>
                <span class="n">hs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">peeq_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]])</span><span class="o">*</span><span class="n">ds</span><span class="o">/</span><span class="n">de</span><span class="p">)</span> <span class="c1"># linearly interpolated equiv. stress at yield onset</span>
                <span class="n">ht</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">iel</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># polar angle of load case</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">ht</span><span class="p">)</span>   <span class="c1"># sort w.r.t. polar angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Nlc</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>   <span class="c1"># critical cylindrical stress tensor at yield onset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hs</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>   <span class="c1"># first component: seq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ht</span><span class="p">)[</span><span class="n">ind</span><span class="p">]</span>   <span class="c1"># second component: polar angle</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># refined value for yield strength of data set</span>
            
            <span class="s1">&#39;select data points with eqiv. stress in range [0.1,0.4]sy =&gt; elastic constants&#39;</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">)</span>
            <span class="n">ind1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">seq</span><span class="o">&gt;</span><span class="mf">0.1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="n">seq</span><span class="o">&lt;</span><span class="mf">0.4</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="n">seq_J2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind1</span><span class="p">])</span>
            <span class="n">eeq</span> <span class="o">=</span> <span class="n">eps_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="n">ind1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">seq</span><span class="o">/</span><span class="n">eeq</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated elasic constants: E=</span><span class="si">%5.2f</span><span class="s1"> GPa, nu=</span><span class="si">%4.2f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Estimated yield strength: </span><span class="si">%5.2f</span><span class="s1"> MPa, from </span><span class="si">%i</span><span class="s1"> data sets with PEEQ approx. </span><span class="si">%5.3f</span><span class="s1">&#39;</span> 
                  <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ndat</span><span class="p">,</span><span class="n">db</span><span class="o">.</span><span class="n">epc</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plot_set</span><span class="p">()</span>
                   
        <span class="sd">&#39;&#39;&#39;def augment_data(self, plot=False):</span>
<span class="sd">            #Raw data is distributed over entire deviatoric plane to create a suited</span>
<span class="sd">            #data set for training of SVC, graphical output of raw data together with </span>
<span class="sd">            #augmented data can be created.</span>
<span class="sd">            </span>
<span class="sd">            &#39;augment raw data and create result vector (yield function)&#39;</span>
<span class="sd">            self.sc_train, self.yf_train = mat.create_sig_data(syc=self.syc, Nseq=25, extend=True)</span>
<span class="sd">            self.sc_test, self.yf_test   = mat.create_sig_data(syc=self.syc[::12,:], Nseq=15)</span>

<span class="sd">            if plot:</span>
<span class="sd">                print(&#39;Plot raw data and training data extended over deviatoric plane for data set &#39;,self.name)</span>
<span class="sd">                fig, ax  = plt.subplots(nrows=1, ncols=1, figsize=(10,8))</span>
<span class="sd">                Ncol = int(len(self.sc_train)/self.Nlc)</span>
<span class="sd">                ax.scatter(self.sc_train[:,1], self.sc_train[:,0], s=15, c=self.yf_train, cmap=plt.cm.Paired)</span>
<span class="sd">                #ax.plot(self.sfc_[:,1], self.sfc_[:,0], &#39;.y&#39;)</span>
<span class="sd">                ax.plot(self.syc[:,1], self.syc[:,0], &#39;-k&#39;)</span>
<span class="sd">                ax.set_title(&#39;SVC yield function for data set &#39;+self.name)</span>
<span class="sd">                ax.set_xlabel(r&#39;$\theta$ (rad)&#39;, fontsize=20)</span>
<span class="sd">                ax.set_ylabel(r&#39;$\sigma_{eq}$ (MPa)&#39;, fontsize=20)</span>
<span class="sd">                ax.tick_params(axis=&quot;x&quot;, labelsize=16)</span>
<span class="sd">                ax.tick_params(axis=&quot;y&quot;, labelsize=16)</span>
<span class="sd">                plt.show()</span>
<span class="sd">        &#39;&#39;&#39;</span>

<div class="viewcode-block" id="Data.Set.plot_set"><a class="viewcode-back" href="../pyLabFEA.html#data.Data.Set.plot_set">[docs]</a>        <span class="k">def</span> <span class="nf">plot_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nth</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;Graphical output of equiv. stress vs. equic. total strain for selected load cases and </span>
<span class="sd">            raw data in deviatoric cyl. stress space</span>
<span class="sd">            </span>
<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            file : str</span>
<span class="sd">                Write graph to pdf file (optional)</span>
<span class="sd">            nth  : int</span>
<span class="sd">                Plot every nth load case (optional, default: 18)</span>
<span class="sd">            fontsize : 20</span>
<span class="sd">                Fontsize for plot (optional, default: 20)</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">load_case</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">nth</span><span class="p">):</span>
                <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_case</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">polar_ang</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eps_eq</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">seq_J2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sig</span><span class="p">[</span><span class="n">ind</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">col</span><span class="p">))</span> <span class="c1">#&#39;.k&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\epsilon_</span><span class="si">{eq}</span><span class="s1">^\mathrm</span><span class="si">{tot}</span><span class="s1">$ (%)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Equiv. total strain vs. equiv. J2 stress&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">#, projection=&#39;polar&#39;)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl_</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_pl_</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;or&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el_</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">sfc_</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">i_el_</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ob&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">syc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;-k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sy</span><span class="p">],</span> <span class="s1">&#39;--k&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;raw data above yield point&#39;</span><span class="p">,</span> <span class="s1">&#39;raw data below yield point&#39;</span><span class="p">,</span> 
                           <span class="s1">&#39;interpolated yield strength&#39;</span><span class="p">,</span> <span class="s1">&#39;average yield strength&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Raw data &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta$ (rad)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_</span><span class="si">{eq}</span><span class="s1">$ (MPa)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
    
<div class="viewcode-block" id="Data.plot_yield_locus"><a class="viewcode-back" href="../pyLabFEA.html#data.Data.plot_yield_locus">[docs]</a>    <span class="k">def</span> <span class="nf">plot_yield_locus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">set_ind</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Plot yield loci of imported microstructures in database.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">ms_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="n">active</span><span class="p">])</span>
        <span class="n">Ndat</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="n">active</span><span class="p">])</span>
        <span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v0</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1.e-3</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ndat</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="n">active</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">hc</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="o">-</span><span class="n">v0</span><span class="p">)</span><span class="o">/</span><span class="n">scale</span>
            <span class="k">if</span> <span class="n">active</span><span class="o">==</span><span class="s1">&#39;work_hard&#39;</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">[</span><span class="n">set_ind</span><span class="p">]</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">][</span><span class="n">set_ind</span><span class="p">,</span><span class="n">i</span><span class="p">,:,:]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;PEEQ: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">hc</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">sc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mat_param</span><span class="p">[</span><span class="s1">&#39;flow_stress&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">dset</span><span class="o">.</span><span class="n">texture_name</span>
                <span class="n">color</span> <span class="o">=</span> <span class="p">(</span><span class="n">hc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="n">hc</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">polar</span><span class="p">(</span><span class="n">sc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">sc</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span><span class="mf">0.7</span><span class="p">),</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="o">+</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">fontsize</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">pyLabFEA</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../readme.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pyLabFEA.html">Modules</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Alexander Hartmaier, ICAMS/Ruhr University Bochum, Germany.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.0.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>